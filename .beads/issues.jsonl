{"id":"simple-agent-harness-0t2","title":"Rate limit detection must only inspect system-level events, not tool output content","description":"The rate limit detection logic must not grep the entire JSONL output stream. When the agent reads source files that mention rate limiting (e.g., SPEC.md documenting the rate limit feature), naive pattern matching produces false positives and causes the loop to exit prematurely.\n\nFix applied in ralph-wiggums-loop.sh: check_rate_limited() now only inspects the final type=result event for is_error:true or subtype:error before checking for rate limit keywords.\n\nThe Rust harness (runner.rs / metrics.rs) needs the same approach:\n- Only check the session result metadata (exit code, error type) for rate limit signals\n- Never grep raw JSONL content that includes tool_result payloads\n- A successful session (is_error=false, subtype=success) should never be classified as rate limited regardless of output content","status":"open","priority":3,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-15T01:10:05.841494Z","created_by":"Austin King","updated_at":"2026-02-15T01:10:05.841494Z"}
{"id":"simple-agent-harness-3dl","title":"Implement status file with atomic JSON writes","description":"Write harness.status as JSON on every state transition. Use atomic write pattern: write to temp file then rename. JSON fields: pid, state, iteration, max_iterations, global_iteration, output_file, output_bytes, session_start, last_update, last_completed_iteration, last_committed, consecutive_rate_limits. States: starting, pre_hooks, session_running, watchdog_kill, retrying, post_hooks, rate_limited_backoff, idle, shutting_down. Acceptance: status file is valid JSON after each state change, rename is atomic. See PRD: Status File section.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:24.730616Z","created_by":"Austin King","updated_at":"2026-02-15T01:14:02.979012Z","closed_at":"2026-02-15T01:14:02.979012Z","close_reason":"Implement status file with atomic JSON writes","dependencies":[{"issue_id":"simple-agent-harness-3dl","depends_on_id":"simple-agent-harness-p0y","type":"blocks","created_at":"2026-02-14T23:50:42.105114Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-5x6","title":"Implement --dry-run mode","description":"When --dry-run flag is passed: validate the resolved configuration (after merging CLI \u003e file \u003e defaults), print all resolved settings in a readable format, then exit without starting the loop. Useful for verifying config before long runs. Acceptance: --dry-run prints resolved config and exits 0 on valid config, exits non-zero with error on invalid config. See PRD: CLI Interface.","status":"open","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:49:40.45134Z","created_by":"Austin King","updated_at":"2026-02-14T23:49:44.490018Z","dependencies":[{"issue_id":"simple-agent-harness-5x6","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:55.542394Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-7d0","title":"Implement rate limit detection with exponential backoff","description":"Scan session output file for rate limit indicators: JSON 'error:rate_limit', text patterns 'usage limit', 'hit your limit', 'resets.*UTC' (case-insensitive). On detection: increment consecutive rate limit counter, apply exponential backoff (initial_delay * 2^consecutive_count, capped at max_delay_secs), do not increment productive iteration counter. After max_consecutive_rate_limits consecutive rate limits, exit the loop. A successful session resets counter and backoff. Acceptance: rate limit patterns detected correctly, backoff escalates, loop exits after max consecutive. See PRD: Rate Limit Detection section.","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:49:19.661408Z","created_by":"Austin King","updated_at":"2026-02-15T01:58:33.907576Z","closed_at":"2026-02-15T01:58:33.907576Z","close_reason":"Implement rate limit detection with exponential backoff","dependencies":[{"issue_id":"simple-agent-harness-7d0","depends_on_id":"simple-agent-harness-p0y","type":"blocks","created_at":"2026-02-14T23:50:52.427094Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-7rx","title":"Implement signal handling and graceful shutdown","description":"Implement signals.rs: three shutdown triggers. (1) STOP file: checked at top of each iteration, if present log event, delete file, exit. (2) First SIGINT: set flag, finish current session, then exit loop. Print 'Caught SIGINT, finishing current session...'. (3) Second SIGINT within 3s: kill current agent process group immediately, exit. (4) SIGTERM: same as single SIGINT. On any shutdown: persist global iteration counter, write final status. Uses tokio::signal for async signal handling. Acceptance: integration test showing STOP file triggers clean exit. See PRD: Graceful Shutdown section.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:48.437997Z","created_by":"Austin King","updated_at":"2026-02-15T00:17:24.372894Z","closed_at":"2026-02-15T00:17:24.372894Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-7rx","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:32.687071Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-8ff","title":"Implement pre/post-session hook execution","description":"Implement hooks.rs: execute shell commands from config [hooks] pre_session and post_session arrays. Run synchronously before/after each session. Set environment variables: HARNESS_ITERATION, HARNESS_GLOBAL_ITERATION, HARNESS_PROMPT_FILE (pre+post), plus HARNESS_OUTPUT_FILE, HARNESS_EXIT_CODE, HARNESS_OUTPUT_BYTES, HARNESS_SESSION_DURATION, HARNESS_COMMITTED (post only). Pre-session hook failure (non-zero exit) skips the iteration with logged error. Post-session hook failure logs error but continues. Empty retries do NOT trigger post-session hooks. Acceptance: hooks run with correct env vars, failures handled per spec. See PRD: Hooks section.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:49.867764Z","created_by":"Austin King","updated_at":"2026-02-15T01:34:28.791281Z","closed_at":"2026-02-15T01:34:28.791281Z","close_reason":"Implement pre/post-session hook execution with env vars","dependencies":[{"issue_id":"simple-agent-harness-8ff","depends_on_id":"simple-agent-harness-p0y","type":"blocks","created_at":"2026-02-14T23:50:47.74734Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-d3v","title":"Implement session spawning and output capture","description":"Implement session.rs: spawn the agent subprocess using tokio::process::Command. Construct the command from config [agent] section, replacing {prompt} placeholder with actual prompt content. Pipe stdout and stderr to a JSONL output file named {output_prefix}-{global_iteration}.jsonl. Track the child PID and process group for later cleanup. Provide an async function that returns SessionResult with exit_code, output_bytes, duration. Acceptance: can spawn a simple command (e.g. echo), capture its output to a file, and report correct exit code and byte count. See PRD: Session Lifecycle, Architecture.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:19.006921Z","created_by":"Austin King","updated_at":"2026-02-15T00:06:54.404814Z","closed_at":"2026-02-15T00:06:54.404814Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-d3v","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:28.653853Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-edb","title":"Implement config validation with helpful error messages","description":"Add thorough validation to config loading: check that prompt_file exists, output_dir exists or can be created, command binary is in PATH, timeout values are positive, retry counts are non-negative, etc. Produce clear error messages indicating which field is invalid and what values are acceptable. Validate on load so errors surface immediately, not mid-run. Acceptance: invalid config produces clear, actionable error messages. See PRD: Configuration section.","status":"open","priority":3,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-14T23:49:57.481176Z","created_by":"Austin King","updated_at":"2026-02-14T23:50:02.569419Z","dependencies":[{"issue_id":"simple-agent-harness-edb","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:58.073222Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-ee7","title":"Implement commit detection in session output","description":"Scan session output for commit indicators (bd-finish, git commit success patterns). Set 'committed' field in status file and event log. Used by --status command to show 'committed (bd-finish detected)' for last completed iteration. Patterns should be configurable. Acceptance: committed=true when output contains commit indicators. See PRD: Status File, Event Log sections.","status":"open","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:49:32.16106Z","created_by":"Austin King","updated_at":"2026-02-14T23:49:36.57118Z","dependencies":[{"issue_id":"simple-agent-harness-ee7","depends_on_id":"simple-agent-harness-p0y","type":"blocks","created_at":"2026-02-14T23:50:54.258018Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-ewc","title":"Scaffold Rust project with Cargo.toml and module stubs","description":"Set up the Rust project skeleton. Create Cargo.toml with all dependencies (clap, serde, toml, tokio, nix, chrono, serde_json, tracing, tracing-subscriber). Create src/ with stub files: main.rs, config.rs, runner.rs, session.rs, watchdog.rs, retry.rs, metrics.rs, signals.rs, hooks.rs. main.rs should have a minimal clap CLI that compiles and prints help. Include a default harness.toml with all config sections from the PRD. Acceptance: 'cargo build' succeeds, 'cargo run -- --help' prints usage.","status":"closed","priority":0,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-14T23:47:23.476559Z","created_by":"Austin King","updated_at":"2026-02-15T00:00:09.247912Z","closed_at":"2026-02-15T00:00:09.247912Z","close_reason":"Scaffold complete: cargo build succeeds, cargo run -- --help prints usage"}
{"id":"simple-agent-harness-fgf","title":"Implement --status CLI command","description":"When --status flag is passed, read harness.status JSON file and display formatted output: loop state, current iteration/max, global iteration, session output size and growth status, uptime, last completed iteration info. Print and exit (do not start the loop). Handle missing status file gracefully with 'No running harness detected'. See PRD: Status Command section.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:33.108264Z","created_by":"Austin King","updated_at":"2026-02-15T01:17:31.758447Z","closed_at":"2026-02-15T01:17:31.758447Z","close_reason":"Implement --status CLI command with formatted status display","dependencies":[{"issue_id":"simple-agent-harness-fgf","depends_on_id":"simple-agent-harness-3dl","type":"blocks","created_at":"2026-02-14T23:50:43.334863Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-fvr","title":"Implement watchdog output-growth monitor","description":"Implement watchdog.rs: a tokio task that monitors the output file for growth. Algorithm: record initial size, check every check_interval_secs, reset stale timer on growth, kill process group after stale_timeout_mins of no growth. Process cleanup: SIGTERM to process group, wait 5s, SIGKILL if still alive, collect exit status. Return exit code 124 on timeout kill. Uses nix crate for signal/process group management. Acceptance: unit test with a mock slow-writing process that gets killed after stale timeout. See PRD: Watchdog section.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:29.04948Z","created_by":"Austin King","updated_at":"2026-02-15T00:10:59.0807Z","closed_at":"2026-02-15T00:10:59.0807Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-fvr","depends_on_id":"simple-agent-harness-d3v","type":"blocks","created_at":"2026-02-14T23:50:29.92715Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-jr7","title":"Implement retry policy for empty sessions","description":"Implement retry.rs: detect when session output is below min_output_bytes threshold. On empty session: log warning with output size, increment global_iteration (new output filename), re-run session with same prompt, after max_empty_retries failures skip to next iteration. Empty retries do NOT increment productive iteration counter and do NOT trigger post-session hooks. Acceptance: unit test showing retry behavior with configurable thresholds. See PRD: Retry Policy section.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:38.6347Z","created_by":"Austin King","updated_at":"2026-02-15T00:13:47.076532Z","closed_at":"2026-02-15T00:13:47.076532Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-jr7","depends_on_id":"simple-agent-harness-d3v","type":"blocks","created_at":"2026-02-14T23:50:31.225368Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-mxg","title":"Implement prompt prepend_commands for dynamic prompt construction","description":"Support [prompt] config section with file and prepend_commands fields. Read prompt from file, run each prepend command and capture stdout, prepend non-empty outputs to prompt separated by newline-dash-newline. Empty command output is silently skipped. This replaces inline bash logic for injecting performance briefs. Acceptance: prompt is correctly assembled with prepended command outputs. See PRD: Prompt Injection section.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:49:10.212331Z","created_by":"Austin King","updated_at":"2026-02-15T01:53:18.846511Z","closed_at":"2026-02-15T01:53:18.846511Z","close_reason":"Implement prompt prepend_commands for dynamic prompt construction","dependencies":[{"issue_id":"simple-agent-harness-mxg","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:49.043389Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-mxg","depends_on_id":"simple-agent-harness-d3v","type":"blocks","created_at":"2026-02-14T23:50:50.339371Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-p0y","title":"Implement main runner loop orchestration","description":"Implement runner.rs: the core loop that ties all modules together. For each iteration: (1) check STOP file, (2) read and prepare prompt from prompt_file, (3) spawn agent session, (4) start watchdog alongside session, (5) on completion check output size and retry if needed, (6) update iteration counters (productive + global), (7) apply inter-iteration delay. Track productive iterations vs max_iterations. The runner owns the iteration state and delegates to session, watchdog, retry, and signals modules. Acceptance: can run N productive iterations with a mock agent command (e.g. 'echo hello'), handles empty sessions with retries, stops on max_iterations. See PRD: Core Behavior, Session Lifecycle.","status":"closed","priority":0,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:58.908464Z","created_by":"Austin King","updated_at":"2026-02-15T00:22:58.535681Z","closed_at":"2026-02-15T00:22:58.535681Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-p0y","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:34.058289Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-p0y","depends_on_id":"simple-agent-harness-d3v","type":"blocks","created_at":"2026-02-14T23:50:35.313584Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-p0y","depends_on_id":"simple-agent-harness-fvr","type":"blocks","created_at":"2026-02-14T23:50:36.835817Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-p0y","depends_on_id":"simple-agent-harness-jr7","type":"blocks","created_at":"2026-02-14T23:50:39.029115Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-p0y","depends_on_id":"simple-agent-harness-7rx","type":"blocks","created_at":"2026-02-14T23:50:40.930624Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-r43","title":"Implement --quiet mode for minimal output","description":"When --quiet flag is passed, suppress per-iteration banners and info-level messages. Only show errors and the final summary line. Integrate with tracing subscriber to filter log levels based on quiet/verbose flags: --quiet = error only, default = info, --verbose = debug + agent output interleaving. Acceptance: --quiet suppresses info logs, --verbose shows debug. See PRD: CLI Interface.","status":"open","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:49:48.921881Z","created_by":"Austin King","updated_at":"2026-02-14T23:49:53.378028Z","dependencies":[{"issue_id":"simple-agent-harness-r43","depends_on_id":"simple-agent-harness-yyb","type":"blocks","created_at":"2026-02-14T23:50:56.849881Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-t0t","title":"Implement JSONL event log for external tooling","description":"Optionally write harness-events.jsonl (configured via [output] event_log). Append one JSON line per significant state transition: session_complete events with fields ts, event, iteration, global, output_bytes, exit_code, duration_secs, committed, retries, rate_limited. File is append-only, one line per session. Designed for self-improvement tool ingestion. Acceptance: after N iterations, event log has N entries, each valid JSON. See PRD: Event Log section.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:48.41639Z","created_by":"Austin King","updated_at":"2026-02-15T01:25:32.653407Z","closed_at":"2026-02-15T01:25:32.653407Z","close_reason":"Implement JSONL event log for external tooling","dependencies":[{"issue_id":"simple-agent-harness-t0t","depends_on_id":"simple-agent-harness-p0y","type":"blocks","created_at":"2026-02-14T23:50:46.393057Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-utz","title":"Implement configuration loading and CLI argument parsing","description":"Implement config.rs and CLI parsing in main.rs. Config struct with serde derives, all fields from PRD [session], [agent], [watchdog], [retry], [backoff], [shutdown] sections. Load from harness.toml with compiled defaults for every field (so an empty file is valid). CLI flags via clap derive: --config, --prompt, --output-dir, --timeout, --retries, --dry-run, -v, -q, --status, plus positional MAX_ITERATIONS. Implement precedence: CLI flags \u003e harness.toml \u003e defaults. Acceptance: unit tests for default config, TOML loading, and CLI override merging. See PRD sections: Configuration, CLI Interface.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:09.799333Z","created_by":"Austin King","updated_at":"2026-02-15T00:03:47.416239Z","closed_at":"2026-02-15T00:03:47.416239Z","close_reason":"Implement config loading, CLI override merging, and unit tests","dependencies":[{"issue_id":"simple-agent-harness-utz","depends_on_id":"simple-agent-harness-ewc","type":"blocks","created_at":"2026-02-14T23:50:27.460281Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-yyb","title":"Implement structured console logging with tracing","description":"Set up tracing and tracing-subscriber for structured log output. Format: [timestamp] [LEVEL] key=value pairs. Keys include: iteration, global, status, pid, watchdog, stale_secs, limit, retry, output_bytes, committed. Agent subprocess output goes to JSONL file only, not console (unless --verbose). Replace any println! calls with tracing macros. Acceptance: log output matches PRD format examples. See PRD: Console Output section.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:39.755099Z","created_by":"Austin King","updated_at":"2026-02-15T01:20:12.417214Z","closed_at":"2026-02-15T01:20:12.417214Z","close_reason":"Implement structured console logging with tracing","dependencies":[{"issue_id":"simple-agent-harness-yyb","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:45.148718Z","created_by":"Austin King"}]}
