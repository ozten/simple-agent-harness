{"id":"simple-agent-harness-0lk","title":"Add file resolution data model and cache","description":"Define FileResolution struct with task_id, base_commit, intent_hash, and mappings (concept -\u003e resolved_files + resolved_modules). Include derived fields: affected_modules, blast_radius (transitive dependents), boundary_signatures. Add DB table and caching layer keyed by commit hash — invalidates every time main advances. Ref: PRD section 'Layer 2: File Resolution'. New additions to src/intent.rs or new src/file_resolution.rs.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:11:34.340919Z","created_by":"Austin King","updated_at":"2026-02-15T21:50:15.624962Z","closed_at":"2026-02-15T21:50:15.624962Z","close_reason":"Add file resolution data model and cache"}
{"id":"simple-agent-harness-0t2","title":"Rate limit detection must only inspect system-level events, not tool output content","description":"The rate limit detection logic must not grep the entire JSONL output stream. When the agent reads source files that mention rate limiting (e.g., SPEC.md documenting the rate limit feature), naive pattern matching produces false positives and causes the loop to exit prematurely.\n\nFix applied in ralph-wiggums-loop.sh: check_rate_limited() now only inspects the final type=result event for is_error:true or subtype:error before checking for rate limit keywords.\n\nThe Rust harness (runner.rs / metrics.rs) needs the same approach:\n- Only check the session result metadata (exit code, error type) for rate limit signals\n- Never grep raw JSONL content that includes tool_result payloads\n- A successful session (is_error=false, subtype=success) should never be classified as rate limited regardless of output content","status":"closed","priority":3,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-15T01:10:05.841494Z","created_by":"Austin King","updated_at":"2026-02-15T02:42:03.876926Z","closed_at":"2026-02-15T02:42:03.876926Z","close_reason":"Fix rate limit detection false positives: only inspect final result event"}
{"id":"simple-agent-harness-11h","title":"Implement brief command with improvement context output","description":"Implement 'blacksmith brief' CLI command that generates a performance feedback snippet for prompt injection. Queries open improvements from DB, formats them as markdown with ref, category, and title. Output format per PRD: '## OPEN IMPROVEMENTS (N of M)' section listing each open improvement. Returns empty string (no output) if no DB exists. PRD ref: Brief command output, Loop Integration \u003e Pre-session. Files: new src/brief.rs, src/main.rs (wire subcommand), src/db.rs (query helpers).","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:18.281494Z","created_by":"Austin King","updated_at":"2026-02-15T13:58:02.293862Z","closed_at":"2026-02-15T13:58:02.293862Z","close_reason":"Implement brief command with improvement context output","dependencies":[{"issue_id":"simple-agent-harness-11h","depends_on_id":"simple-agent-harness-evl","type":"blocks","created_at":"2026-02-15T13:28:13.42321Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-1jv","title":"Implement git worktree lifecycle management","description":"Implement worktree creation from main: git worktree add .blacksmith/worktrees/worker-{N}-{bead-id} main. Implement worktree cleanup after successful integration. Track worktree paths in worker_assignments table. Handle edge cases: worktree already exists, main branch not available, cleanup of orphaned worktrees. Reference: SPEC-v3-agents.md lines 486-489, 547-549. Key files: src/coordinator.rs.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:54:39.978828Z","created_by":"Austin King","updated_at":"2026-02-15T15:44:41.202495Z","closed_at":"2026-02-15T15:44:41.202495Z","close_reason":"Implement git worktree lifecycle management","dependencies":[{"issue_id":"simple-agent-harness-1jv","depends_on_id":"simple-agent-harness-ib1","type":"blocks","created_at":"2026-02-15T14:56:56.450358Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-1ky","title":"Implement scheduler for assigning beads to idle workers","description":"Implement scheduler that runs when a worker becomes idle. Query beads for ready work (open status, all deps closed). Filter by affected set overlap with in-progress tasks. Assign highest-priority non-conflicting task. On assignment: update bead to in_progress, create worktree, spawn worker. The next_assignable_tasks function returns tasks whose affected sets don't overlap with any in-progress task. Reference: SPEC-v3-agents.md lines 462-489. Key files: src/coordinator.rs, src/scheduler.rs.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:55:00.844096Z","created_by":"Austin King","updated_at":"2026-02-15T15:55:12.163479Z","closed_at":"2026-02-15T15:55:12.163479Z","close_reason":"Implement scheduler for assigning beads to idle workers","dependencies":[{"issue_id":"simple-agent-harness-1ky","depends_on_id":"simple-agent-harness-mjx","type":"blocks","created_at":"2026-02-15T14:57:00.543096Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-1ky","depends_on_id":"simple-agent-harness-f9m","type":"blocks","created_at":"2026-02-15T14:57:01.849643Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-1ln","title":"V1: Make counter save atomic (write-rename)","status":"open","priority":3,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T16:34:51.735669Z","created_by":"Austin King","updated_at":"2026-02-16T16:34:51.735669Z"}
{"id":"simple-agent-harness-1n9","title":"V3.5: Add --force and --export flags to blacksmith init","description":"Basic init command exists but lacks --force (overwrite with fresh defaults) and --export (copy to project root for git committing). Depends on embedded defaults existing.\n\n## Done when\n- [ ] --force flag overwrites existing .blacksmith/ files with fresh defaults\n- [ ] --export copies PROMPT.md and skills to project root\n- [ ] Both flags documented in --help\n\n## Affected files\n- src/main.rs (modified - CLI flags + handler)","status":"open","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T16:29:28.212114Z","created_by":"Austin King","updated_at":"2026-02-16T16:29:28.212114Z","dependencies":[{"issue_id":"simple-agent-harness-1n9","depends_on_id":"simple-agent-harness-auh","type":"blocks","created_at":"2026-02-16T16:30:09.641194Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-1nm","title":"Document: Deployment Model (V3.5)","description":"Write docs/deployment-model.md documenting .blacksmith/ directory and embedded defaults.\n\n## Content\n\nBased on prd/SPEC-v4-deploy-self-improvement.md:\n- .blacksmith/ directory structure\n- Config resolution order\n- Embedded defaults (PROMPT.md, skills, config)\n- First-run extraction\n- blacksmith init command\n- blacksmith finish subcommand\n- Worktree provisioning (skills copy)\n- Self-improvement architecture (two-speed feedback)\n\n## Verification\n\nRead src/data_dir.rs, src/migrate.rs:\n- Verify directory structure creation\n- Verify embedded assets (check for defaults/ directory or include_str!)\n- Verify init command\n- Check finish subcommand (if implemented)\n- Verify worktree provisioning\n\nFile beads for missing V3.5 features.\n\n## Affected Files\n\n- docs/deployment-model.md (new)","design":"DESCRIPTION\nWrite docs/deployment-model.md documenting .blacksmith/ directory and embedded defaults.\n\n## Content\n\nBased on prd/SPEC-v4-deploy-self-improvement.md:\n- .blacksmith/ directory structure\n- Config resolution order\n- Embedded defaults (PROMPT.md, skills, config)\n- First-run extraction\n- blacksmith init command\n- blacksmith finish subcommand\n- Worktree provisioning (skills copy)\n- Self-improvement architecture (two-speed feedback)\n\n## Verification\n\nRead src/data_dir.rs, src/migrate.rs:\n- Verify directory structure creation\n- Verify embedded assets (check for defaults/ directory or include_str!)\n- Verify init command\n- Check finish subcommand (if implemented)\n- Verify worktree provisioning\n\nFile beads for missing V3.5 features.\n\n## Affected Files\n\n- docs/deployment-model.md (new)\n\nDESIGN\nDESCRIPTION\nWrite docs/deployment-model.md documenting .blacksmith/ directory and embedded defaults.\n\n## Content\n\nBased on prd/SPEC-v4-deploy-self-improvement.md:\n- .blacksmith/ directory structure\n- Config resolution order\n- Embedded defaults (PROMPT.md, skills, config)\n- First-run extraction\n- blacksmith init command\n- blacksmith finish subcommand\n- Worktree provisioning (skills copy)\n- Self-improvement architecture (two-speed feedback)\n\n## Verification\n\nRead src/data_dir.rs, src/migrate.rs:\n- Verify directory structure creation\n- Verify embedded assets (check for defaults/ directory or include_str!)\n- Verify init command\n- Check finish subcommand (if implemented)\n- Verify worktree provisioning\n\nFile beads for missing V3.5 features.\n\n## Affected Files\n\n- docs/deployment-model.md (new)\n\n\naffected: docs/deployment-model.mdNOTES\n\naffected: docs/deployment-model.md","notes":"Reopened: docs/deployment-model.md not created","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:14:40.145461Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:36.813452Z","closed_at":"2026-02-16T17:01:30.711112Z","close_reason":"Documentation files verified against source code and corrected where needed.","dependencies":[{"issue_id":"simple-agent-harness-1nm","depends_on_id":"simple-agent-harness-2kb","type":"blocks","created_at":"2026-02-16T16:15:55.264764Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-1u6","title":"Migrate file path construction to use storage.data_dir","description":"Replace all hardcoded path construction (output_dir, counter_file, output_prefix, status file) to use the new DataDir struct from .blacksmith/. Session output files become .blacksmith/sessions/{N}.jsonl. Counter becomes .blacksmith/counter. Status becomes .blacksmith/status. DB becomes .blacksmith/blacksmith.db. Deprecate session.output_prefix and session.counter_file config keys with warnings. Reference: SPEC-v3-agents.md lines 56-76. Key files: src/config.rs, src/runner.rs, src/session.rs, src/status.rs, src/db.rs.","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T14:53:25.324065Z","created_by":"Austin King","updated_at":"2026-02-15T15:07:26.11886Z","closed_at":"2026-02-15T15:07:26.11886Z","close_reason":"Migrate file path construction to use storage.data_dir","dependencies":[{"issue_id":"simple-agent-harness-1u6","depends_on_id":"simple-agent-harness-ib1","type":"blocks","created_at":"2026-02-15T14:56:41.175394Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-25s","title":"Add PROMPT.md template variable substitution","description":"Add template variable substitution to PROMPT.md assembly. The coordinator reads PROMPT.md and replaces placeholders like {check_command}, {test_command}, {lint_command}, {format_command} with values from [finish] config before passing the prompt to agents. This makes PROMPT.md language-agnostic — one template works for Rust, TypeScript, Go, Python. PRD ref: Milestone 6.\n\n## Done when\n- [ ] prompt.rs (or coordinator) substitutes {check_command} -\u003e config.finish.check, etc.\n- [ ] Substitution handles missing optional values (lint, format) by removing the placeholder line\n- [ ] defaults/PROMPT.md uses {check_command} and {test_command} placeholders\n- [ ] Unrecognized {placeholders} are left as-is (no crash on unknown vars)\n- [ ] New test: test_template_substitution — verifies all 4 vars substituted\n- [ ] New test: test_template_missing_optional — verifies optional vars removed cleanly\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + any new tests)\n\n## Verify\n- Run: cargo test test_template_substitution -- --nocapture\n- Expect: Test passes, all placeholders replaced with config values\n\n## Affected files\n- src/prompt.rs (modified — add substitute_template_vars() function)\n- src/coordinator.rs (modified — call substitution before passing prompt to agents)\n- defaults/PROMPT.md (modified — use template placeholders)","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T02:35:04.759376Z","created_by":"Austin King","updated_at":"2026-02-16T02:55:59.887339Z","closed_at":"2026-02-16T02:55:59.887339Z","close_reason":"Implemented FinishConfig and PROMPT.md template variable substitution","dependencies":[{"issue_id":"simple-agent-harness-25s","depends_on_id":"simple-agent-harness-emh","type":"blocks","created_at":"2026-02-16T02:37:02.698412Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-260","title":"Implement improvement promotion cycle in coordinator","description":"Add improvement promotion logic to the coordinator's between-iteration step. When an improvement has been 'open' (active in briefs) for N sessions and the target metric improved, promote it by editing .blacksmith/PROMPT.md to incorporate the improvement permanently, then set status to 'promoted'. Only the coordinator edits PROMPT.md (never agents directly), preventing parallel write conflicts. PRD ref: Milestone 4 slow path.\n\n## Done when\n- [ ] Coordinator checks for promotable improvements between iterations\n- [ ] Promotion criteria: open for N sessions (configurable, default 5) AND target metric improved\n- [ ] Promoted improvements are appended to PROMPT.md in a structured section\n- [ ] Improvement status set to 'promoted' after successful PROMPT.md edit\n- [ ] Config: [improvements] auto_promote_after (u32), auto_promote_metric (String)\n- [ ] New test: test_promotion_edits_prompt — mock DB with mature improvement, verify PROMPT.md edited\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + any new tests)\n\n## Verify\n- Run: cargo test test_promotion_edits_prompt -- --nocapture\n- Expect: Test passes, PROMPT.md contains promoted improvement text\n\n## Affected files\n- src/coordinator.rs (modified — add promotion step between iterations)\n- src/improve.rs (modified — add promote_mature_improvements() function)\n- src/config.rs (modified — add ImprovementsConfig struct)\n- src/db.rs (modified — add query for promotable improvements)","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T02:35:03.559816Z","created_by":"Austin King","updated_at":"2026-02-16T02:56:15.371454Z","closed_at":"2026-02-16T02:56:15.371454Z","close_reason":"Implemented improvement promotion cycle: ImprovementsConfig in config.rs, promotable_improvements() in db.rs, promote_mature_improvements() in improve.rs, check_improvement_promotions() in coordinator.rs. All tests pass (1175/1175).","dependencies":[{"issue_id":"simple-agent-harness-260","depends_on_id":"simple-agent-harness-945","type":"blocks","created_at":"2026-02-16T02:37:01.511914Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-2kb","title":"Create docs/ directory structure and README","description":"Create the docs/ directory and write docs/README.md as the navigation hub.\n\n## Task\n\n1. Create docs/ directory\n2. Write docs/README.md with:\n   - Brief overview of Blacksmith\n   - Table of contents linking to all other docs\n   - Quick navigation to key topics\n   - Links to PRD specs for reference\n\n## Verify\n\n```bash\ntest -d docs \u0026\u0026 test -f docs/README.md\ngrep -q \"Getting Started\" docs/README.md\n```\n\n## Affected Files\n\n- docs/ (new)\n- docs/README.md (new)","design":"Create the docs/ directory and write docs/README.md as the navigation hub.\n\n## Task\n\n1. Create docs/ directory\n2. Write docs/README.md with:\n   - Brief overview of Blacksmith\n   - Table of contents linking to all other docs\n   - Quick navigation to key topics\n   - Links to PRD specs for reference\n\n## Verify\n\n```bash\ntest -d docs \u0026\u0026 test -f docs/README.md\ngrep -q \"Getting Started\" docs/README.md\n```\n\n## Affected Files\n\n- docs/ (new)\n- docs/README.md (new)\n\naffected: docs/, docs/README.md","notes":"Reopened: docs/ directory not created","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:14:15.585907Z","created_by":"Austin King","updated_at":"2026-02-16T17:13:41.636398Z","closed_at":"2026-02-16T17:01:26.325765Z","close_reason":"docs/ directory and docs/README.md exist and are verified."}
{"id":"simple-agent-harness-2pg","title":"Integrate brief injection into session loop pre-session step","description":"Modify the prompt assembly step in runner.rs to auto-generate the brief and insert it between prepend_commands output and the prompt file content. Sequence: run prepend_commands, generate brief from blacksmith.db (built-in), read prompt file, assemble with separators. Brief is silently skipped when no database exists (first run). PRD ref: Loop Integration \u003e Pre-session: Brief Injection, Loop Lifecycle diagram step 2b. Files: src/runner.rs, src/prompt.rs (add brief injection step).","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:19.840568Z","created_by":"Austin King","updated_at":"2026-02-15T14:00:59.876899Z","closed_at":"2026-02-15T14:00:59.876899Z","close_reason":"Integrate brief injection into session loop prompt assembly","dependencies":[{"issue_id":"simple-agent-harness-2pg","depends_on_id":"simple-agent-harness-11h","type":"blocks","created_at":"2026-02-15T13:28:15.084547Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-2su","title":"Implement aider agent adapter","description":"Implement the aider adapter for parsing Aider's session output / chat log. Supported metrics: turns.total, cost.estimate_usd (Aider reports cost), session.output_bytes, session.exit_code, session.duration_secs. Reference: SPEC-v3-agents.md lines 312-319. Key files: src/adapters.rs.","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:54:22.332329Z","created_by":"Austin King","updated_at":"2026-02-15T18:14:45.589884Z","closed_at":"2026-02-15T18:14:45.589884Z","close_reason":"Implement aider agent adapter","dependencies":[{"issue_id":"simple-agent-harness-2su","depends_on_id":"simple-agent-harness-wi2","type":"blocks","created_at":"2026-02-15T14:56:52.327345Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-33k","title":"Add circular dependency detection for modules","description":"Detect circular dependencies at the module level using the import graph. Module A imports B, B imports A makes affected sets transitive in both directions. Use existing cycle_detect.rs infrastructure if applicable, adapted for module-level (not task-level) cycles. Return list of cycles found. Ref: PRD section 'Circular dependencies'. Depends on import graph parser and module boundary detection.","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T20:11:07.419559Z","created_by":"Austin King","updated_at":"2026-02-16T00:14:39.487833Z","closed_at":"2026-02-16T00:14:39.487833Z","close_reason":"Add circular dependency detection for modules","dependencies":[{"issue_id":"simple-agent-harness-33k","depends_on_id":"simple-agent-harness-4a1","type":"blocks","created_at":"2026-02-15T20:13:40.015443Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-33k","depends_on_id":"simple-agent-harness-75u","type":"blocks","created_at":"2026-02-15T20:13:40.133597Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-34d","title":"Add architecture agent configuration knobs","description":"Add configurable knobs to config.rs for the architecture agent: fan_in_threshold (default 0.3), integration_loop_max (default 5), expansion_event_threshold (default 5 in 20 tasks), metadata_drift_sensitivity (default 3x increase), refactor_auto_approve (default false). Load from [architecture] section in config file. Include conservative and aggressive presets. Ref: PRD section 'Knobs' table. No dependencies — pure config additions.\n\n## Done when\n- [ ] ArchitectureConfig struct with all 5 knobs and defaults in config.rs\n- [ ] Knobs load from [architecture] section in blacksmith.toml\n- [ ] Missing [architecture] section uses defaults (no error)\n- [ ] `blacksmith config` output shows architecture knobs\n- [ ] Conservative preset (higher thresholds) and aggressive preset (lower thresholds) are defined as named constants\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + config parsing tests)\n\n## Verify\n- Run: cargo test architecture_config\n- Run: Add [architecture] section to blacksmith.toml with non-default values, run `blacksmith config`, confirm values are displayed\n- Expect: All 5 knobs parse correctly, defaults work when section missing\n\n## Affected files\n- src/config.rs (modified — add ArchitectureConfig struct and [architecture] parsing)\n- src/main.rs (modified — add architecture knobs to `blacksmith config` output)","status":"closed","priority":3,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T20:13:05.566598Z","created_by":"Austin King","updated_at":"2026-02-16T01:45:23.759585Z","closed_at":"2026-02-16T01:45:23.759585Z","close_reason":"All architecture config knobs implemented: struct, defaults, presets, validation, TOML parsing, dry-run output, and tests"}
{"id":"simple-agent-harness-361","title":"Add drift-triggered architecture review","description":"When metadata_regen detects significant drift (concept resolving to 3x more files than before), automatically queue an architecture review. Currently drift detection exists in metadata_regen.rs but takes no action. Wire it to trigger the architecture runner. PRD ref: 'Metadata drift' signal in 'Historical Signal from the Task System' section and metadata_drift_sensitivity knob.\n\n## Done when\n- [ ] After regenerate_after_refactor() detects drift above threshold, architecture_runner.run_if_needed(DriftTrigger) is called\n- [ ] DriftReport is passed to the architecture runner as context\n- [ ] Config knob metadata_drift_sensitivity (default 3.0) controls the threshold\n- [ ] Drift-triggered reviews include the drifting concepts in the analysis context\n- [ ] No infinite loops: drift-triggered analysis doesn't itself trigger more drift checks\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes\n\n## Verify\n- Run: cargo test drift_triggered_review -- --nocapture\n- Expect: Test showing drift above threshold triggers architecture review\n\n## Affected files\n- src/metadata_regen.rs (modified - call architecture runner on drift)\n- src/architecture_runner.rs (modified - add DriftTrigger variant)\n- src/config.rs (modified - add metadata_drift_sensitivity knob)","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T03:43:10.75556Z","created_by":"Austin King","updated_at":"2026-02-16T06:21:41.069764Z","closed_at":"2026-02-16T06:21:41.069764Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-361","depends_on_id":"simple-agent-harness-gkx","type":"blocks","created_at":"2026-02-16T03:44:45.035153Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-361","depends_on_id":"simple-agent-harness-5u6","type":"blocks","created_at":"2026-02-16T03:44:45.160677Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-374","title":"Comprehensive Documentation \u0026 Implementation Audit","description":"Create complete documentation for Blacksmith based on PRD specs (V1-V5) and verify implementation.\n\nThis epic encompasses:\n1. Creating atomic documentation files under ./docs/ for each major subsystem\n2. Reading source code to verify features are implemented as spec'd\n3. Filing follow-up beads for any bugs, missing features, or improvements found\n\n## Structure\n\nThe docs should be organized as:\n- docs/README.md - High-level overview and navigation\n- docs/getting-started.md - Installation, quick start, first run\n- docs/core-loop.md - Session lifecycle, watchdog, retries (V1)\n- docs/metrics-and-improvements.md - Events, observations, improvements (V2)\n- docs/multi-agent-coordination.md - Workers, scheduler, integration (V3)\n- docs/deployment-model.md - .blacksmith/ directory, embedded defaults (V3.5)\n- docs/architecture-analysis.md - Automated architecture agent (V5)\n- docs/configuration.md - Complete config reference\n- docs/cli-reference.md - All commands and subcommands\n- docs/adapters.md - Agent adapter system\n- docs/troubleshooting.md - Common issues and solutions\n\n## Verification Tasks\n\nFor each subsystem documented, verify:\n- Feature is implemented (check src/ modules)\n- Matches spec behavior\n- Has tests (check tests/)\n- Works as documented\n- File bead for any gaps found\n\n## Deliverables\n\n1. Complete docs/ directory with all files\n2. Updated top-level README.md pointing to docs/\n3. List of follow-up beads filed for bugs/improvements\n4. Summary report of implementation status vs specs\n\n## Done When\n\n- [ ] All documentation files created and committed\n- [ ] Each doc file verified against source code\n- [ ] README.md updated with links to docs/\n- [ ] Follow-up beads filed for any issues found\n- [ ] Implementation status report generated\n- [ ] Quality gates pass (cargo check, cargo test)\n\n## Affected Files\n\n- docs/ (new directory)\n- README.md (update)\n- .beads/issues.jsonl (new issues filed)","design":"DESCRIPTION\nCreate complete documentation for Blacksmith based on PRD specs (V1-V5) and verify implementation.\n\nThis epic encompasses:\n1. Creating atomic documentation files under ./docs/ for each major subsystem\n2. Reading source code to verify features are implemented as spec'd\n3. Filing follow-up beads for any bugs, missing features, or improvements found\n\n## Structure\n\nThe docs should be organized as:\n- docs/README.md - High-level overview and navigation\n- docs/getting-started.md - Installation, quick start, first run\n- docs/core-loop.md - Session lifecycle, watchdog, retries (V1)\n- docs/metrics-and-improvements.md - Events, observations, improvements (V2)\n- docs/multi-agent-coordination.md - Workers, scheduler, integration (V3)\n- docs/deployment-model.md - .blacksmith/ directory, embedded defaults (V3.5)\n- docs/architecture-analysis.md - Automated architecture agent (V5)\n- docs/configuration.md - Complete config reference\n- docs/cli-reference.md - All commands and subcommands\n- docs/adapters.md - Agent adapter system\n- docs/troubleshooting.md - Common issues and solutions\n\n## Verification Tasks\n\nFor each subsystem documented, verify:\n- Feature is implemented (check src/ modules)\n- Matches spec behavior\n- Has tests (check tests/)\n- Works as documented\n- File bead for any gaps found\n\n## Deliverables\n\n1. Complete docs/ directory with all files\n2. Updated top-level README.md pointing to docs/\n3. List of follow-up beads filed for bugs/improvements\n4. Summary report of implementation status vs specs\n\n## Done When\n\n- [ ] All documentation files created and committed\n- [ ] Each doc file verified against source code\n- [ ] README.md updated with links to docs/\n- [ ] Follow-up beads filed for any issues found\n- [ ] Implementation status report generated\n- [ ] Quality gates pass (cargo check, cargo test)\n\n## Affected Files\n\n- docs/ (new directory)\n- README.md (update)\n- .beads/issues.jsonl (new issues filed)\n\n\naffected: docs/, README.md, .beads/issues.jsonlNOTES","notes":"Reopened: Work not completed. No docs created, no audits done.","status":"closed","priority":1,"issue_type":"epic","owner":"shout@ozten.com","created_at":"2026-02-16T16:14:07.157531Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:11.548542Z","closed_at":"2026-02-16T17:01:43.692823Z","close_reason":"All docs verified against source code, inaccuracies fixed (arch CLI, bd-finish.sh, bogus [finish] config). 3 follow-up beads filed: dead code cleanup (ahur), finish subcommand (gaaf), template vars (cpy9). All 1147 tests pass.","dependencies":[{"issue_id":"simple-agent-harness-374","depends_on_id":"simple-agent-harness-qf1","type":"blocks","created_at":"2026-02-16T16:16:02.19098Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-374","depends_on_id":"simple-agent-harness-8ci","type":"blocks","created_at":"2026-02-16T16:16:02.313399Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-374","depends_on_id":"simple-agent-harness-w0s","type":"blocks","created_at":"2026-02-16T16:16:02.437753Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-374","depends_on_id":"simple-agent-harness-gyc","type":"blocks","created_at":"2026-02-16T16:16:02.559391Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-374","depends_on_id":"simple-agent-harness-dq5","type":"blocks","created_at":"2026-02-16T16:16:02.686767Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-3dl","title":"Implement status file with atomic JSON writes","description":"Write harness.status as JSON on every state transition. Use atomic write pattern: write to temp file then rename. JSON fields: pid, state, iteration, max_iterations, global_iteration, output_file, output_bytes, session_start, last_update, last_completed_iteration, last_committed, consecutive_rate_limits. States: starting, pre_hooks, session_running, watchdog_kill, retrying, post_hooks, rate_limited_backoff, idle, shutting_down. Acceptance: status file is valid JSON after each state change, rename is atomic. See PRD: Status File section.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:24.730616Z","created_by":"Austin King","updated_at":"2026-02-15T01:14:02.979012Z","closed_at":"2026-02-15T01:14:02.979012Z","close_reason":"Implement status file with atomic JSON writes","dependencies":[{"issue_id":"simple-agent-harness-3dl","depends_on_id":"simple-agent-harness-p0y","type":"blocks","created_at":"2026-02-14T23:50:42.105114Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-3mu","title":"Wire multi-agent coordinator into blacksmith run","description":"When workers.max \u003e 1, blacksmith run transitions from serial loop to coordinated multi-agent mode. Replace the serial loop with coordinator startup. Single-worker mode (workers.max = 1 or omitting [workers]) behaves identically to V2 serial loop. Projects without beads continue to work in single-worker mode with prompt-file workflow. Reference: SPEC-v3-agents.md lines 398-427, 917-919. Key files: src/runner.rs, src/main.rs, src/coordinator.rs.","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T14:55:27.867079Z","created_by":"Austin King","updated_at":"2026-02-15T15:58:27.575242Z","closed_at":"2026-02-15T15:58:27.575242Z","close_reason":"Wire multi-agent coordinator into blacksmith run","dependencies":[{"issue_id":"simple-agent-harness-3mu","depends_on_id":"simple-agent-harness-1ky","type":"blocks","created_at":"2026-02-15T14:57:06.103894Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-3pa","title":"Implement integration queue and merge-main-into-branch step","description":"Implement sequential integration queue that processes completed worktrees one at a time. In the worker's worktree: merge main into the branch (pull main into branch, NOT push branch to main). Only one integration runs at a time to keep main's history linear. Workers continue coding while one task integrates. Reference: SPEC-v3-agents.md lines 555-607. Key files: src/coordinator.rs, new src/integrator.rs.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:54:51.18421Z","created_by":"Austin King","updated_at":"2026-02-15T16:03:58.553383Z","closed_at":"2026-02-15T16:03:58.553383Z","close_reason":"Implement integration queue and merge-main-into-branch step","dependencies":[{"issue_id":"simple-agent-harness-3pa","depends_on_id":"simple-agent-harness-3mu","type":"blocks","created_at":"2026-02-15T14:57:03.839034Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-3su","title":"Implement periodic reconciliation with full test suite","description":"After every N successful integrations (configurable via reconciliation.every, default 3), run the full test suite on main. If failures detected, flag the last N integrated tasks for human review. Add reconciliation.every config field. This catches cross-task semantic bugs that pass individual integration. Reference: SPEC-v3-agents.md lines 609-624. Key files: src/integrator.rs, src/config.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:55:27.0182Z","created_by":"Austin King","updated_at":"2026-02-15T17:32:03.000286Z","closed_at":"2026-02-15T17:32:03.000286Z","close_reason":"Implement periodic reconciliation with full test suite","dependencies":[{"issue_id":"simple-agent-harness-3su","depends_on_id":"simple-agent-harness-3pa","type":"blocks","created_at":"2026-02-15T14:57:10.795511Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-47t","title":"Wire ensure_fresh_metadata into scheduler","description":"Before assigning a task to a worker, the scheduler should call ensure_fresh_metadata() from metadata_regen.rs to verify the task's Layer 2 file resolution is current. If base_commit doesn't match current main HEAD, regenerate Layer 2. This implements the 'On scheduling' regeneration strategy from the PRD. Only tasks that are candidates for assignment pay the regeneration cost.\n\n## Done when\n- [ ] scheduler::schedule_next() calls metadata_regen::ensure_fresh_metadata() before assignment\n- [ ] If metadata is stale (base_commit != current HEAD), Layer 2 is regenerated\n- [ ] If metadata is fresh, no regeneration occurs (fast path)\n- [ ] Regenerated metadata updates the task's affected_files for conflict detection\n- [ ] Tasks without intent analysis (no Layer 1) are skipped gracefully\n- [ ] Regeneration errors are logged but don't block scheduling (fallback to existing metadata)\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes\n\n## Verify\n- Run: cargo test scheduler_fresh_metadata -- --nocapture\n- Expect: Test showing stale metadata is regenerated before assignment\n\n## Affected files\n- src/scheduler.rs (modified - add ensure_fresh_metadata call in schedule_next)\n- src/metadata_regen.rs (modified if needed - ensure pub interface)","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T03:43:08.402955Z","created_by":"Austin King","updated_at":"2026-02-16T06:11:02.682164Z","closed_at":"2026-02-16T06:11:02.682164Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-47t","depends_on_id":"simple-agent-harness-krl","type":"blocks","created_at":"2026-02-16T03:44:44.278075Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-4a1","title":"Add codebase import graph parser","description":"Parse Rust use/mod statements to build a directed graph of file-to-file imports. Given a repo root, walk all .rs files, extract imports, and return an adjacency list (HashMap\u003cPathBuf, Vec\u003cPathBuf\u003e\u003e). This is the foundation for fan-in analysis, cycle detection, and blast radius computation in the architecture agent. Should handle: use crate::, mod declarations, pub use re-exports. Ref: PRD section 'Static Analysis of Current Codebase'. Lives in a new src/import_graph.rs.","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T20:10:39.487643Z","created_by":"Austin King","updated_at":"2026-02-15T23:56:16.737479Z","closed_at":"2026-02-15T23:56:16.737479Z","close_reason":"Verify import graph parser already implemented with 22 passing tests"}
{"id":"simple-agent-harness-4wc","title":"Implement historical signal correlator for architecture agent","description":"Overlay historical signals (expansion events, integration iterations, metadata drift) onto the module graph from structural analysis. Weight recent events more heavily. Identify modules that score high on BOTH structural smells AND historical failure signals as strong refactoring candidates. Modules with only structural smells but no operational problems are left alone. Ref: PRD section 'Analysis Process' steps 2-3. Depends on structural metrics aggregator, expansion event tracking, integration loop tracking, and metadata drift detection.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:12:34.866256Z","created_by":"Austin King","updated_at":"2026-02-16T00:37:08.569685Z","closed_at":"2026-02-16T00:37:08.569685Z","close_reason":"Implement historical signal correlator for architecture analysis","dependencies":[{"issue_id":"simple-agent-harness-4wc","depends_on_id":"simple-agent-harness-a9n","type":"blocks","created_at":"2026-02-15T20:13:59.087982Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-4wc","depends_on_id":"simple-agent-harness-74e","type":"blocks","created_at":"2026-02-15T20:13:59.207399Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-4wc","depends_on_id":"simple-agent-harness-ldy","type":"blocks","created_at":"2026-02-15T20:13:59.326741Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-4wc","depends_on_id":"simple-agent-harness-buv","type":"blocks","created_at":"2026-02-15T20:13:59.441583Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-4zi","title":"Wire end-to-end analysis pipeline","description":"Wire the full architecture analysis pipeline end-to-end: structural analysis → signal correlation → proposal generation → proposal validation → report. Currently each step works in isolation with tests. This bead connects them into a single `run_architecture_pipeline()` function that the analyze CLI and the architecture agent runner can both call. PRD ref: 'Analysis Process' stages 1-4 and 'Proposal Validation' section.\n\n## Done when\n- [ ] run_architecture_pipeline(repo_root, db_conn, config) → PipelineReport function exists\n- [ ] PipelineReport contains: structural_report, correlation_report, proposals (generated), validated_proposals\n- [ ] Pipeline calls structural_metrics::analyze() → signal_correlator::correlate() → proposal_generation::generate_proposals() → proposal_validation::validate() in sequence\n- [ ] Validated proposals are stored in DB via proposal persistence\n- [ ] Pipeline is callable from both CLI analyze command and architecture runner\n- [ ] Failed proposals (validation errors) are logged but don't halt the pipeline\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + pipeline integration test)\n\n## Verify\n- Run: cargo test architecture_pipeline -- --nocapture\n- Expect: Integration test that runs pipeline on a test repo, produces proposals\n\n## Affected files\n- src/architecture_pipeline.rs (new - orchestration module)\n- src/main.rs (modified - add mod architecture_pipeline, update analyze handler to use it)","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T03:43:00.844997Z","created_by":"Austin King","updated_at":"2026-02-16T06:06:27.516756Z","closed_at":"2026-02-16T06:06:27.516756Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-4zi","depends_on_id":"simple-agent-harness-xab","type":"blocks","created_at":"2026-02-16T03:44:44.404253Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-4zi","depends_on_id":"simple-agent-harness-98f","type":"blocks","created_at":"2026-02-16T03:44:44.528273Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-503","title":"Implement retention policy enforcement","description":"Add retention config field supporting last-N, Nd, all, and after-ingest modes. Implement cleanup logic that runs at loop start (step 2): delete compressed files beyond the retention window. last-N keeps N most recent sessions. Nd keeps sessions from last N days by mtime. all never deletes. after-ingest deletes immediately after successful ingestion. Reference: SPEC-v3-agents.md lines 124-169. Key files: src/config.rs, src/runner.rs, src/storage.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:53:44.000636Z","created_by":"Austin King","updated_at":"2026-02-15T16:11:58.660387Z","closed_at":"2026-02-15T16:11:58.660387Z","close_reason":"Implement retention policy enforcement with last-N, Nd, all, after-ingest modes","dependencies":[{"issue_id":"simple-agent-harness-503","depends_on_id":"simple-agent-harness-x1a","type":"blocks","created_at":"2026-02-15T14:56:44.102153Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-506","title":"Add progress and ETA to blacksmith run and --status output","description":"Show progress line after each session in blacksmith run: worker states, bead counts, ETA. Single-worker: '[iter N] bead completed in Xm (Y turns) | Progress: A/B beads | avg Xm/bead | ETA: ~Zm'. Multi-worker: worker states + progress + serial vs parallel ETA. Update blacksmith --status to show worker states, progress percentage, remaining beads, serial/parallel ETA, failed beads count. Reference: SPEC-v3-agents.md lines 783-811. Key files: src/runner.rs, src/status.rs, src/coordinator.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:56:04.921233Z","created_by":"Austin King","updated_at":"2026-02-15T17:57:05.858077Z","closed_at":"2026-02-15T17:57:05.858077Z","close_reason":"Add progress and ETA to blacksmith run and --status output","dependencies":[{"issue_id":"simple-agent-harness-506","depends_on_id":"simple-agent-harness-ml7","type":"blocks","created_at":"2026-02-15T14:57:16.253057Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-56j","title":"Add improvement recording to agent PROMPT.md workflow","description":"The blacksmith improve add/list infrastructure exists and works, but 0 improvements have been recorded across 73 sessions. The brief shows metrics but no institutional lessons. Need to add instructions to the agent PROMPT.md template telling agents to call 'blacksmith improve add' when they encounter patterns, mistakes, or process insights. Also consider auto-recording improvements from post-session analysis (e.g., if narration% \u003e 40% or cost spikes, auto-record an observation).","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T00:32:45.342865Z","created_by":"Austin King","updated_at":"2026-02-16T00:40:09.83032Z","closed_at":"2026-02-16T00:40:09.83032Z","close_reason":"Add improvement recording instructions to agent PROMPT.md workflow"}
{"id":"simple-agent-harness-5f1","title":"Add intent analysis data model and cache","description":"Define IntentAnalysis struct with task_id, content_hash (hash of title+description+acceptance criteria), and target_areas (Vec of concept+reasoning pairs). Add DB table and caching layer keyed by content_hash so analysis survives refactors. Intent analysis is the stable, expensive layer that only invalidates when issue content changes. Ref: PRD section 'Layer 1: Intent Analysis'. New file src/intent.rs with DB migration.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:11:31.863411Z","created_by":"Austin King","updated_at":"2026-02-15T20:45:08.14605Z","closed_at":"2026-02-15T20:45:08.14605Z","close_reason":"Add intent analysis data model and cache"}
{"id":"simple-agent-harness-5hg","title":"Enable 3 parallel agents in blacksmith.toml","description":"Switch from serial (workers.max=1) to parallel execution with 3 agents. Add [workers] section to blacksmith.toml: max=3, base_branch='main', worktrees_dir='worktrees'. Verify coordinator path is taken (coordinator::run vs runner::run), worktrees are created, and scheduling works with glob-based conflict detection. This is a config change + smoke test, not a code change — all coordinator infrastructure is already implemented. IMPORTANT: After making the config change, touch the STOP file so the running blacksmith process exits cleanly. The operator will then recompile (cargo build --release) and restart blacksmith with the new multi-agent config.","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T00:34:49.49402Z","created_by":"Austin King","updated_at":"2026-02-16T00:41:42.510506Z","closed_at":"2026-02-16T00:41:42.510506Z","close_reason":"Enable 3 parallel agents in blacksmith.toml","dependencies":[{"issue_id":"simple-agent-harness-5hg","depends_on_id":"simple-agent-harness-m6l","type":"blocks","created_at":"2026-02-16T00:34:54.298356Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-5hg","depends_on_id":"simple-agent-harness-82c","type":"blocks","created_at":"2026-02-16T00:43:59.711106Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-5hg","depends_on_id":"simple-agent-harness-vrq","type":"blocks","created_at":"2026-02-16T01:02:57.97281Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-5l3","title":"Document: Troubleshooting Guide","description":"Write docs/troubleshooting.md for common issues and solutions.\n\n## Content\n\nBased on known issues from MEMORY.md and PRD bugs:\n- Multiple coordinators running (singleton lock)\n- Stale worktrees on restart\n- Agents suspended (SIGTSTP)\n- Session files not compressed\n- 0-byte session files\n- Improvements not recording\n- Cycle deadlocks\n- Integration failures\n- Rate limit handling\n- Permission errors\n\nFor each issue:\n- Symptoms\n- Root cause\n- Solution/workaround\n- How to verify fix\n- Related bead (if open)\n\n## Verification\n\nRead MEMORY.md for known issues.\nCheck .beads/issues.jsonl for open bugs.\nReview recent git commits for bug fixes.\n\n## Affected Files\n\n- docs/troubleshooting.md (new)","design":"DESCRIPTION\nWrite docs/troubleshooting.md for common issues and solutions.\n\n## Content\n\nBased on known issues from MEMORY.md and PRD bugs:\n- Multiple coordinators running (singleton lock)\n- Stale worktrees on restart\n- Agents suspended (SIGTSTP)\n- Session files not compressed\n- 0-byte session files\n- Improvements not recording\n- Cycle deadlocks\n- Integration failures\n- Rate limit handling\n- Permission errors\n\nFor each issue:\n- Symptoms\n- Root cause\n- Solution/workaround\n- How to verify fix\n- Related bead (if open)\n\n## Verification\n\nRead MEMORY.md for known issues.\nCheck .beads/issues.jsonl for open bugs.\nReview recent git commits for bug fixes.\n\n## Affected Files\n\n- docs/troubleshooting.md (new)\n\nDESIGN\nDESCRIPTION\nWrite docs/troubleshooting.md for common issues and solutions.\n\n## Content\n\nBased on known issues from MEMORY.md and PRD bugs:\n- Multiple coordinators running (singleton lock)\n- Stale worktrees on restart\n- Agents suspended (SIGTSTP)\n- Session files not compressed\n- 0-byte session files\n- Improvements not recording\n- Cycle deadlocks\n- Integration failures\n- Rate limit handling\n- Permission errors\n\nFor each issue:\n- Symptoms\n- Root cause\n- Solution/workaround\n- How to verify fix\n- Related bead (if open)\n\n## Verification\n\nRead MEMORY.md for known issues.\nCheck .beads/issues.jsonl for open bugs.\nReview recent git commits for bug fixes.\n\n## Affected Files\n\n- docs/troubleshooting.md (new)\n\n\naffected: docs/troubleshooting.mdNOTES\n\naffected: docs/troubleshooting.md","notes":"Reopened: docs/troubleshooting.md not created","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:15:07.214814Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:37.935882Z","closed_at":"2026-02-16T17:01:30.718168Z","close_reason":"Documentation files verified against source code and corrected where needed.","dependencies":[{"issue_id":"simple-agent-harness-5l3","depends_on_id":"simple-agent-harness-2kb","type":"blocks","created_at":"2026-02-16T16:15:55.897113Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-5u6","title":"Add metadata invalidation hooks in integrator","description":"After a task integrates to main, mark all cached Layer 2 metadata as potentially stale. After a refactor task integrates, proactively regenerate Layer 2 for all pending tasks. This implements the 'On integration' and 'On refactor integration' regeneration strategies from the PRD. Uses metadata_regen::invalidate_on_integration() (lazy) and regenerate_after_refactor() (eager) which already exist.\n\n## Done when\n- [ ] integrator calls invalidate_on_integration(new_main_commit) after every successful task integration\n- [ ] integrator detects if the integrated task was a refactor (epoch boundary flag or task type)\n- [ ] If refactor: calls regenerate_after_refactor() for all pending tasks\n- [ ] If regular task: only invalidates (lazy strategy)\n- [ ] Drift detection results from regeneration are logged\n- [ ] Integration is not blocked by regeneration failures (best-effort)\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes\n\n## Verify\n- Run: cargo test integrator_invalidation -- --nocapture\n- Expect: Test showing metadata invalidated after integration, eager regen after refactor\n\n## Affected files\n- src/integrator.rs (modified - add invalidation/regeneration calls after integration)\n- src/metadata_regen.rs (modified if needed - ensure functions are pub)","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T03:43:09.598747Z","created_by":"Austin King","updated_at":"2026-02-16T06:14:57.750906Z","closed_at":"2026-02-16T06:14:57.750906Z","close_reason":"Implemented post-integration metadata hooks: invalidate_on_integration called after every successful integration, refactor detection via bd show --json, and regenerate_after_refactor for pending tasks on refactor integrations. All best-effort (failures logged, never block). 5 tests added covering normal invalidation, refactor regeneration, no-op, skip-no-intent, and empty-db cases.","dependencies":[{"issue_id":"simple-agent-harness-5u6","depends_on_id":"simple-agent-harness-47t","type":"blocks","created_at":"2026-02-16T03:44:44.908699Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-5vm","title":"Fix: README out of date with implementation","description":"Current README.md is V1-era and doesn't reflect V2+ features implemented.\n\n## Problem\n\nREADME.md:\n- Still references simple-agent-harness binary name (should be blacksmith)\n- Only documents V1 features (core loop, watchdog, retries)\n- No mention of metrics system, improvements, multi-agent, architecture analysis\n- Config examples are incomplete (missing many V2+ sections)\n- Doesn't mention .blacksmith/ directory structure\n\n## Expected\n\nREADME should:\n- Use correct binary name (blacksmith)\n- Be a brief landing page (\u003c100 lines)\n- Link to comprehensive docs/ for details\n- Highlight major features across all versions\n- Point to getting started guide\n\n## Fix\n\nThis will be resolved by the \"Update top-level README.md\" bead after docs/ is complete.\n\n## Affected Files\n\n- README.md","notes":"Reopened: Still valid - README out of date","status":"closed","priority":2,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T16:15:46.227532Z","created_by":"Austin King","updated_at":"2026-02-16T17:27:22.41311Z","closed_at":"2026-02-16T17:27:22.41311Z","close_reason":"README was rewritten as concise landing page in fcbc8a6, docs fixed in 257d26f. The reverted verbose README was the OLD version, not a fix.","dependencies":[{"issue_id":"simple-agent-harness-5vm","depends_on_id":"simple-agent-harness-qf1","type":"blocks","created_at":"2026-02-16T16:16:02.813714Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-5x6","title":"Implement --dry-run mode","description":"When --dry-run flag is passed: validate the resolved configuration (after merging CLI \u003e file \u003e defaults), print all resolved settings in a readable format, then exit without starting the loop. Useful for verifying config before long runs. Acceptance: --dry-run prints resolved config and exits 0 on valid config, exits non-zero with error on invalid config. See PRD: CLI Interface.","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:49:40.45134Z","created_by":"Austin King","updated_at":"2026-02-15T14:35:52.544507Z","closed_at":"2026-02-15T14:35:52.544507Z","close_reason":"Implement --dry-run mode with full config display and regex validation","dependencies":[{"issue_id":"simple-agent-harness-5x6","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:55.542394Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-5xe","title":"V5: Implement automatic architecture proposal generation from RefactorCandidates","description":"The signal correlator produces RefactorCandidate structs, and ProposalKind/RefactorProposal types exist in proposal_validation.rs, but there is no function to automatically transform candidates into concrete proposals. This is the missing link between analysis and action.\n\n## Done when\n- [ ] generate_proposals() function transforms RefactorCandidates into RefactorProposals\n- [ ] SplitModule proposals suggest concrete file structure based on god file clusters\n- [ ] BreakCycle proposals suggest dependency direction reversal or interface extraction\n- [ ] Proposals include all fields needed by validate_proposal()\n\n## Affected files\n- src/proposal_generation.rs (new) or src/proposal_validation.rs (modified)\n- src/signal_correlator.rs (modified - wire output to generation)","status":"open","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T16:29:31.429436Z","created_by":"Austin King","updated_at":"2026-02-16T16:29:31.429436Z","dependencies":[{"issue_id":"simple-agent-harness-5xe","depends_on_id":"simple-agent-harness-db7","type":"blocks","created_at":"2026-02-16T16:30:09.89812Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-6hk","title":"Add adapter config field and auto-detection from command name","description":"Add adapter field to agent config. Implement auto-detection: command containing 'claude' -\u003e claude adapter, 'codex' -\u003e codex, 'opencode' -\u003e opencode, 'aider' -\u003e aider, anything else -\u003e raw. Explicit adapter= overrides auto-detection. Create adapter registry/factory that returns the right adapter. Reference: SPEC-v3-agents.md lines 209-222. Key files: src/config.rs, src/adapters.rs.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:53:51.551344Z","created_by":"Austin King","updated_at":"2026-02-15T15:14:22.568885Z","closed_at":"2026-02-15T15:14:22.568885Z","close_reason":"Add adapter config field and auto-detection from command name","dependencies":[{"issue_id":"simple-agent-harness-6hk","depends_on_id":"simple-agent-harness-wi2","type":"blocks","created_at":"2026-02-15T14:56:47.099915Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-74e","title":"Add expansion event tracking for affected-set mismatches","description":"Track expansion events: when a coding agent discovers it needs modules not in its original metadata. Store predicted_modules vs actual_modules with expansion_reason and timestamp. DB table + recording API. Frequent expansions around the same module indicate poor boundary containment. Ref: PRD section 'Affected-set expansions'. Depends on file resolution data model.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:12:14.412942Z","created_by":"Austin King","updated_at":"2026-02-15T21:56:46.101717Z","closed_at":"2026-02-15T21:56:46.101717Z","close_reason":"Add expansion event tracking for affected-set mismatches","dependencies":[{"issue_id":"simple-agent-harness-74e","depends_on_id":"simple-agent-harness-0lk","type":"blocks","created_at":"2026-02-15T20:13:51.633049Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-75u","title":"Add module boundary detection from file tree","description":"Given an import graph and file tree, identify module boundaries — groups of files that form a logical unit (e.g., src/auth/ is the 'auth' module). Return a list of Module structs with name, root path, contained files, and whether the module has a mod.rs or lib.rs entry point. This enables the architecture agent to reason about modules rather than individual files. Ref: PRD section 'Static Analysis of Current Codebase'. Depends on import graph parser. Lives in src/import_graph.rs or a new src/module_detect.rs.","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T20:10:40.676903Z","created_by":"Austin King","updated_at":"2026-02-15T23:58:33.480686Z","closed_at":"2026-02-15T23:58:33.480686Z","close_reason":"Add module boundary detection from file tree","dependencies":[{"issue_id":"simple-agent-harness-75u","depends_on_id":"simple-agent-harness-4a1","type":"blocks","created_at":"2026-02-15T20:13:36.154552Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-7d0","title":"Implement rate limit detection with exponential backoff","description":"Scan session output file for rate limit indicators: JSON 'error:rate_limit', text patterns 'usage limit', 'hit your limit', 'resets.*UTC' (case-insensitive). On detection: increment consecutive rate limit counter, apply exponential backoff (initial_delay * 2^consecutive_count, capped at max_delay_secs), do not increment productive iteration counter. After max_consecutive_rate_limits consecutive rate limits, exit the loop. A successful session resets counter and backoff. Acceptance: rate limit patterns detected correctly, backoff escalates, loop exits after max consecutive. See PRD: Rate Limit Detection section.","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:49:19.661408Z","created_by":"Austin King","updated_at":"2026-02-15T01:58:33.907576Z","closed_at":"2026-02-15T01:58:33.907576Z","close_reason":"Implement rate limit detection with exponential backoff","dependencies":[{"issue_id":"simple-agent-harness-7d0","depends_on_id":"simple-agent-harness-p0y","type":"blocks","created_at":"2026-02-14T23:50:52.427094Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-7ed","title":"Implement blacksmith integration log and retry commands","description":"Add blacksmith integration log [--last N] CLI command showing integration history: assignment ID, bead ID, merge commit, timestamp, manifest entries applied, reconciliation status. Add blacksmith integration retry \u003cbead-id\u003e to retry a failed integration. Reference: SPEC-v3-agents.md lines 848-849. Key files: src/main.rs, src/integrator.rs, src/db.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:55:36.839192Z","created_by":"Austin King","updated_at":"2026-02-15T17:40:37.521475Z","closed_at":"2026-02-15T17:40:37.521475Z","close_reason":"Implement blacksmith integration log and retry commands","dependencies":[{"issue_id":"simple-agent-harness-7ed","depends_on_id":"simple-agent-harness-3pa","type":"blocks","created_at":"2026-02-15T14:57:11.948065Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-7rx","title":"Implement signal handling and graceful shutdown","description":"Implement signals.rs: three shutdown triggers. (1) STOP file: checked at top of each iteration, if present log event, delete file, exit. (2) First SIGINT: set flag, finish current session, then exit loop. Print 'Caught SIGINT, finishing current session...'. (3) Second SIGINT within 3s: kill current agent process group immediately, exit. (4) SIGTERM: same as single SIGINT. On any shutdown: persist global iteration counter, write final status. Uses tokio::signal for async signal handling. Acceptance: integration test showing STOP file triggers clean exit. See PRD: Graceful Shutdown section.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:48.437997Z","created_by":"Austin King","updated_at":"2026-02-15T00:17:24.372894Z","closed_at":"2026-02-15T00:17:24.372894Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-7rx","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:32.687071Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-7to","title":"Create refactor beads from validated proposals","description":"Convert validated refactoring proposals into tracked beads (issues) via the bd CLI or direct DB writes. Each approved proposal becomes a refactor task with full evidence context, marked as an epoch boundary (no concurrent execution). PRD ref: 'Proposal Validation' → 'converted to refactor tasks' and 'Refactor tasks are treated as epoch boundaries'.\n\n## Done when\n- [ ] create_refactor_bead(validated_proposal) function creates a bead via bd create\n- [ ] Bead title follows format: 'Refactor: \u003crecommendation summary\u003e'\n- [ ] Bead description includes: proposal kind, target file, evidence summary, suggested structure, confidence score\n- [ ] Bead type set to 'task', priority mapped from proposal priority\n- [ ] Bead tagged/noted as epoch boundary (e.g. in design field or notes)\n- [ ] Scheduler respects epoch boundary tag — no other tasks run concurrently with refactor beads\n- [ ] If refactor_auto_approve config is false, proposals stay in Pending state (no bead created until manual approval)\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes\n\n## Verify\n- Run: cargo test refactor_bead_creation -- --nocapture\n- Expect: Test creates a proposal, converts to bead, verifies bead fields\n\n## Affected files\n- src/architecture_pipeline.rs (modified - add bead creation step after validation)\n- src/scheduler.rs (modified - check epoch boundary flag, prevent concurrent scheduling)\n- src/config.rs (modified - add refactor_auto_approve knob, default false)","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T03:43:05.568943Z","created_by":"Austin King","updated_at":"2026-02-16T06:06:27.517915Z","closed_at":"2026-02-16T06:06:27.517915Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-7to","depends_on_id":"simple-agent-harness-4zi","type":"blocks","created_at":"2026-02-16T03:44:44.781848Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-7u1","title":"V3.5: Embed default assets (PROMPT.md, skills, config) in binary","description":"Create defaults/ directory with canonical PROMPT.md, skills, config. Add include_str!() or rust-embed to bake them into the binary. Currently blacksmith cannot run on non-blacksmith repos because none of these files exist.\n\n## Done when\n- [ ] defaults/ directory exists with PROMPT.md, skills, blacksmith.toml\n- [ ] src/defaults.rs uses include_str!() to embed all assets\n- [ ] Assets accessible at runtime via defaults module\n\n## Affected files\n- defaults/ (new directory)\n- src/defaults.rs (new)\n- Cargo.toml (if using rust-embed)","status":"open","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T16:29:17.144605Z","created_by":"Austin King","updated_at":"2026-02-16T16:29:17.144605Z"}
{"id":"simple-agent-harness-82c","title":"Fix session file naming for parallel workers: compress/retention/metrics expect numeric prefixes","description":"In parallel mode, pool.rs names session files 'worker-{id}-{bead_id}.jsonl' but three subsystems assume '{N}.jsonl' numeric naming: (1) compress.rs strips .jsonl and parses prefix as u64 — worker files silently skipped, never compressed. (2) retention.rs/gc.rs same pattern — worker files never garbage collected, accumulate forever. (3) metrics_cmd.rs list_session_files() — worker sessions invisible to 'metrics reingest' and 'metrics status'. Options: (a) change pool.rs to use numeric naming with a global counter, (b) update all three parsers to handle both naming schemes, or (c) use a sub-directory per worker with numeric files inside. Files: src/pool.rs:225, src/compress.rs:43-45, src/retention.rs:153-158, src/gc.rs:273-274, src/metrics_cmd.rs:395-400.","status":"closed","priority":0,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T00:43:55.219054Z","created_by":"Austin King","updated_at":"2026-02-16T00:50:35.803485Z","closed_at":"2026-02-16T00:50:35.803485Z","close_reason":"Fix session file naming: use numeric {N}.jsonl for parallel workers"}
{"id":"simple-agent-harness-83g","title":"Add migration map generation for refactor tasks","description":"When a refactor task completes, produce a structured migration map describing what moved: file moves (from -\u003e to_split paths) and symbol relocations (old_path::Symbol -\u003e new_path::Symbol). This map is consumed by in-progress worktrees to update their imports after a refactor integrates to main. Ref: PRD section 'The Migration Map'. Depends on import graph parser and module boundary detection.\n\n## Done when\n- [ ] MigrationMap struct defined with file_moves: Vec\u003c(PathBuf, PathBuf)\u003e and symbol_relocations: Vec\u003c(String, String)\u003e\n- [ ] generate_migration_map() takes a git diff (before/after commit) and returns MigrationMap\n- [ ] File moves detected from git diff --name-status (R100 renames)\n- [ ] Symbol relocations detected by comparing import graph before/after\n- [ ] MigrationMap serializes to JSON for consumption by other agents\n- [ ] Empty diff produces empty map (not an error)\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + migration map tests)\n\n## Verify\n- Run: cargo test migration_map\n- Run: Add a test that creates a temp git repo, renames a file, commits, and asserts the migration map contains the rename\n- Expect: file_moves contains (old_path, new_path), symbol_relocations updates corresponding import paths\n\n## Affected files\n- src/migration_map.rs (new)\n- src/import_graph.rs (modified — may need to expose graph diffing)\n- src/main.rs (modified — add mod migration_map)","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:13:03.233454Z","created_by":"Austin King","updated_at":"2026-02-16T01:55:29.322874Z","closed_at":"2026-02-16T01:55:29.322874Z","close_reason":"Implemented migration map generation: MigrationMap struct, generate_migration_map() with git diff file move detection and import graph-based symbol relocation detection, JSON serialization, and 15 passing tests.","dependencies":[{"issue_id":"simple-agent-harness-83g","depends_on_id":"simple-agent-harness-4a1","type":"blocks","created_at":"2026-02-15T20:14:08.536963Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-83g","depends_on_id":"simple-agent-harness-75u","type":"blocks","created_at":"2026-02-15T20:14:08.651742Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-8ci","title":"Implementation Audit: Core Features (V1)","description":"Systematically verify V1 core features are implemented correctly.\n\n## Checklist\n\nRead prd/SPEC.md and verify each feature:\n- [ ] Session spawning with configurable command/args\n- [ ] Watchdog output growth monitoring\n- [ ] Stale session killing (SIGTERM → SIGKILL)\n- [ ] Empty session retry logic\n- [ ] Rate limit detection from JSONL\n- [ ] Exponential backoff on rate limits\n- [ ] STOP file graceful shutdown\n- [ ] Signal handling (SIGINT, SIGTERM)\n- [ ] Status file (JSON, atomic writes)\n- [ ] Hook execution (pre/post session)\n- [ ] Hook environment variables\n- [ ] Prompt assembly (prepend_commands + file)\n- [ ] Event log (optional JSONL)\n- [ ] Commit detection patterns\n- [ ] Counter persistence\n\n## Process\n\nFor each feature:\n1. Find implementation in src/\n2. Compare to spec behavior\n3. Check for edge cases\n4. Verify tests exist\n5. File bead if broken/missing\n\n## Deliverables\n\n- List of verified features (checklist above)\n- Beads filed for any issues\n- Summary comment on implementation quality\n\n## Affected Files\n\nNone (audit task)","design":"DESCRIPTION\nSystematically verify V1 core features are implemented correctly.\n\n## Checklist\n\nRead prd/SPEC.md and verify each feature:\n- [ ] Session spawning with configurable command/args\n- [ ] Watchdog output growth monitoring\n- [ ] Stale session killing (SIGTERM → SIGKILL)\n- [ ] Empty session retry logic\n- [ ] Rate limit detection from JSONL\n- [ ] Exponential backoff on rate limits\n- [ ] STOP file graceful shutdown\n- [ ] Signal handling (SIGINT, SIGTERM)\n- [ ] Status file (JSON, atomic writes)\n- [ ] Hook execution (pre/post session)\n- [ ] Hook environment variables\n- [ ] Prompt assembly (prepend_commands + file)\n- [ ] Event log (optional JSONL)\n- [ ] Commit detection patterns\n- [ ] Counter persistence\n\n## Process\n\nFor each feature:\n1. Find implementation in src/\n2. Compare to spec behavior\n3. Check for edge cases\n4. Verify tests exist\n5. File bead if broken/missing\n\n## Deliverables\n\n- List of verified features (checklist above)\n- Beads filed for any issues\n- Summary comment on implementation quality\n\n## Affected Files\n\nNone (audit task)\n\n\naffected: src/runner.rs, src/session.rs, src/watchdog.rs, src/retry.rs, src/signals.rs, src/hooks.rs, src/status.rs, src/commit.rs, src/ratelimit.rsNOTES","notes":"Reopened: V1 audit not performed","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:15:19.483715Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:10.621792Z","closed_at":"2026-02-16T17:01:02.43976Z","close_reason":"V1 audit complete: core loop, watchdog, retry, rate limits, backoff, shutdown, hooks, prompt assembly, event log, commit detection, counter persistence all verified implemented and documented. Tests pass (1147/1147)."}
{"id":"simple-agent-harness-8ff","title":"Implement pre/post-session hook execution","description":"Implement hooks.rs: execute shell commands from config [hooks] pre_session and post_session arrays. Run synchronously before/after each session. Set environment variables: HARNESS_ITERATION, HARNESS_GLOBAL_ITERATION, HARNESS_PROMPT_FILE (pre+post), plus HARNESS_OUTPUT_FILE, HARNESS_EXIT_CODE, HARNESS_OUTPUT_BYTES, HARNESS_SESSION_DURATION, HARNESS_COMMITTED (post only). Pre-session hook failure (non-zero exit) skips the iteration with logged error. Post-session hook failure logs error but continues. Empty retries do NOT trigger post-session hooks. Acceptance: hooks run with correct env vars, failures handled per spec. See PRD: Hooks section.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:49.867764Z","created_by":"Austin King","updated_at":"2026-02-15T01:34:28.791281Z","closed_at":"2026-02-15T01:34:28.791281Z","close_reason":"Implement pre/post-session hook execution with env vars","dependencies":[{"issue_id":"simple-agent-harness-8ff","depends_on_id":"simple-agent-harness-p0y","type":"blocks","created_at":"2026-02-14T23:50:47.74734Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-8iq","title":"Exclude cycled beads from critical path estimation","description":"Modify estimation.rs to exclude cycled beads from the DAG before computing critical path. Use detect_cycles() to identify cycled bead IDs, filter them out of the BeadNode list before parallel_estimate(). Report cycled beads separately in ETA output: 'Progress: 18/24 beads | ETA: ~8m @ 3 workers / warning 3 beads stuck in dependency cycle (not included in estimate)'. If cycle is broken during run, next estimation pass includes freed beads. See PRD: prd/SPEC-v3-agents.md lines 761-773.","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T18:29:58.38058Z","created_by":"Austin King","updated_at":"2026-02-15T20:05:07.707925Z","closed_at":"2026-02-15T20:05:07.707925Z","close_reason":"Use cycle_detect::detect_cycles() in estimation.rs instead of inline Kahn's","dependencies":[{"issue_id":"simple-agent-harness-8iq","depends_on_id":"simple-agent-harness-9xv","type":"blocks","created_at":"2026-02-15T18:30:30.046316Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-8j5","title":"Implement built-in JSONL metric extraction for turns, cost, and duration","description":"Implement a JSONL parser that reads Claude session output files and extracts built-in metrics: turns.total (count of assistant events), turns.narration_only (assistant events with text but no tool_use), turns.parallel (assistant events with 2+ tool_use blocks), turns.tool_calls (total tool_use blocks), cost.input_tokens/output_tokens/estimate_usd (from usage data), session.output_bytes (file size), session.exit_code. Write extracted metrics as events to the events table. Update observations table. PRD ref: Built-in Metrics, Event Kinds. Files: new src/ingest.rs, src/db.rs (event insert helpers).","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:30.612248Z","created_by":"Austin King","updated_at":"2026-02-15T14:07:06.778686Z","closed_at":"2026-02-15T14:07:06.778686Z","close_reason":"Implement built-in JSONL metric extraction for turns, cost, and duration","dependencies":[{"issue_id":"simple-agent-harness-8j5","depends_on_id":"simple-agent-harness-cl6","type":"blocks","created_at":"2026-02-15T13:28:17.903237Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-8o8","title":"V3.5: Implement blacksmith finish subcommand to replace bd-finish.sh","description":"bd-finish.sh is a shell script that won't exist in worktrees on non-blacksmith repos. Replace with a compiled subcommand: cargo check, cargo test, stage, commit, bd close, bd sync. Quality gates should be configurable via [finish] section in blacksmith.toml.\n\n## Done when\n- [ ] blacksmith finish \u003cbead-id\u003e \u003cmessage\u003e [files...] subcommand exists\n- [ ] Runs configurable quality gates before closing\n- [ ] Stages files, commits, closes bead, syncs\n- [ ] [finish] config section with check/test/lint commands\n- [ ] Embedded PROMPT.md references blacksmith finish\n\n## Affected files\n- src/main.rs (modified - new subcommand)\n- src/finish.rs (new)\n- src/config.rs (modified - FinishConfig)","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T16:29:34.568648Z","created_by":"Austin King","updated_at":"2026-02-16T16:53:13.987347Z","closed_at":"2026-02-16T16:53:13.987347Z","close_reason":"Implement blacksmith finish subcommand with configurable quality gates","dependencies":[{"issue_id":"simple-agent-harness-8o8","depends_on_id":"simple-agent-harness-n73","type":"blocks","created_at":"2026-02-16T16:30:09.768969Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-8ufk","title":"V3: Document or remove undocumented integration_iterations table","status":"open","priority":4,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:35:26.265219Z","created_by":"Austin King","updated_at":"2026-02-16T16:35:26.265219Z"}
{"id":"simple-agent-harness-90v","title":"Implement ensure_fresh_metadata for scheduler integration","description":"Implement the ensure_fresh_metadata() function from the PRD: check intent cache (keyed by content_hash), check resolution cache (keyed by commit hash), regenerate as needed, return combined TaskMetadata. Wire this into the scheduler so tasks get fresh metadata before assignment. Ref: PRD section 'Regeneration Strategy' code sample. Depends on metadata regeneration strategy, LLM intent analysis, and file resolution implementation.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:12:00.877925Z","created_by":"Austin King","updated_at":"2026-02-16T00:23:49.841224Z","closed_at":"2026-02-16T00:23:49.841224Z","close_reason":"Implement ensure_fresh_metadata for scheduler integration","dependencies":[{"issue_id":"simple-agent-harness-90v","depends_on_id":"simple-agent-harness-n1d","type":"blocks","created_at":"2026-02-15T20:13:50.268339Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-90v","depends_on_id":"simple-agent-harness-d42","type":"blocks","created_at":"2026-02-15T20:13:50.380935Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-90v","depends_on_id":"simple-agent-harness-ikw","type":"blocks","created_at":"2026-02-15T20:13:50.495952Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-945","title":"Add brief injection of open improvements","description":"Extend the brief generation to include open improvements from the improvements table in the session prompt. When generating a brief (blacksmith brief or coordinator's per-session prompt assembly), query improvements with status='open' and append them as a section: '## OPEN IMPROVEMENTS' with each improvement's ref, title, and category. This is the 'fast path' of the self-improvement loop — immediate injection without PROMPT.md edits. PRD ref: Milestone 4.\n\n## Done when\n- [ ] brief::handle_brief() queries open improvements from DB\n- [ ] If open improvements exist, appends '## OPEN IMPROVEMENTS' section to brief output\n- [ ] Each improvement listed as '- {ref}: {title} [{category}]'\n- [ ] If no open improvements, section is omitted (no empty section)\n- [ ] New test: test_brief_includes_improvements — inserts improvement, verifies brief output\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + any new tests)\n\n## Verify\n- Run: blacksmith improve add 'test improvement' --category=workflow \u0026\u0026 blacksmith brief 2\u003e\u00261 | grep 'OPEN IMPROVEMENTS'\n- Expect: Section appears with the test improvement listed\n- Run: cargo test test_brief_includes_improvements -- --nocapture\n- Expect: Test passes\n\n## Affected files\n- src/brief.rs (modified — add improvement query and section generation)\n- src/db.rs (modified — add query for open improvements if not already present)","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T02:34:59.669631Z","created_by":"Austin King","updated_at":"2026-02-16T02:56:10.854064Z","closed_at":"2026-02-16T02:56:10.854064Z","close_reason":"Brief injection of open improvements was already implemented in brief.rs (lines 81-103). generate_brief() queries open improvements and includes them as OPEN IMPROVEMENTS section. Tests exist: brief_shows_open_improvements, brief_excludes_non_open_improvements_from_listing, brief_format_matches_prd."}
{"id":"simple-agent-harness-94o","title":"V2: Fix brief injection to pass targets config during loop sessions","status":"closed","priority":2,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T16:34:56.819873Z","created_by":"Austin King","updated_at":"2026-02-16T16:43:09.957692Z","closed_at":"2026-02-16T16:43:09.957692Z","close_reason":"Fixed prompt::assemble to accept and forward targets_config and supported_metrics to brief::generate_brief. Updated runner.rs to pass config.metrics.targets and adapter.supported_metrics() during loop sessions. Added regression test."}
{"id":"simple-agent-harness-98f","title":"Add proposal persistence to database","description":"Add SQLite persistence for refactoring proposals. Currently proposal_generation.rs generates proposals but they're ephemeral. Add a proposals table to the DB schema and CRUD functions so proposals survive across runs and can be reviewed/approved. PRD ref: 'Proposal Format' section.\n\n## Done when\n- [ ] proposals table created in DB migration (id, kind, priority, confidence, target_file, evidence_json, recommendation_json, status, created_at, updated_at)\n- [ ] store_proposal() writes a RefactorProposal to DB and returns an ID\n- [ ] get_proposal(id) retrieves a stored proposal\n- [ ] list_proposals(status_filter) returns proposals filtered by status (pending/approved/rejected/executed)\n- [ ] update_proposal_status(id, new_status) transitions proposal state\n- [ ] Proposal status enum: Pending, Approved, Rejected, Executed\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + new DB tests)\n\n## Verify\n- Run: cargo test proposal_persist -- --nocapture\n- Expect: Tests pass for store, retrieve, list, status update\n\n## Affected files\n- src/proposal_generation.rs (modified - add persistence functions and Proposal status)\n- src/db.rs (modified - add proposals table migration)\n- src/migrate.rs (modified - add migration step if needed)","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T03:42:59.372207Z","created_by":"Austin King","updated_at":"2026-02-16T06:06:27.515568Z","closed_at":"2026-02-16T06:06:27.515568Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-98f","depends_on_id":"simple-agent-harness-krl","type":"blocks","created_at":"2026-02-16T03:44:44.029685Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-9cm","title":"Implement metrics rebuild command to regenerate observations from events","description":"Implement 'blacksmith metrics rebuild' command that drops and recreates the observations table from events. Useful after manual event edits or migration. PRD ref: Observations Table \u003e Rebuild command. Files: src/metrics_cmd.rs, src/db.rs (rebuild_observations function).","status":"closed","priority":3,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:43.027635Z","created_by":"Austin King","updated_at":"2026-02-15T14:48:31.081247Z","closed_at":"2026-02-15T14:48:31.081247Z","close_reason":"Implement metrics rebuild command to regenerate observations from events","dependencies":[{"issue_id":"simple-agent-harness-9cm","depends_on_id":"simple-agent-harness-cl6","type":"blocks","created_at":"2026-02-15T13:28:34.799168Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-9i4","title":"V1: Deduplicate session spawn logic between runner.rs and session.rs","status":"open","priority":4,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:34:47.162716Z","created_by":"Austin King","updated_at":"2026-02-16T16:34:47.162716Z"}
{"id":"simple-agent-harness-9jw","title":"Wire adapter into ingest pipeline replacing hardcoded parsing","description":"Replace the hardcoded Claude JSONL parsing in the ingest pipeline with calls through the AgentAdapter trait. The ingest module should receive an adapter instance and call extract_builtin_metrics() and lines_for_source() instead of directly parsing Claude format. Configurable extraction rules ([metrics.extract]) should use lines_for_source() to get source text. Reference: SPEC-v3-agents.md lines 226-261. Key files: src/ingest.rs, src/runner.rs.","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T14:53:59.576852Z","created_by":"Austin King","updated_at":"2026-02-15T15:35:08.56575Z","closed_at":"2026-02-15T15:35:08.56575Z","close_reason":"Wire adapter into ingest pipeline replacing hardcoded parsing","dependencies":[{"issue_id":"simple-agent-harness-9jw","depends_on_id":"simple-agent-harness-wi2","type":"blocks","created_at":"2026-02-15T14:56:48.650301Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-9jw","depends_on_id":"simple-agent-harness-6hk","type":"blocks","created_at":"2026-02-15T14:56:49.896521Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-9kr","title":"Implement blacksmith finish subcommand","description":"Port the bd-finish.sh shell script logic to a blacksmith finish Rust subcommand. This is critical for deployment: bd-finish.sh lives in the blacksmith repo and won't exist in target project worktrees. The binary subcommand is globally available. Steps: (1) run quality gates, (2) append PROGRESS.txt to PROGRESS_LOG.txt, (3) stage files, (4) git commit, (5) bd close, (6) bd sync, (7) auto-commit .beads/, (8) git push. Abort on gate failure — bead stays open. PRD ref: Milestone 2.\n\n## Done when\n- [ ] Commands::Finish variant added to CLI with args: bead_id (required), message (required), files (optional Vec)\n- [ ] src/finish.rs implements the 8-step pipeline from bd-finish.sh\n- [ ] Quality gate failures (step 0a/0b) print error and exit 1 without closing the bead\n- [ ] If no files specified, runs git add -u (same as bd-finish.sh)\n- [ ] PROGRESS.txt append is timestamped and includes bead ID\n- [ ] git commit message format: '{bead_id}: {message}'\n- [ ] All steps print colored status like bd-finish.sh\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + any new tests)\n\n## Verify\n- Run: cargo run -- finish --help\n- Expect: Shows bead_id, message, files args\n- Run: cargo test finish -- --nocapture (unit tests for gate execution, step ordering)\n- Expect: Tests pass\n\n## Affected files\n- src/finish.rs (new — main finish pipeline)\n- src/main.rs (modified — add Commands::Finish, wire handler)","status":"closed","priority":0,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T02:34:51.762173Z","created_by":"Austin King","updated_at":"2026-02-16T02:43:10.033275Z","closed_at":"2026-02-16T02:43:10.033275Z","close_reason":"Implemented blacksmith finish subcommand porting bd-finish.sh to Rust"}
{"id":"simple-agent-harness-9ob","title":"Recover orphaned in_progress beads on coordinator startup","description":"When blacksmith crashes or is killed, beads marked in_progress stay stuck. On restart, bd ready only returns open beads, so orphaned in_progress beads are invisible to the scheduler forever. Fix: after acquiring singleton lock on coordinator startup, query bd list --status=in_progress. For each in_progress bead with no active worker, run bd update \u003cid\u003e --status=open. Since the singleton lock guarantees no other coordinator is running, any in_progress bead without a worker is guaranteed orphaned. This must be a harness mechanism, not a prompt-based approach.","status":"closed","priority":0,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-15T22:28:02.279117Z","created_by":"Austin King","updated_at":"2026-02-15T23:54:53.607275Z","closed_at":"2026-02-15T23:54:53.607275Z","close_reason":"Verify orphaned bead recovery already implemented and passing","dependencies":[{"issue_id":"simple-agent-harness-9ob","depends_on_id":"simple-agent-harness-ckq","type":"blocks","created_at":"2026-02-15T22:28:07.142615Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-9xc","title":"Add god file detection via cohesion analysis","description":"Detect files exceeding a size threshold that contain multiple unrelated concerns. Measure internal cohesion by checking whether symbols defined in a file reference each other or form independent clusters. A file with 3+ independent symbol clusters above a line threshold is a god file candidate. Ref: PRD section 'God files'. Depends on import graph parser and public API surface extractor.","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T20:11:06.251Z","created_by":"Austin King","updated_at":"2026-02-16T00:11:57.303507Z","closed_at":"2026-02-16T00:11:57.303507Z","close_reason":"Add god file detection via cohesion analysis","dependencies":[{"issue_id":"simple-agent-harness-9xc","depends_on_id":"simple-agent-harness-4a1","type":"blocks","created_at":"2026-02-15T20:13:38.183444Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-9xc","depends_on_id":"simple-agent-harness-ehy","type":"blocks","created_at":"2026-02-15T20:13:38.3007Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-9xv","title":"Implement cycle detection algorithms (Kahn's + Tarjan's SCC) in cycle_detect.rs","description":"Create new src/cycle_detect.rs module with BeadNode struct and detect_cycles() function. Phase 1: Kahn's algorithm (BFS topological sort, ~40 lines) identifies nodes involved in cycles by draining nodes with in-degree 0. Phase 2: Tarjan's SCC (~50 lines) decomposes remaining nodes into individual strongly connected components for reporting. Returns Vec\u003cVec\u003cString\u003e\u003e of cycle groups. Pure std library code, zero external deps. Include comprehensive unit tests for: no cycles (DAG), single cycle, multiple independent cycles, self-loops, complex graph with both cycled and non-cycled nodes. Reuse or align with existing BeadNode in src/estimation.rs. See PRD: prd/SPEC-v3-agents.md lines 724-757.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T18:29:55.741395Z","created_by":"Austin King","updated_at":"2026-02-15T18:34:18.800657Z","closed_at":"2026-02-15T18:34:18.800657Z","close_reason":"Implement cycle detection algorithms (Kahn's + Tarjan's SCC) in cycle_detect.rs"}
{"id":"simple-agent-harness-a9n","title":"Implement structural metrics aggregator for architecture analysis","description":"Compute all structural metrics for all modules in one pass: fan-in scores, file sizes, cohesion scores, cycle participation, API surface width. Return a StructuralReport with per-module and per-file metrics. This is step 1 of the architecture analysis pipeline. Ref: PRD section 'Analysis Process' step 1. Depends on fan-in scoring, god file detection, circular dep detection, boundary violation detector, and public API surface extractor.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:12:33.701716Z","created_by":"Austin King","updated_at":"2026-02-16T00:31:07.391676Z","closed_at":"2026-02-16T00:31:07.391676Z","close_reason":"Implement structural metrics aggregator for architecture analysis","dependencies":[{"issue_id":"simple-agent-harness-a9n","depends_on_id":"simple-agent-harness-q5v","type":"blocks","created_at":"2026-02-15T20:13:57.428399Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-a9n","depends_on_id":"simple-agent-harness-9xc","type":"blocks","created_at":"2026-02-15T20:13:57.545802Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-a9n","depends_on_id":"simple-agent-harness-33k","type":"blocks","created_at":"2026-02-15T20:13:57.663598Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-a9n","depends_on_id":"simple-agent-harness-aol","type":"blocks","created_at":"2026-02-15T20:13:57.782585Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-a9n","depends_on_id":"simple-agent-harness-ehy","type":"blocks","created_at":"2026-02-15T20:13:57.90563Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-aegv","title":"CRITICAL: Agents closing beads without completing work","description":"Agents are marking beads as CLOSED with fabricated completion reports without doing actual work.\n\n## Evidence\n\n1. Bead simple-agent-harness-374 closed with claim:\n   - \"All 11 docs written (docs/README.md + 10 subsystem docs)\"\n   - \"All 4 audits done: V1 15/15, V2 10/13...\"\n   - \"cargo check + cargo test (1146 pass) clean\"\n\n2. Reality check shows:\n   - `docs/` directory does not exist\n   - No documentation files created\n   - No audits performed\n   - No follow-up beads filed\n\n3. Bead simple-agent-harness-2kb also closed claiming docs/README.md created, but directory doesn't exist.\n\n## Impact\n\n- P0 CRITICAL: Destroys system reliability\n- Work appears done but isn't\n- Blocks dependent tasks incorrectly\n- False confidence in progress\n\n## Root Cause Hypothesis\n\nAgent is likely:\n1. Reading the bead description\n2. Generating what \"complete\" would look like\n3. Closing the bead with that description\n4. NOT actually executing the work\n\n## Fix Required\n\nBefore allowing `bd close`:\n1. Verify \"Done when\" checklist items\n2. Run explicit verification commands from bead\n3. Confirm files mentioned in \"Affected Files\" exist\n4. Run quality gates (cargo check, cargo test)\n5. Only close if ALL verifications pass\n\nAdd to `blacksmith finish` or integration loop.\n\n## Verify Fix\n\n1. Create a test bead requiring file creation\n2. Agent should fail to close it without creating the file\n3. After creating file, close should succeed\n\n## Related\n\n- Mentioned in MEMORY.md as known issue\n- Affects beads: 374, 2kb, potentially many others\n- May be related to prompts not emphasizing verification","notes":"ROOT CAUSE HYPOTHESIS:\n\nAgent is reading bead description, seeing \"## Done when\" checklist, and fabricating\ncompletion reports WITHOUT actually executing the work.\n\nLIKELY CAUSES:\n1. Prompt may not emphasize verification strongly enough\n2. Agent may be pattern-matching \"completed work\" from description\n3. No enforcement of verification steps before bd close\n4. Quality gates (cargo check/test) not blocking bd close\n\nFIX OPTIONS:\nA. Update PROMPT.md to emphasize verification MORE strongly\nB. Implement `blacksmith finish` with mandatory gates (V3.5 feature)\nC. Add pre-close verification to integration loop\nD. Modify bd close workflow to require proof of completion\n\nINVESTIGATION NEEDED:\n- Read recent session JSONL to see agent thought process\n- Check if agent ran verification commands or just reported them\n- Review PROMPT.md verification instructions\n- Check if blacksmith finish exists and is being used","status":"closed","priority":0,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T16:38:56.513042Z","created_by":"Austin King","updated_at":"2026-02-16T17:04:40.325966Z","closed_at":"2026-02-16T17:04:40.325966Z","close_reason":"Add deliverable verification gate to bd-finish.sh"}
{"id":"simple-agent-harness-aev","title":"Add src/defaults.rs with include_str! embedded assets","description":"Create src/defaults.rs module that uses include_str\\!() to embed all default assets from defaults/ into the compiled binary. This makes the blacksmith binary self-contained — it can extract its own runtime files on first run without needing any files from the repo. Register the module in src/main.rs. PRD ref: Milestone 1a.\n\n## Done when\n- [ ] src/defaults.rs exists with include_str\\!() constants for: PROMPT_MD, FINISH_SCRIPT, DEFAULT_CONFIG, SKILL_PRD_TO_BEADS, SKILL_BREAK_DOWN, SKILL_SELF_IMPROVE\n- [ ] Each constant references the correct file in defaults/\n- [ ] Module is declared in src/main.rs (mod defaults)\n- [ ] cargo check passes — all include_str\\! paths resolve\n- [ ] cargo test passes (all existing + any new tests)\n\n## Verify\n- Run: cargo check 2\u003e\u00261 | tail -5\n- Expect: No errors (include_str\\! paths all valid)\n- Run: grep 'include_str\\!' src/defaults.rs | wc -l\n- Expect: 6 (one per embedded asset)\n\n## Affected files\n- src/defaults.rs (new)\n- src/main.rs (modified — add mod defaults)","status":"closed","priority":0,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T02:34:47.352238Z","created_by":"Austin King","updated_at":"2026-02-16T02:47:26.027856Z","closed_at":"2026-02-16T02:47:26.027856Z","close_reason":"Implemented defaults/, src/defaults.rs, DataDir extraction, and init --force/--export","dependencies":[{"issue_id":"simple-agent-harness-aev","depends_on_id":"simple-agent-harness-t6a","type":"blocks","created_at":"2026-02-16T02:36:53.720078Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-agq","title":"Clean up dead code warnings across codebase","description":"Remove dead code identified by rustc warnings: unused functions, structs, fields, and enum variants across db.rs, mod.rs, integrator.rs, ingest.rs, config.rs, and session.rs","status":"closed","priority":3,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T18:23:40.366202Z","created_by":"Austin King","updated_at":"2026-02-15T18:28:46.991182Z","closed_at":"2026-02-15T18:28:46.991182Z","close_reason":"Clean up dead code warnings"}
{"id":"simple-agent-harness-ahur","title":"Clean up dead code in V5 architecture modules","status":"open","priority":3,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T16:59:37.258406Z","created_by":"Austin King","updated_at":"2026-02-16T16:59:37.258406Z"}
{"id":"simple-agent-harness-aol","title":"Add boundary violation detector for module imports","description":"Detect modules reaching into each other's internals rather than using public APIs. Check whether imports reference pub items or reach through pub(crate)/non-public paths. Return a list of boundary violations with source module, target module, and the non-public symbol accessed. Ref: PRD section 'Boundary violations'. Depends on import graph parser, module boundary detection, and public API surface extractor.","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T20:11:09.058674Z","created_by":"Austin King","updated_at":"2026-02-16T00:17:45.232219Z","closed_at":"2026-02-16T00:17:45.232219Z","close_reason":"Add boundary violation detector for module imports","dependencies":[{"issue_id":"simple-agent-harness-aol","depends_on_id":"simple-agent-harness-4a1","type":"blocks","created_at":"2026-02-15T20:13:40.247565Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-aol","depends_on_id":"simple-agent-harness-75u","type":"blocks","created_at":"2026-02-15T20:13:40.358764Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-aol","depends_on_id":"simple-agent-harness-ehy","type":"blocks","created_at":"2026-02-15T20:13:40.468368Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-as9","title":"Implement migration map application to in-progress worktrees","description":"When a refactor integrates to main and another agent has an in-progress worktree: (1) detect the agent's worktree needs updating, (2) apply the migration map's symbol relocations (find-and-replace on use/mod import paths in .rs files), (3) merge main into the worktree branch, (4) run cargo check fix loop (up to N iterations). If fix loop exceeds N iterations after migration, abort the worktree and re-queue the bead. Ref: PRD section 'Handling the In-Progress Agent'. Depends on migration map generation.\n\n## Done when\n- [ ] apply_migration_map() takes a MigrationMap and a worktree path, applies all symbol relocations to .rs files\n- [ ] Symbol relocations are applied as literal string replacements in use/mod statements only (not in comments or strings)\n- [ ] After applying relocations, merge main into worktree branch\n- [ ] If cargo check fails after merge, run up to 3 fix iterations (cargo check, apply obvious fixes)\n- [ ] If fix loop exceeds max iterations, return an error indicating abort+re-queue\n- [ ] Worktree .rs files not in the migration map are untouched\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + migration application tests)\n\n## Verify\n- Run: cargo test migration_apply\n- Run: Add a test that creates a worktree with `use crate::old_module::Foo;`, applies a migration map relocating old_module→new_module, and asserts the import was updated\n- Expect: Import rewritten to `use crate::new_module::Foo;`, other files untouched\n\n## Affected files\n- src/migration_apply.rs (new)\n- src/integrator.rs (modified — call apply_migration_map after refactor integration)\n- src/pool.rs (modified — may need to expose worktree paths for active workers)\n- src/main.rs (modified — add mod migration_apply)","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:13:04.354733Z","created_by":"Austin King","updated_at":"2026-02-16T03:06:33.494075Z","closed_at":"2026-02-16T03:06:33.494075Z","close_reason":"Implemented migration map generation and application: MigrationMap struct with file_moves and symbol_relocations, generate_migration_map() from git diff, apply_migration_map() with use/mod statement relocation, merge main, cargo fix loop (max 3 iterations), and coordinator wiring to apply maps to in-progress worktrees. 25 new tests, all 1196 tests pass.","dependencies":[{"issue_id":"simple-agent-harness-as9","depends_on_id":"simple-agent-harness-83g","type":"blocks","created_at":"2026-02-15T20:14:08.766028Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-auh","title":"V3.5: Complete first-run extraction of embedded defaults to .blacksmith/","description":"DataDir::ensure_initialized() creates directories but doesn't extract embedded resources. After embedded defaults exist (parent bead), extraction should write PROMPT.md, skills, and config to .blacksmith/ on first run without overwriting existing files.\n\n## Done when\n- [ ] First run with no .blacksmith/ extracts PROMPT.md, skills/, blacksmith.toml\n- [ ] Existing files are never overwritten\n- [ ] .gitignore is updated (already works)\n\n## Affected files\n- src/data_dir.rs (modified)","status":"open","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T16:29:22.938374Z","created_by":"Austin King","updated_at":"2026-02-16T16:29:22.938374Z","dependencies":[{"issue_id":"simple-agent-harness-auh","depends_on_id":"simple-agent-harness-7u1","type":"blocks","created_at":"2026-02-16T16:30:09.506043Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-buv","title":"Add metadata drift detection between regenerations","description":"Detect when layer-2 regeneration produces significantly different results for the same layer-1 intent. If the same concept resolves to 3 files one week and 11 files the next, module boundaries are expanding. Compare old and new file resolution results and flag drift above a configurable threshold (default 3x increase). Ref: PRD section 'Metadata drift'. Depends on file resolution data model and metadata regeneration strategy.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:12:16.718406Z","created_by":"Austin King","updated_at":"2026-02-16T00:26:29.306499Z","closed_at":"2026-02-16T00:26:29.306499Z","close_reason":"Add metadata drift detection between regenerations","dependencies":[{"issue_id":"simple-agent-harness-buv","depends_on_id":"simple-agent-harness-0lk","type":"blocks","created_at":"2026-02-15T20:13:51.746396Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-buv","depends_on_id":"simple-agent-harness-n1d","type":"blocks","created_at":"2026-02-15T20:13:51.85815Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-c11","title":"Document: Getting Started guide","description":"Write docs/getting-started.md covering installation, first run, and basic usage.\n\n## Content\n\n- Installation (cargo build, binary location)\n- First run experience (blacksmith init, default extraction)\n- Basic usage examples (single worker, simple loop)\n- Configuration basics (blacksmith.toml location, precedence)\n- Common first-time user workflows\n\n## Verification\n\nRead src/main.rs, src/data_dir.rs, src/config.rs to verify:\n- Default behavior on first run\n- Config loading precedence\n- Init command behavior\n\n## Affected Files\n\n- docs/getting-started.md (new)","design":"Write docs/getting-started.md covering installation, first run, and basic usage.\n\n## Content\n\n- Installation (cargo build, binary location)\n- First run experience (blacksmith init, default extraction)\n- Basic usage examples (single worker, simple loop)\n- Configuration basics (blacksmith.toml location, precedence)\n- Common first-time user workflows\n\n## Verification\n\nRead src/main.rs, src/data_dir.rs, src/config.rs to verify:\n- Default behavior on first run\n- Config loading precedence\n- Init command behavior\n\n## Affected Files\n\n- docs/getting-started.md (new)\n\naffected: docs/getting-started.md","notes":"Reopened: docs/getting-started.md not created","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:14:19.476885Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:48.669073Z","closed_at":"2026-02-16T17:01:30.705336Z","close_reason":"Documentation files verified against source code and corrected where needed.","dependencies":[{"issue_id":"simple-agent-harness-c11","depends_on_id":"simple-agent-harness-2kb","type":"blocks","created_at":"2026-02-16T16:15:54.724455Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-c1sx","title":"Document: Graceful Coordinator Shutdown Procedure","description":"Create documentation for safely stopping and resuming the coordinator.\n\n## Task\n\nAdd to docs/troubleshooting.md (or create new docs/operations.md) section on:\n\n### Graceful Shutdown\n\n1. **During active sessions:**\n   ```bash\n   touch STOP\n   ```\n   - Coordinator detects STOP file at start of each iteration\n   - Current session(s) complete normally\n   - Workers finish their current bead\n   - Worktrees preserved for manual inspection\n   - Clean exit with summary\n\n2. **Immediate shutdown:**\n   ```bash\n   pkill -SIGTERM blacksmith\n   # Or if coordinator PID known:\n   kill -TERM \u003cpid\u003e\n   ```\n   - Sends SIGTERM to coordinator\n   - Waits for current session to finish\n   - Same as STOP file behavior\n\n3. **Force kill (emergency only):**\n   ```bash\n   pkill -SIGKILL blacksmith\n   ```\n   - Immediate termination\n   - May leave orphaned processes\n   - May leave uncommitted work\n   - Worktrees may be in inconsistent state\n   - Use only when hung\n\n### After Shutdown\n\n1. **Check for orphaned processes:**\n   ```bash\n   ps aux | grep -E 'claude|blacksmith' | grep -v grep\n   ```\n\n2. **Inspect worktrees:**\n   ```bash\n   ls -la .blacksmith/worktrees/\n   # Review any preserved worktrees\n   ```\n\n3. **Check bead states:**\n   ```bash\n   bd list --status=in_progress\n   # Should be empty after clean shutdown\n   # If not, manually reset to 'open'\n   ```\n\n4. **Review session output:**\n   ```bash\n   ls -lht .blacksmith/sessions/ | head -5\n   # Check last few sessions\n   ```\n\n### Resuming After Code Changes\n\n1. **Recompile:**\n   ```bash\n   cargo build --release\n   ```\n\n2. **Verify binary:**\n   ```bash\n   ./target/release/blacksmith --version\n   ```\n\n3. **Check config:**\n   ```bash\n   cat blacksmith.toml\n   # Verify [workers] max, [agent] settings\n   ```\n\n4. **Resume:**\n   ```bash\n   ./target/release/blacksmith\n   ```\n   - Resumes from last counter value\n   - Re-queries beads for ready work\n   - Spawns fresh workers\n\n### Common Issues\n\n**STOP file ignored:**\n- Coordinator only checks at iteration start\n- Wait for current session to complete\n- Check `cat .blacksmith/status` for state\n\n**Worktrees not cleaned up:**\n- Normal on graceful shutdown (preserved for review)\n- Clean manually: `git worktree remove .blacksmith/worktrees/worker-*`\n- Or next run will clean orphaned worktrees\n\n**Beads stuck in_progress:**\n- Coordinator didn't finish cleanup\n- Manually reset: `bd update \u003cid\u003e --status=open`\n- Or use cleanup hook\n\n## Verify\n\n```bash\n# Test graceful shutdown\n./target/release/blacksmith \u0026\nsleep 5\ntouch STOP\n# Should exit cleanly\ngrep -q \"STOP file detected\" \u003crecent-log\u003e\n```\n\n## Affected Files\n\n- docs/troubleshooting.md (or docs/operations.md)\n- May reference from docs/README.md","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:54:32.868037Z","created_by":"Austin King","updated_at":"2026-02-16T16:54:32.868037Z"}
{"id":"simple-agent-harness-c37","title":"Implement blacksmith metrics beads per-bead timing report","description":"Add blacksmith metrics beads CLI command showing per-bead timing: bead ID, status, sessions, wall time, turns, title in a table format. Show totals: X closed (Ym), Z open. Show averages: Xm/bead, Y turns/bead. Show fastest and slowest beads. Query data from bead_metrics table. Reference: SPEC-v3-agents.md lines 816-830. Key files: src/main.rs, src/metrics_cmd.rs, src/db.rs.","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:56:13.510653Z","created_by":"Austin King","updated_at":"2026-02-15T18:22:24.400858Z","closed_at":"2026-02-15T18:22:24.400858Z","close_reason":"Implement metrics beads per-bead timing report","dependencies":[{"issue_id":"simple-agent-harness-c37","depends_on_id":"simple-agent-harness-dgh","type":"blocks","created_at":"2026-02-15T14:57:17.514301Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-cgo","title":"Add refactor proposal generation from architecture analysis","description":"For each candidate module identified by the signal correlator, generate a specific refactor proposal. Each proposal includes: kind (split_module, extract_interface, etc.), priority, confidence score, target file/module with current metrics, evidence (expansion_events count, avg integration iterations, entangled rollbacks, metadata drift), and a concrete recommendation with suggested new structure. Ref: PRD section 'Proposal Format'. Depends on historical signal correlator.\n\n## Done when\n- [ ] RefactorProposal struct defined with all fields from PRD (kind, priority, confidence, target, evidence, recommendation)\n- [ ] generate_proposals() takes a CorrelationReport and returns Vec\u003cRefactorProposal\u003e\n- [ ] Proposals are sorted by confidence score descending\n- [ ] Only candidates above CANDIDATE_THRESHOLD (0.6) produce proposals\n- [ ] Each proposal includes human-readable recommendation text\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + new proposal generation tests)\n\n## Verify\n- Run: cargo test proposal_generation\n- Run: Add a unit test with a mock CorrelationReport containing 3 candidates (scores 0.8, 0.5, 0.3) — assert only the 0.8 candidate produces a proposal\n- Expect: Proposals contain all required fields, are sorted by confidence, and filter below threshold\n\n## Affected files\n- src/proposal_generation.rs (new)\n- src/signal_correlator.rs (modified — export CorrelationReport and RefactorCandidate types)\n- src/main.rs (modified — add mod proposal_generation)","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:12:36.114374Z","created_by":"Austin King","updated_at":"2026-02-16T01:46:51.350305Z","closed_at":"2026-02-16T01:46:51.350305Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-cgo","depends_on_id":"simple-agent-harness-4wc","type":"blocks","created_at":"2026-02-15T20:14:00.903061Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-ckq","title":"Coordinator singleton lock: prevent multiple blacksmith instances from running concurrently","description":"Multiple blacksmith coordinator processes can run simultaneously with no mutual exclusion. This causes: (1) duplicate workers spawned for the same bead across separate tmp dirs, (2) blocked beads getting scheduled because multiple coordinators race on bd ready, (3) the same bead assigned to multiple workers simultaneously. Root cause: no PID file or flock-based singleton lock. Fix: acquire an exclusive lock on .blacksmith/lock at coordinator startup. If the lock is held, exit with a clear error showing the existing PID. Release on exit (or stale-detect via PID liveness check).","notes":"Reopened: session 50 closed this but the code doesn't compile. fs2 crate missing from Cargo.toml, singleton.rs has unresolved imports, DataDir::lock() doesn't exist. The lock is not functional — multiple coordinators still spawn concurrently.","status":"closed","priority":0,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-15T20:18:08.127308Z","created_by":"Austin King","updated_at":"2026-02-15T22:13:59.856992Z","closed_at":"2026-02-15T22:13:59.856992Z","close_reason":"Verify singleton lock is fully implemented and functional"}
{"id":"simple-agent-harness-cl6","title":"Create events and observations tables in database module","description":"Add events table (id, ts, session, kind, value, tags) and observations table (session PK, ts, duration, outcome, data JSON) to the database module. Create indexes on events(session), events(kind), events(ts). Observations is a materialized per-session summary. Add insert/query functions for both tables. PRD ref: Storage Model \u003e Events Table, Observations Table. Files: src/db.rs.","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:28.971673Z","created_by":"Austin King","updated_at":"2026-02-15T14:03:25.154817Z","closed_at":"2026-02-15T14:03:25.154817Z","close_reason":"Add events and observations tables with insert/query functions and indexes","dependencies":[{"issue_id":"simple-agent-harness-cl6","depends_on_id":"simple-agent-harness-sxy","type":"blocks","created_at":"2026-02-15T13:28:16.337262Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-cpy9","title":"Implement PROMPT.md template variable substitution","status":"open","priority":4,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T16:59:47.109243Z","created_by":"Austin King","updated_at":"2026-02-16T16:59:47.109243Z"}
{"id":"simple-agent-harness-cqf","title":"Surface cycle warnings in CLI status output","description":"Surface cycle warnings prominently in two places: (1) blacksmith run status line: 'Progress: 18/21 schedulable beads | ETA: ~6m @ 2 workers / warning 3 beads in dependency cycle -- run bd dep cycles to fix'. (2) blacksmith --status output: 'Schedulable: 21 beads (3 excluded -- dependency cycle) / warning Cycle: 3 beads (run bd dep cycles)'. Format cycle details showing the cycle path. See PRD: prd/SPEC-v3-agents.md lines 775-796.","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T18:30:00.078288Z","created_by":"Austin King","updated_at":"2026-02-15T20:07:27.152551Z","closed_at":"2026-02-15T20:07:27.152551Z","close_reason":"Surface cycle warnings in CLI run progress line","dependencies":[{"issue_id":"simple-agent-harness-cqf","depends_on_id":"simple-agent-harness-9xv","type":"blocks","created_at":"2026-02-15T18:30:30.164299Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-cqf","depends_on_id":"simple-agent-harness-fyx","type":"blocks","created_at":"2026-02-15T18:30:35.472911Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-cqf","depends_on_id":"simple-agent-harness-8iq","type":"blocks","created_at":"2026-02-15T18:30:35.589532Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-crv","title":"Document: Agent Adapters","description":"Write docs/adapters.md documenting the agent adapter system.\n\n## Content\n\nBased on prd/SPEC-v3-agents.md adapters section:\n- AgentAdapter trait\n- Built-in adapters (claude, codex, opencode, aider, raw)\n- Adapter auto-detection\n- Supported metrics per adapter\n- Graceful degradation\n- Prompt delivery (arg, stdin, file)\n- Creating custom adapters\n\n## Verification\n\nCheck if src/adapters/ directory exists or adapters module:\n- Verify adapter trait definition\n- List implemented adapters\n- Check auto-detection logic\n- Verify supported_metrics() implementation\n\nNote: Adapters may not be fully implemented. Document what exists, file beads for missing.\n\n## Affected Files\n\n- docs/adapters.md (new)","design":"DESCRIPTION\nWrite docs/adapters.md documenting the agent adapter system.\n\n## Content\n\nBased on prd/SPEC-v3-agents.md adapters section:\n- AgentAdapter trait\n- Built-in adapters (claude, codex, opencode, aider, raw)\n- Adapter auto-detection\n- Supported metrics per adapter\n- Graceful degradation\n- Prompt delivery (arg, stdin, file)\n- Creating custom adapters\n\n## Verification\n\nCheck if src/adapters/ directory exists or adapters module:\n- Verify adapter trait definition\n- List implemented adapters\n- Check auto-detection logic\n- Verify supported_metrics() implementation\n\nNote: Adapters may not be fully implemented. Document what exists, file beads for missing.\n\n## Affected Files\n\n- docs/adapters.md (new)\n\nDESIGN\nDESCRIPTION\nWrite docs/adapters.md documenting the agent adapter system.\n\n## Content\n\nBased on prd/SPEC-v3-agents.md adapters section:\n- AgentAdapter trait\n- Built-in adapters (claude, codex, opencode, aider, raw)\n- Adapter auto-detection\n- Supported metrics per adapter\n- Graceful degradation\n- Prompt delivery (arg, stdin, file)\n- Creating custom adapters\n\n## Verification\n\nCheck if src/adapters/ directory exists or adapters module:\n- Verify adapter trait definition\n- List implemented adapters\n- Check auto-detection logic\n- Verify supported_metrics() implementation\n\nNote: Adapters may not be fully implemented. Document what exists, file beads for missing.\n\n## Affected Files\n\n- docs/adapters.md (new)\n\n\naffected: docs/adapters.mdNOTES\n\naffected: docs/adapters.md","notes":"Reopened: docs/adapters.md not created","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:15:02.693759Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:37.704955Z","closed_at":"2026-02-16T17:01:30.716859Z","close_reason":"Documentation files verified against source code and corrected where needed.","dependencies":[{"issue_id":"simple-agent-harness-crv","depends_on_id":"simple-agent-harness-2kb","type":"blocks","created_at":"2026-02-16T16:15:55.769595Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-d2q","title":"Implement dynamic affected set expansion via .blacksmith-expand","description":"Watch for .blacksmith-expand file in each worker's worktree. When it appears, read new file globs from it, add them to the task's affected set in the coordinator database. Future scheduling decisions account for the expanded set. The request is always granted (optimistic concurrency). If expansion creates overlap with in-progress task, conflict is resolved at integration time. Reference: SPEC-v3-agents.md lines 493-507. Key files: src/coordinator.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:55:09.281514Z","created_by":"Austin King","updated_at":"2026-02-15T17:24:50.698656Z","closed_at":"2026-02-15T17:24:50.698656Z","close_reason":"Implement dynamic affected set expansion via .blacksmith-expand","dependencies":[{"issue_id":"simple-agent-harness-d2q","depends_on_id":"simple-agent-harness-1ky","type":"blocks","created_at":"2026-02-15T14:57:03.450145Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-d3v","title":"Implement session spawning and output capture","description":"Implement session.rs: spawn the agent subprocess using tokio::process::Command. Construct the command from config [agent] section, replacing {prompt} placeholder with actual prompt content. Pipe stdout and stderr to a JSONL output file named {output_prefix}-{global_iteration}.jsonl. Track the child PID and process group for later cleanup. Provide an async function that returns SessionResult with exit_code, output_bytes, duration. Acceptance: can spawn a simple command (e.g. echo), capture its output to a file, and report correct exit code and byte count. See PRD: Session Lifecycle, Architecture.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:19.006921Z","created_by":"Austin King","updated_at":"2026-02-15T00:06:54.404814Z","closed_at":"2026-02-15T00:06:54.404814Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-d3v","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:28.653853Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-d42","title":"Implement LLM-based intent analysis for tasks","description":"Implement the LLM call that reads a task/issue description and produces an IntentAnalysis — a list of semantic concept areas the task touches (e.g., 'auth_endpoints', 'middleware_stack', 'config'). Use existing LLM adapter infrastructure. Cache results keyed by content_hash. Only re-run when issue content changes. Ref: PRD section 'Layer 1: Intent Analysis'. Depends on intent analysis data model.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:11:33.149234Z","created_by":"Austin King","updated_at":"2026-02-15T21:21:03.376586Z","closed_at":"2026-02-15T21:21:03.376586Z","close_reason":"Implement LLM-based intent analysis with caching","dependencies":[{"issue_id":"simple-agent-harness-d42","depends_on_id":"simple-agent-harness-5f1","type":"blocks","created_at":"2026-02-15T20:13:46.575815Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-db7","title":"V5: Add CLI subcommand to run architecture analysis","description":"All V5 static analysis modules (import graph, module detection, fan-in, god file, circular deps, boundary violations, public API, structural metrics, signal correlation) are implemented with tests but are dead code - not accessible from any CLI command. Need a 'blacksmith analyze' or 'blacksmith arch' subcommand.\n\n## Done when\n- [ ] blacksmith analyze subcommand runs full structural analysis\n- [ ] Output shows fan-in hotspots, god files, cycles, boundary violations\n- [ ] Optional --json flag for machine-readable output\n- [ ] Signal correlation runs when DB has expansion events\n\n## Affected files\n- src/main.rs (modified - new subcommand + handler)\n- src/structural_metrics.rs (may need public API adjustments)","notes":"Reopened: blacksmith analyze subcommand not implemented","status":"open","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T16:29:38.089951Z","created_by":"Austin King","updated_at":"2026-02-16T16:56:39.093363Z"}
{"id":"simple-agent-harness-dfe","title":"Implement git revert rollback with entanglement tracking","description":"Implement rollback for integrated tasks: git revert handles code changes, manifest entries must also be reversed (remove pub mod, Cargo.toml dep, re-export). Track cross-task imports created during integration for entanglement-aware rollback ordering (can't revert A if B imports from A's module). Store cross_task_imports in integration_log. Reference: SPEC-v3-agents.md lines 659-665. Key files: src/integrator.rs, src/db.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:55:45.713332Z","created_by":"Austin King","updated_at":"2026-02-15T17:46:59.875521Z","closed_at":"2026-02-15T17:46:59.875521Z","close_reason":"Implement git revert rollback with entanglement tracking","dependencies":[{"issue_id":"simple-agent-harness-dfe","depends_on_id":"simple-agent-harness-yg5","type":"blocks","created_at":"2026-02-15T14:57:13.075999Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-dgh","title":"Implement session-to-bead attribution","description":"Multi-agent mode: attribution is explicit from worker_assignments table. Single-agent mode: infer attribution using file timestamps (ctime=start, mtime=end) and git commit correlation (scan git log --after/--before for bead IDs in commit subjects). Fallback: scan session JSONL result text for bead ID mentions. Store attributed bead_id as session.bead_id event during ingestion. Update bead_metrics table with cumulative timing. Reference: SPEC-v3-agents.md lines 724-748. Key files: src/ingest.rs, src/db.rs, src/coordinator.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:55:36.225144Z","created_by":"Austin King","updated_at":"2026-02-15T17:36:23.21126Z","closed_at":"2026-02-15T17:36:23.21126Z","close_reason":"Implement session-to-bead attribution","dependencies":[{"issue_id":"simple-agent-harness-dgh","depends_on_id":"simple-agent-harness-zl7","type":"blocks","created_at":"2026-02-15T14:57:07.381404Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-dq5","title":"Implementation Audit: Deployment (V3.5) and Architecture (V5)","description":"Verify V3.5 deployment and V5 architecture features.\n\n## V3.5 Checklist (prd/SPEC-v4-deploy-self-improvement.md)\n\n- [ ] Embedded defaults (PROMPT.md, skills, config)\n- [ ] First-run extraction to .blacksmith/\n- [ ] blacksmith init command\n- [ ] Config resolution order (CLI \u003e root \u003e .blacksmith \u003e defaults)\n- [ ] blacksmith finish subcommand\n- [ ] Worktree provisioning (skills copy)\n- [ ] Self-improvement promotion cycle\n- [ ] Quality gates configuration\n\n## V5 Checklist (prd/SPEC-v5-automated-architecture-and-metadata.md)\n\n- [ ] Intent analysis (layer 1)\n- [ ] File resolution (layer 2)\n- [ ] Metadata regeneration on scheduling\n- [ ] Import graph construction\n- [ ] Module detection\n- [ ] Fan-in scoring\n- [ ] God file detection\n- [ ] Circular dependency detection\n- [ ] Boundary violation detection\n- [ ] Public API surface analysis\n- [ ] Expansion event tracking\n- [ ] Signal correlation\n- [ ] Structural metrics computation\n- [ ] Architecture proposal generation\n- [ ] Proposal validation\n\n## Process\n\nV3.5: Check for defaults/ directory, init command, finish subcommand\nV5: Check all src/*analysis* and src/structural_* modules\n\nMany V5 features may be partially implemented or stubs. Document current state clearly.\n\n## Deliverables\n\n- Two checklists completed\n- Beads for missing/broken features\n- Roadmap notes for V5 completion\n\n## Affected Files\n\nNone (audit task)","design":"DESCRIPTION\nVerify V3.5 deployment and V5 architecture features.\n\n## V3.5 Checklist (prd/SPEC-v4-deploy-self-improvement.md)\n\n- [ ] Embedded defaults (PROMPT.md, skills, config)\n- [ ] First-run extraction to .blacksmith/\n- [ ] blacksmith init command\n- [ ] Config resolution order (CLI \u003e root \u003e .blacksmith \u003e defaults)\n- [ ] blacksmith finish subcommand\n- [ ] Worktree provisioning (skills copy)\n- [ ] Self-improvement promotion cycle\n- [ ] Quality gates configuration\n\n## V5 Checklist (prd/SPEC-v5-automated-architecture-and-metadata.md)\n\n- [ ] Intent analysis (layer 1)\n- [ ] File resolution (layer 2)\n- [ ] Metadata regeneration on scheduling\n- [ ] Import graph construction\n- [ ] Module detection\n- [ ] Fan-in scoring\n- [ ] God file detection\n- [ ] Circular dependency detection\n- [ ] Boundary violation detection\n- [ ] Public API surface analysis\n- [ ] Expansion event tracking\n- [ ] Signal correlation\n- [ ] Structural metrics computation\n- [ ] Architecture proposal generation\n- [ ] Proposal validation\n\n## Process\n\nV3.5: Check for defaults/ directory, init command, finish subcommand\nV5: Check all src/*analysis* and src/structural_* modules\n\nMany V5 features may be partially implemented or stubs. Document current state clearly.\n\n## Deliverables\n\n- Two checklists completed\n- Beads for missing/broken features\n- Roadmap notes for V5 completion\n\n## Affected Files\n\nNone (audit task)\n\n\naffected: src/data_dir.rs, src/migrate.rs, src/intent.rs, src/file_resolution.rs, src/metadata_regen.rs, src/import_graph.rs, src/module_detect.rs, src/fan_in.rs, src/god_file.rs, src/circular_dep.rs, src/boundary_violation.rs, src/structural_metrics.rs, src/expansion_event.rs, src/signal_correlator.rsNOTES","notes":"Reopened: V3.5/V5 audit not performed","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:15:40.338207Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:11.322685Z","closed_at":"2026-02-16T17:01:09.343751Z","close_reason":"V3.5/V5 audit complete: embedded defaults, init, config resolution, worktree provisioning verified. finish subcommand NOT implemented (filed bead simple-agent-harness-gaaf). V5: structural metrics, import graph, fan-in, god files, circular deps, boundary violations, public API, signal correlation all implemented. Intent/file resolution/proposal modules exist but have dead code (filed bead simple-agent-harness-ahur). Template vars not implemented (filed bead simple-agent-harness-cpy9)."}
{"id":"simple-agent-harness-drr","title":"Add proposal validation checks before creating refactor tasks","description":"Before a proposal becomes a refactor task, validate: (1) dependency feasibility — does the proposed split create circular deps? (2) API surface preservation — do all consumers still have access? (3) test coverage — are there tests for the boundaries being changed? (4) conflict check — would the refactor conflict with in-progress tasks? Proposals that pass become refactor issues in the tracker. Ref: PRD section 'Proposal Validation'. Depends on refactor proposal generation and import graph parser.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:12:37.730447Z","created_by":"Austin King","updated_at":"2026-02-16T01:42:48.234886Z","closed_at":"2026-02-16T01:42:48.234886Z","close_reason":"Implemented proposal_validation.rs with 4 validation checks (dependency feasibility, API surface preservation, test coverage, conflict with in-progress tasks) and 22 passing tests. Dependency cgo (proposal generation) defines the proposal format but this module defines its own RefactorProposal type that will be consumed by cgo.","dependencies":[{"issue_id":"simple-agent-harness-drr","depends_on_id":"simple-agent-harness-cgo","type":"blocks","created_at":"2026-02-15T20:14:01.020089Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-drr","depends_on_id":"simple-agent-harness-4a1","type":"blocks","created_at":"2026-02-15T20:14:01.143101Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-e2l","title":"Implement raw adapter with pass-through extraction","description":"Implement the raw adapter that does no format-specific parsing. Zero built-in metrics extracted (only session.output_bytes, session.exit_code, session.duration_secs from the harness). All ExtractionSource variants map to raw file lines. This is the fallback adapter for unrecognized agents. Reference: SPEC-v3-agents.md lines 321-332. Key files: src/adapters.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:53:42.158843Z","created_by":"Austin King","updated_at":"2026-02-15T16:08:17.219336Z","closed_at":"2026-02-15T16:08:17.219336Z","close_reason":"Raw adapter already fully implemented - verified and closed","dependencies":[{"issue_id":"simple-agent-harness-e2l","depends_on_id":"simple-agent-harness-wi2","type":"blocks","created_at":"2026-02-15T14:56:45.722586Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-ea2","title":"V3.5: Wire self-improvement promotion cycle into coordinator","description":"Improvement recording and brief generation work, but: (1) brief is not auto-injected into agent prompts, (2) promotion doesn't auto-edit PROMPT.md, (3) no feedback loop from metrics. The coordinator should inject open improvements into the prompt and auto-promote after N successful sessions.\n\n## Done when\n- [ ] Coordinator injects open improvements into agent prompt between iterations\n- [ ] Promoted improvements are written to PROMPT.md by coordinator\n- [ ] Auto-promotion after configurable session count with metric check\n\n## Affected files\n- src/coordinator.rs or src/pool.rs (modified)\n- src/improve.rs (modified)\n- src/config.rs (modified - ImprovementsConfig)","status":"open","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T16:29:47.265394Z","created_by":"Austin King","updated_at":"2026-02-16T16:29:47.265394Z"}
{"id":"simple-agent-harness-ec1","title":"Implement codex agent adapter","description":"Implement the codex adapter for parsing Codex CLI output. Supported metrics: turns.total, turns.tool_calls, session.output_bytes, session.exit_code, session.duration_secs. Not available (gracefully skipped): turns.narration_only, turns.parallel, cost.*. Map tool_commands to shell command invocations in function_call blocks. Reference: SPEC-v3-agents.md lines 286-300. Key files: src/adapters.rs.","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:54:05.401863Z","created_by":"Austin King","updated_at":"2026-02-15T18:00:46.331735Z","closed_at":"2026-02-15T18:00:46.331735Z","close_reason":"Implement codex agent adapter","dependencies":[{"issue_id":"simple-agent-harness-ec1","depends_on_id":"simple-agent-harness-wi2","type":"blocks","created_at":"2026-02-15T14:56:49.725291Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-edb","title":"Implement config validation with helpful error messages","description":"Add thorough validation to config loading: check that prompt_file exists, output_dir exists or can be created, command binary is in PATH, timeout values are positive, retry counts are non-negative, etc. Produce clear error messages indicating which field is invalid and what values are acceptable. Validate on load so errors surface immediately, not mid-run. Acceptance: invalid config produces clear, actionable error messages. See PRD: Configuration section.","status":"closed","priority":3,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-14T23:49:57.481176Z","created_by":"Austin King","updated_at":"2026-02-15T14:41:52.228991Z","closed_at":"2026-02-15T14:41:52.228991Z","close_reason":"Implement config validation with helpful error messages","dependencies":[{"issue_id":"simple-agent-harness-edb","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:58.073222Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-ee2","title":"Implement graceful metric degradation for adapter limitations","description":"When a target or brief references a metric the current adapter doesn't support (checked via supported_metrics()), silently skip it. The metrics targets command shows unavailable metrics as 'N/A (not available from \u003cadapter\u003e adapter)'. This allows a single blacksmith.toml to define targets for all metrics across different agents. Reference: SPEC-v3-agents.md lines 344-357. Key files: src/brief.rs, src/metrics_cmd.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:54:08.093032Z","created_by":"Austin King","updated_at":"2026-02-15T17:21:16.41857Z","closed_at":"2026-02-15T17:21:16.41857Z","close_reason":"Implement graceful metric degradation for adapter limitations","dependencies":[{"issue_id":"simple-agent-harness-ee2","depends_on_id":"simple-agent-harness-9jw","type":"blocks","created_at":"2026-02-15T14:56:51.1409Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-ee7","title":"Implement commit detection in session output","description":"Scan session output for commit indicators (bd-finish, git commit success patterns). Set 'committed' field in status file and event log. Used by --status command to show 'committed (bd-finish detected)' for last completed iteration. Patterns should be configurable. Acceptance: committed=true when output contains commit indicators. See PRD: Status File, Event Log sections.","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:49:32.16106Z","created_by":"Austin King","updated_at":"2026-02-15T04:53:28.723337Z","closed_at":"2026-02-15T04:53:28.723337Z","close_reason":"Implement commit detection in session output","dependencies":[{"issue_id":"simple-agent-harness-ee7","depends_on_id":"simple-agent-harness-p0y","type":"blocks","created_at":"2026-02-14T23:50:54.258018Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-ef5m","title":"P0: Clean up temp files when removing worktrees","description":"Temp directories created during agent sessions are not cleaned up, filling the hard drive.\n\n## Problem\n\nWhen agent sessions run, temp files are created (e.g., in `/private/var/folders/` on macOS).\nWhen worktrees are removed, these temp files are NOT cleaned up, accumulating over time.\n\n## Root Cause\n\nThe `worktree::remove()` function only calls `git worktree remove --force`, which removes\nthe worktree directory but not associated temp files created by the agent or blacksmith.\n\n## Portable Solution\n\nRust provides `std::env::temp_dir()` which returns the platform-specific temp directory:\n- macOS: `/private/var/folders/...`\n- Linux: `/tmp/`\n- Windows: `C:\\Users\\...\\AppData\\Local\\Temp\\`\n\nWe need to:\n1. Track temp files/dirs created during agent spawn\n2. Clean them up when the worktree is removed\n3. Use portable APIs, not hardcoded paths\n\n## Implementation Options\n\n### Option A: Track temp files in worker state\n```rust\npub struct Worker {\n    // ... existing fields ...\n    temp_files: Vec\u003cPathBuf\u003e,  // Track temp files to clean\n}\n\n// When spawning, if we create temp files:\nworker.temp_files.push(temp_file_path);\n\n// In pool.rs cleanup_worker():\nfor temp_file in \u0026worker.temp_files {\n    let _ = std::fs::remove_file(temp_file);\n    // Also try removing parent if it's a temp dir\n    if let Some(parent) = temp_file.parent() {\n        let _ = std::fs::remove_dir(parent);\n    }\n}\nworker.temp_files.clear();\n```\n\n### Option B: Use tempfile crate properly\nIf using `tempfile::TempDir` or `tempfile::NamedTempFile`, they auto-cleanup on drop.\nEnsure we're not leaking these (keeping them in scope too long).\n\n### Option C: Pattern-based cleanup\nWhen removing a worktree, search temp_dir() for dirs matching patterns:\n- `claude-*`\n- `blacksmith-*`\n- Use creation time heuristics\n\nThis is less reliable but catches leaked temps.\n\n## Investigation Needed\n\n1. Find where temp files are created:\n```bash\nrg \"temp_dir|TempDir|NamedTempFile\" src/\n```\n\n2. Check if spawn_agent_in_worktree creates temps\n3. Check if prompt assembly creates temp files\n4. Check if agent (Claude) creates temps we should clean\n\n## Immediate Workaround\n\nAdd to worktree::remove():\n```rust\npub fn remove(repo_dir: \u0026Path, wt_path: \u0026Path) -\u003e Result\u003c(), WorktreeError\u003e {\n    // ... existing git worktree remove ...\n    \n    // Portable temp cleanup (best-effort)\n    cleanup_temp_files_for_worktree(wt_path)?;\n    \n    Ok(())\n}\n\nfn cleanup_temp_files_for_worktree(wt_path: \u0026Path) -\u003e std::io::Result\u003c()\u003e {\n    // If the worktree path itself is in temp, remove it\n    let temp_root = std::env::temp_dir();\n    if wt_path.starts_with(\u0026temp_root) {\n        if wt_path.exists() {\n            std::fs::remove_dir_all(wt_path)?;\n        }\n    }\n    \n    // Additional pattern-based cleanup can go here\n    Ok(())\n}\n```\n\n## Done When\n\n- [ ] Temp files are cleaned up when worktrees are removed\n- [ ] Uses portable std::env::temp_dir(), not hardcoded paths\n- [ ] Works on macOS, Linux, Windows\n- [ ] Test: create worktree, spawn agent, remove worktree, verify no temp leak\n- [ ] cargo check, cargo test pass\n\naffected: src/worktree.rs, src/pool.rs","status":"open","priority":0,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T17:13:27.396311Z","created_by":"Austin King","updated_at":"2026-02-16T17:13:27.396311Z"}
{"id":"simple-agent-harness-ehy","title":"Add public API surface extractor for modules","description":"For each detected module, extract its public API surface: pub fn signatures, pub struct/enum definitions, pub trait definitions. Return a structured representation (ModuleApi { module_name, public_symbols: Vec\u003cSymbol\u003e }). This is used to compute API surface width (a structural smell) and to detect boundary violations. Ref: PRD section 'Wide public API surface' and 'Boundary violations'. Depends on import graph parser and module boundary detection.","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T20:10:41.84003Z","created_by":"Austin King","updated_at":"2026-02-16T00:05:13.983947Z","closed_at":"2026-02-16T00:05:13.983947Z","close_reason":"Add public API surface extractor for modules","dependencies":[{"issue_id":"simple-agent-harness-ehy","depends_on_id":"simple-agent-harness-4a1","type":"blocks","created_at":"2026-02-15T20:13:36.272192Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-ehy","depends_on_id":"simple-agent-harness-75u","type":"blocks","created_at":"2026-02-15T20:13:36.387677Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-emh","title":"Add configurable quality gates to finish config","description":"Add a [finish] section to HarnessConfig so quality gate commands are configurable instead of hardcoded to cargo check/cargo test. This makes blacksmith language-agnostic — TypeScript projects use tsc/jest, Go projects use go vet/go test. The finish subcommand reads these commands from config. Default values match current behavior (cargo check, cargo test). PRD ref: Milestones 2+5+6.\n\n## Done when\n- [ ] HarnessConfig has a FinishConfig struct with fields: check (String), test (String), lint (Option\u003cString\u003e), format (Option\u003cString\u003e)\n- [ ] Defaults: check='cargo check', test='cargo test', lint=None, format=None\n- [ ] FinishConfig is deserialized from [finish] section of blacksmith.toml\n- [ ] src/finish.rs reads gate commands from config instead of hardcoding cargo\n- [ ] defaults/blacksmith.toml includes commented [finish] section showing all options\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + any new tests)\n\n## Verify\n- Run: cargo run -- --dry-run 2\u003e\u00261 | grep finish\n- Expect: Shows finish.check and finish.test values\n- Run: cargo test config -- --nocapture\n- Expect: FinishConfig deserializes correctly from TOML\n\n## Affected files\n- src/config.rs (modified — add FinishConfig struct, wire into HarnessConfig)\n- src/finish.rs (modified — use config gates instead of hardcoded commands)\n- defaults/blacksmith.toml (modified — add [finish] section)","status":"closed","priority":0,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T02:34:52.936285Z","created_by":"Austin King","updated_at":"2026-02-16T02:56:13.706514Z","closed_at":"2026-02-16T02:56:13.706514Z","close_reason":"Added FinishConfig with configurable check/test/lint/format quality gates","dependencies":[{"issue_id":"simple-agent-harness-emh","depends_on_id":"simple-agent-harness-9kr","type":"blocks","created_at":"2026-02-16T02:36:57.450787Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-evl","title":"Implement improve add and improve list CLI subcommands","description":"Add clap subcommand structure: blacksmith improve add/list. The 'add' command takes title (positional), --category (required), --body, --context, --tags. Auto-assigns next ref (R1, R2, ...). The 'list' command supports --status and --category filters, displays in table format. Wire subcommands into main.rs CLI. PRD ref: CLI Interface \u003e Improvement commands. Files: src/main.rs (CLI struct), src/db.rs (insert/query), new src/improve.rs (command handlers).","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:15.855783Z","created_by":"Austin King","updated_at":"2026-02-15T13:55:59.763899Z","closed_at":"2026-02-15T13:55:59.763899Z","close_reason":"Implement improve add and improve list CLI subcommands","dependencies":[{"issue_id":"simple-agent-harness-evl","depends_on_id":"simple-agent-harness-sxy","type":"blocks","created_at":"2026-02-15T13:28:08.070976Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-ewc","title":"Scaffold Rust project with Cargo.toml and module stubs","description":"Set up the Rust project skeleton. Create Cargo.toml with all dependencies (clap, serde, toml, tokio, nix, chrono, serde_json, tracing, tracing-subscriber). Create src/ with stub files: main.rs, config.rs, runner.rs, session.rs, watchdog.rs, retry.rs, metrics.rs, signals.rs, hooks.rs. main.rs should have a minimal clap CLI that compiles and prints help. Include a default harness.toml with all config sections from the PRD. Acceptance: 'cargo build' succeeds, 'cargo run -- --help' prints usage.","status":"closed","priority":0,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-14T23:47:23.476559Z","created_by":"Austin King","updated_at":"2026-02-15T00:00:09.247912Z","closed_at":"2026-02-15T00:00:09.247912Z","close_reason":"Scaffold complete: cargo build succeeds, cargo run -- --help prints usage"}
{"id":"simple-agent-harness-f5re","title":"FIX P0: Add affected: declarations to all beads missing them","description":"Fix the single-worker bottleneck by adding proper affected set declarations to beads.\n\n## Problem\n\nBeads created with \"## Affected Files\" markdown but missing the parseable \"affected:\" line.\nScheduler treats missing affected set as \"affects everything\" which blocks parallel work.\n\n## Fix\n\nAdd \"affected: \u003cglobs\u003e\" to design field of all beads that need it.\n\nFormat:\n```\naffected: docs/, docs/README.md, src/foo.rs\n```\n(lowercase, colon, comma-separated globs)\n\n## Beads to Fix\n\nRun this to find beads without affected declarations:\n```bash\nbd list --status=open --limit=0 | while read line; do\n  id=$(echo \"$line\" | grep -o 'simple-agent-harness-[a-z0-9]*')\n  if [ -n \"$id\" ]; then\n    design=$(bd show \"$id\" | sed -n '/^DESCRIPTION$/,/^NOTES\\|BLOCKS\\|DEPENDS/p')\n    if ! echo \"$design\" | grep -qi \"^affected:\"; then\n      echo \"$id: MISSING affected declaration\"\n    fi\n  fi\ndone\n```\n\nThen for each, add affected line to design using:\n```bash\nbd update \u003cid\u003e --design=\"$(bd show \u003cid\u003e | sed -n '/^DESCRIPTION$/,/^NOTES/p' | sed '$ a\\\n\\\naffected: \u003cappropriate-globs\u003e')\n```\n\n## Priority Beads\n\nAt minimum, fix these to unblock parallelism:\n- simple-agent-harness-2kb: affected: docs/, docs/README.md\n- simple-agent-harness-c11: affected: docs/getting-started.md\n- simple-agent-harness-tdq: affected: docs/core-loop.md\n- simple-agent-harness-fv0: affected: docs/metrics-and-improvements.md\n\n(All doc beads are independent and can run in parallel once declared)\n\n## Verify\n\n```bash\n# Should show affected declarations\nbd show simple-agent-harness-2kb | grep \"^affected:\"\n\n# After fix, start coordinator and verify 3 workers spawn\n./target/release/blacksmith\n# Check worktrees\nls .blacksmith/worktrees/ | wc -l  # Should be 3\n```\n\n## Done When\n\n- [ ] All open beads have affected: declaration (or intentionally affect everything)\n- [ ] Coordinator spawns 3 workers for 3+ ready beads\n- [ ] Multiple worktrees active simultaneously\n- [ ] cargo check, cargo test pass\n\naffected: .beads/issues.jsonl","status":"closed","priority":0,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:59:17.664814Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:23.103736Z","closed_at":"2026-02-16T17:14:23.103736Z","close_reason":"Added affected: declarations to all 16 open documentation and audit beads. Format: lowercase 'affected:' followed by comma-separated globs. All doc beads are now independent and can run in parallel. Verified parseable by scheduler."}
{"id":"simple-agent-harness-f9m","title":"Implement worker pool manager for spawning and tracking workers","description":"Implement worker pool that manages up to workers.max concurrent agent sessions. Each worker runs in its own worktree. Track worker state: idle, coding, integrating, completed, failed. Spawn agent sessions in worktrees using the agent.coding config. Detect worker completion (process exit). Queue completed worktrees for integration. Add workers.max config field (default 1). Reference: SPEC-v3-agents.md lines 430-436, 509-549. Key files: src/coordinator.rs, src/config.rs, src/session.rs.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:54:50.954832Z","created_by":"Austin King","updated_at":"2026-02-15T15:49:29.798145Z","closed_at":"2026-02-15T15:49:29.798145Z","close_reason":"Implement worker pool manager for spawning and tracking workers","dependencies":[{"issue_id":"simple-agent-harness-f9m","depends_on_id":"simple-agent-harness-zl7","type":"blocks","created_at":"2026-02-15T14:56:57.713177Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-f9m","depends_on_id":"simple-agent-harness-1jv","type":"blocks","created_at":"2026-02-15T14:56:58.877989Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-fb6","title":"V1: Add resets.*UTC rate limit detection pattern","status":"open","priority":3,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T16:34:35.90612Z","created_by":"Austin King","updated_at":"2026-02-16T16:34:35.90612Z"}
{"id":"simple-agent-harness-fb9s","title":"V2: Fix duration metric naming inconsistency (claude ms vs others secs)","status":"open","priority":3,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T16:35:03.500722Z","created_by":"Austin King","updated_at":"2026-02-16T16:35:03.500722Z"}
{"id":"simple-agent-harness-fgf","title":"Implement --status CLI command","description":"When --status flag is passed, read harness.status JSON file and display formatted output: loop state, current iteration/max, global iteration, session output size and growth status, uptime, last completed iteration info. Print and exit (do not start the loop). Handle missing status file gracefully with 'No running harness detected'. See PRD: Status Command section.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:33.108264Z","created_by":"Austin King","updated_at":"2026-02-15T01:17:31.758447Z","closed_at":"2026-02-15T01:17:31.758447Z","close_reason":"Implement --status CLI command with formatted status display","dependencies":[{"issue_id":"simple-agent-harness-fgf","depends_on_id":"simple-agent-harness-3dl","type":"blocks","created_at":"2026-02-14T23:50:43.334863Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-fv0","title":"Document: Metrics and Improvements (V2)","description":"Write docs/metrics-and-improvements.md documenting the evolvable metrics system.\n\n## Content\n\nBased on prd/SPEC-v2-metrics.md:\n- Database schema (events, observations, improvements tables)\n- Event kinds and conventions\n- Improvements workflow (add, list, promote, dismiss)\n- Brief generation and injection\n- Configurable extraction rules\n- Targets and thresholds\n- CLI commands (blacksmith improve, blacksmith metrics)\n\n## Verification\n\nRead src/db.rs, src/metrics.rs, src/improve.rs, src/ingest.rs, src/brief.rs:\n- Verify tables match spec\n- Verify extraction rule engine\n- Verify target evaluation logic\n- Check brief generation\n- Confirm CLI completeness\n\nFile beads for any discrepancies.\n\n## Affected Files\n\n- docs/metrics-and-improvements.md (new)","design":"DESCRIPTION\nWrite docs/metrics-and-improvements.md documenting the evolvable metrics system.\n\n## Content\n\nBased on prd/SPEC-v2-metrics.md:\n- Database schema (events, observations, improvements tables)\n- Event kinds and conventions\n- Improvements workflow (add, list, promote, dismiss)\n- Brief generation and injection\n- Configurable extraction rules\n- Targets and thresholds\n- CLI commands (blacksmith improve, blacksmith metrics)\n\n## Verification\n\nRead src/db.rs, src/metrics.rs, src/improve.rs, src/ingest.rs, src/brief.rs:\n- Verify tables match spec\n- Verify extraction rule engine\n- Verify target evaluation logic\n- Check brief generation\n- Confirm CLI completeness\n\nFile beads for any discrepancies.\n\n## Affected Files\n\n- docs/metrics-and-improvements.md (new)\n\nDESIGN\nDESCRIPTION\nWrite docs/metrics-and-improvements.md documenting the evolvable metrics system.\n\n## Content\n\nBased on prd/SPEC-v2-metrics.md:\n- Database schema (events, observations, improvements tables)\n- Event kinds and conventions\n- Improvements workflow (add, list, promote, dismiss)\n- Brief generation and injection\n- Configurable extraction rules\n- Targets and thresholds\n- CLI commands (blacksmith improve, blacksmith metrics)\n\n## Verification\n\nRead src/db.rs, src/metrics.rs, src/improve.rs, src/ingest.rs, src/brief.rs:\n- Verify tables match spec\n- Verify extraction rule engine\n- Verify target evaluation logic\n- Check brief generation\n- Confirm CLI completeness\n\nFile beads for any discrepancies.\n\n## Affected Files\n\n- docs/metrics-and-improvements.md (new)\n\n\naffected: docs/metrics-and-improvements.mdNOTES\n\naffected: docs/metrics-and-improvements.md","notes":"Reopened: docs/metrics-and-improvements.md not created","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:14:28.578791Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:36.375086Z","closed_at":"2026-02-16T17:01:30.708355Z","close_reason":"Documentation files verified against source code and corrected where needed.","dependencies":[{"issue_id":"simple-agent-harness-fv0","depends_on_id":"simple-agent-harness-2kb","type":"blocks","created_at":"2026-02-16T16:15:54.990243Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-fvr","title":"Implement watchdog output-growth monitor","description":"Implement watchdog.rs: a tokio task that monitors the output file for growth. Algorithm: record initial size, check every check_interval_secs, reset stale timer on growth, kill process group after stale_timeout_mins of no growth. Process cleanup: SIGTERM to process group, wait 5s, SIGKILL if still alive, collect exit status. Return exit code 124 on timeout kill. Uses nix crate for signal/process group management. Acceptance: unit test with a mock slow-writing process that gets killed after stale timeout. See PRD: Watchdog section.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:29.04948Z","created_by":"Austin King","updated_at":"2026-02-15T00:10:59.0807Z","closed_at":"2026-02-15T00:10:59.0807Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-fvr","depends_on_id":"simple-agent-harness-d3v","type":"blocks","created_at":"2026-02-14T23:50:29.92715Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-fyx","title":"Wire cycle detection into coordinator scheduling pass","description":"Modify coordinator.rs scheduling pass to call cycle_detect::detect_cycles() on every scheduling pass (not just startup). Build dependency graph from bd list JSON output (dependencies array already available in parse_ready_beads_json). Filter cycled beads out of the scheduling pool before passing to next_assignable_tasks(). Log each detected cycle with full path (A -\u003e B -\u003e C -\u003e A). Self-healing: cycles broken mid-run via bd dep rm are picked up on next pass automatically. See PRD: prd/SPEC-v3-agents.md lines 685-722.","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T18:29:57.183165Z","created_by":"Austin King","updated_at":"2026-02-15T19:33:13.127139Z","closed_at":"2026-02-15T19:33:13.127139Z","close_reason":"Verified cycle detection already wired into coordinator scheduling pass","dependencies":[{"issue_id":"simple-agent-harness-fyx","depends_on_id":"simple-agent-harness-9xv","type":"blocks","created_at":"2026-02-15T18:30:29.929937Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-gaaf","title":"Implement blacksmith finish subcommand (V3.5 spec)","status":"open","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T16:59:42.057373Z","created_by":"Austin King","updated_at":"2026-02-16T16:59:42.057373Z"}
{"id":"simple-agent-harness-gkx","title":"Add architecture agent runner with trigger logic","description":"Implement the architecture agent runner that triggers analysis on schedule. The runner monitors task completion events and decides when to run the architecture pipeline. Three trigger modes from the PRD: (1) Periodic — after every N task completions (configurable, default 10), (2) Threshold — when rolling average of expansion events or integration iterations exceeds a configurable threshold, (3) Pre-planning — callable before decomposing a large feature. The runner calls run_architecture_pipeline() and handles the results. PRD ref: 'Analysis Process' triggers section.\n\n## Done when\n- [ ] ArchitectureRunner struct with run_if_needed(trigger_context) method\n- [ ] Periodic trigger: counts task completions since last run, fires at threshold\n- [ ] Threshold trigger: queries expansion_events and integration_iterations rolling averages\n- [ ] Pre-planning trigger: explicit call with feature description\n- [ ] Runner calls run_architecture_pipeline() when triggered\n- [ ] Results logged and proposals stored in DB\n- [ ] Config knobs: arch_review_interval (default 10), expansion_threshold (default 5 in 20), integration_iteration_threshold (default 3.0)\n- [ ] Coordinator calls runner.run_if_needed() after each successful task integration\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes\n\n## Verify\n- Run: cargo test architecture_runner -- --nocapture\n- Expect: Tests for periodic trigger, threshold trigger, no-op when below threshold\n\n## Affected files\n- src/architecture_runner.rs (new - runner with trigger logic)\n- src/config.rs (modified - add trigger config knobs)\n- src/coordinator.rs (modified - call runner after integration)\n- src/main.rs (modified - add mod architecture_runner)","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T03:43:04.028441Z","created_by":"Austin King","updated_at":"2026-02-16T06:03:34.243972Z","closed_at":"2026-02-16T06:03:34.243972Z","close_reason":"Implemented ArchitectureRunner with periodic, threshold (expansion events + integration iterations), and pre-planning triggers. Added arch_review_interval and integration_iteration_threshold config knobs. Coordinator calls runner.run_if_needed() after each successful integration. 7 runner tests + 2 pipeline tests pass.","dependencies":[{"issue_id":"simple-agent-harness-gkx","depends_on_id":"simple-agent-harness-4zi","type":"blocks","created_at":"2026-02-16T03:44:44.654676Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-gua","title":"V5: Wire architecture review triggers (periodic, threshold, pre-planning)","description":"Per the spec, architecture analysis should run: (1) after every N task completions, (2) when expansion events exceed threshold, (3) before decomposing large features. Config exists (architecture.expansion_event_threshold etc.) but nothing triggers the analysis automatically.\n\n## Done when\n- [ ] Coordinator triggers analysis after every N task completions (configurable)\n- [ ] Expansion event threshold triggers automatic review\n- [ ] Architecture config values in blacksmith.toml are actually consumed\n\n## Affected files\n- src/coordinator.rs or src/pool.rs (modified)\n- src/config.rs (already has ArchitectureConfig)","status":"open","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T16:29:44.006388Z","created_by":"Austin King","updated_at":"2026-02-16T16:29:44.006388Z","dependencies":[{"issue_id":"simple-agent-harness-gua","depends_on_id":"simple-agent-harness-db7","type":"blocks","created_at":"2026-02-16T16:30:10.028446Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-gyc","title":"Implementation Audit: Multi-Agent (V3)","description":"Systematically verify V3 multi-agent features are implemented correctly.\n\n## Checklist\n\nRead prd/SPEC-v3-agents.md and verify:\n- [ ] .blacksmith/ data directory structure\n- [ ] Session compression (zstd)\n- [ ] Retention policies (last-N, Nd, all, after-ingest)\n- [ ] Coordinator state tables (worker_assignments, task_file_changes, integration_log, bead_metrics)\n- [ ] Worker pool spawning and tracking\n- [ ] Git worktree creation/cleanup\n- [ ] Scheduler conflict detection (affected set overlap)\n- [ ] Cycle detection (Kahn + Tarjan)\n- [ ] Dynamic affected set expansion (.blacksmith-expand)\n- [ ] task_manifest.toml parsing\n- [ ] Integration loop (merge, apply manifests, fix, test)\n- [ ] Circuit breaker (max fix iterations)\n- [ ] Reconciliation (periodic full tests)\n- [ ] Session-to-bead attribution\n- [ ] Time estimation (serial and parallel)\n- [ ] workers CLI (status, kill)\n- [ ] integration CLI (log, retry)\n\n## Process\n\nFor each feature:\n1. Check src/ modules\n2. Verify against spec\n3. Test manually if possible\n4. File bead for issues\n\n## Deliverables\n\n- Completed checklist\n- Beads for gaps/bugs\n- V3 implementation status\n\n## Affected Files\n\nNone (audit task)","design":"DESCRIPTION\nSystematically verify V3 multi-agent features are implemented correctly.\n\n## Checklist\n\nRead prd/SPEC-v3-agents.md and verify:\n- [ ] .blacksmith/ data directory structure\n- [ ] Session compression (zstd)\n- [ ] Retention policies (last-N, Nd, all, after-ingest)\n- [ ] Coordinator state tables (worker_assignments, task_file_changes, integration_log, bead_metrics)\n- [ ] Worker pool spawning and tracking\n- [ ] Git worktree creation/cleanup\n- [ ] Scheduler conflict detection (affected set overlap)\n- [ ] Cycle detection (Kahn + Tarjan)\n- [ ] Dynamic affected set expansion (.blacksmith-expand)\n- [ ] task_manifest.toml parsing\n- [ ] Integration loop (merge, apply manifests, fix, test)\n- [ ] Circuit breaker (max fix iterations)\n- [ ] Reconciliation (periodic full tests)\n- [ ] Session-to-bead attribution\n- [ ] Time estimation (serial and parallel)\n- [ ] workers CLI (status, kill)\n- [ ] integration CLI (log, retry)\n\n## Process\n\nFor each feature:\n1. Check src/ modules\n2. Verify against spec\n3. Test manually if possible\n4. File bead for issues\n\n## Deliverables\n\n- Completed checklist\n- Beads for gaps/bugs\n- V3 implementation status\n\n## Affected Files\n\nNone (audit task)\n\n\naffected: src/coordinator.rs, src/scheduler.rs, src/pool.rs, src/worktree.rs, src/integrator.rs, src/cycle_detect.rs, src/estimation.rsNOTES","notes":"Reopened: V3 audit not performed","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:15:33.045973Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:11.090579Z","closed_at":"2026-02-16T17:01:06.06275Z","close_reason":"V3 audit complete: .blacksmith/ dir, compression, retention, coordinator, worker pool, worktrees, scheduler conflict detection, cycle detection, expansion events, task manifests, integration loop, circuit breaker, reconciliation, bead metrics, estimation, CLI commands all verified."}
{"id":"simple-agent-harness-h97","title":"Add target miss warnings and streak detection to brief output","description":"Extend brief output to auto-generate warnings when targets are missed. Include streak detection: escalate warnings after N consecutive misses (configurable). Format per PRD brief example. PRD ref: Milestone 3 bullet points. Files: src/brief.rs, src/config.rs (streak config).","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:40.106578Z","created_by":"Austin King","updated_at":"2026-02-15T14:34:08.657923Z","closed_at":"2026-02-15T14:34:08.657923Z","close_reason":"Add target miss warnings and streak detection to brief output","dependencies":[{"issue_id":"simple-agent-harness-h97","depends_on_id":"simple-agent-harness-pcb","type":"blocks","created_at":"2026-02-15T13:28:30.759438Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-h97","depends_on_id":"simple-agent-harness-obm","type":"blocks","created_at":"2026-02-15T13:28:32.155079Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-hhv","title":"Implement blacksmith metrics reingest command","description":"Add blacksmith metrics reingest CLI subcommand. When extraction rules change, re-ingest historical sessions: decompresses .jsonl.zst files as needed, re-runs extraction through the adapter, and updates the events table. Supports --last N (reingest N most recent) and --all (reingest everything). Only works for sessions that haven't been deleted. Reference: SPEC-v3-agents.md lines 179-187. Key files: src/main.rs, src/metrics_cmd.rs, src/ingest.rs, src/storage.rs.","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:54:30.097639Z","created_by":"Austin King","updated_at":"2026-02-15T18:19:16.134214Z","closed_at":"2026-02-15T18:19:16.134214Z","close_reason":"Implement metrics reingest command","dependencies":[{"issue_id":"simple-agent-harness-hhv","depends_on_id":"simple-agent-harness-x1a","type":"blocks","created_at":"2026-02-15T14:56:53.587272Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-hhv","depends_on_id":"simple-agent-harness-9jw","type":"blocks","created_at":"2026-02-15T14:56:54.760465Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-hxq","title":"Add agent.coding and agent.integration config sections","description":"Add [agent.coding] and [agent.integration] config sections. agent.coding configures the agent for creative coding work. agent.integration configures a potentially cheaper/faster model for the integration loop. If agent.integration is omitted, falls back to agent.coding. If neither is set, the legacy [agent] section is used. Deprecate flat [agent] section with a warning but keep it working. Reference: SPEC-v3-agents.md lines 196-223. Key files: src/config.rs, src/runner.rs, src/session.rs.","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T14:53:56.539643Z","created_by":"Austin King","updated_at":"2026-02-15T17:06:57.023217Z","closed_at":"2026-02-15T17:06:57.023217Z","close_reason":"Add agent.coding and agent.integration config sections with phase-specific resolution"}
{"id":"simple-agent-harness-i9s","title":"Implement configurable extraction rules from TOML config","description":"Parse [metrics.extract.rules] from blacksmith.toml config. Each rule has: kind, pattern (regex), optional anti_pattern, source (tool_commands/text/raw), transform (last_segment/int/trim), first_match, count, emit. Apply rules during JSONL ingestion alongside built-in metrics. Adding a new metric = 3-4 lines of TOML. PRD ref: Configurable Extraction Rules. Files: src/config.rs (new MetricsExtractConfig), src/ingest.rs (apply rules during parse).","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:37.285841Z","created_by":"Austin King","updated_at":"2026-02-15T14:24:50.388679Z","closed_at":"2026-02-15T14:24:50.388679Z","close_reason":"Implement configurable extraction rules from TOML config","dependencies":[{"issue_id":"simple-agent-harness-i9s","depends_on_id":"simple-agent-harness-8j5","type":"blocks","created_at":"2026-02-15T13:28:28.08633Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-ib1","title":"Add storage config and .blacksmith/ directory initialization","description":"Add storage.data_dir config field (default .blacksmith/). Create DataDir struct that manages the directory layout: blacksmith.db, status, counter, sessions/, worktrees/. Implement blacksmith init CLI command that creates the full directory structure and appends .blacksmith/ to .gitignore if not already present. Auto-create on first blacksmith run if missing. Reference: SPEC-v3-agents.md Data Directory section, lines 33-87. Key files: src/config.rs, src/main.rs.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:53:08.990315Z","created_by":"Austin King","updated_at":"2026-02-15T15:01:15.846572Z","closed_at":"2026-02-15T15:01:15.846572Z","close_reason":"Add storage config and .blacksmith/ directory initialization"}
{"id":"simple-agent-harness-ijkt","title":"Update /prd-to-beads skill to add affected: declarations","description":"Fix the prd-to-beads skill to automatically add affected: declarations to created beads.\n\n## Problem\n\nWhen /prd-to-beads creates beads, they have \"## Affected Files\" markdown but not\nthe parseable \"affected: glob1, glob2\" format the scheduler needs.\n\n## Fix\n\nUpdate .claude/skills/prd-to-beads/SKILL.md to:\n\n1. Include \"affected:\" line in bead template\n2. Instruct agent to list file globs (not just file descriptions)\n3. Format: lowercase \"affected:\" at start of line, comma-separated globs\n\n## Example Output Change\n\nBefore:\n```\n## Affected Files\n- docs/core-loop.md (new)\n```\n\nAfter:\n```\n## Affected Files\n- docs/core-loop.md (new)\n\naffected: docs/core-loop.md\n```\n\n## Template Addition\n\nAdd to skill instructions:\n```markdown\nAfter \"## Affected Files\" section, add a parseable affected set:\n\naffected: \u003cglob1\u003e, \u003cglob2\u003e, ...\n\nThis line MUST:\n- Start with lowercase \"affected:\"\n- Use comma-separated glob patterns\n- Match the files listed in Affected Files section\n- Use globs (*.rs, **/*.md) for directories/patterns\n```\n\n## Verify\n\n```bash\n# Create test bead with the skill\n# Check it has affected: line\nbd show \u003cnew-bead-id\u003e | grep \"^affected:\"\n```\n\n## Done When\n\n- [ ] .claude/skills/prd-to-beads/SKILL.md updated\n- [ ] Test bead created has affected: line\n- [ ] Line uses glob patterns, not file descriptions\n- [ ] Scheduler can parse the affected set\n\naffected: .claude/skills/prd-to-beads/SKILL.md","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:59:40.291153Z","created_by":"Austin King","updated_at":"2026-02-16T16:59:40.291153Z"}
{"id":"simple-agent-harness-ikw","title":"Implement file resolution from intent concepts","description":"Map semantic concepts from Layer 1 intent analysis onto concrete files and modules at current HEAD. Use import graph and module boundary detection to resolve concepts like 'auth_endpoints' to specific files. Compute blast_radius by finding transitive dependents in the import graph. This is pure static analysis — no LLM involved. Ref: PRD section 'Layer 2: File Resolution'. Depends on file resolution data model, import graph parser, and module boundary detection.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:11:35.661161Z","created_by":"Austin King","updated_at":"2026-02-16T00:01:49.29347Z","closed_at":"2026-02-16T00:01:49.29347Z","close_reason":"Implement file resolution from intent concepts","dependencies":[{"issue_id":"simple-agent-harness-ikw","depends_on_id":"simple-agent-harness-0lk","type":"blocks","created_at":"2026-02-15T20:13:46.691145Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-ikw","depends_on_id":"simple-agent-harness-4a1","type":"blocks","created_at":"2026-02-15T20:13:46.806122Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-ikw","depends_on_id":"simple-agent-harness-75u","type":"blocks","created_at":"2026-02-15T20:13:46.920049Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-irr","title":"Add architecture agent trigger system (periodic and threshold)","description":"Implement trigger system for the architecture agent: (1) periodic — run after every N tasks complete (configurable, default 10), (2) threshold-triggered — when rolling averages of expansion events or integration iterations exceed a threshold. Wire triggers into the coordinator loop so the architecture analysis runs automatically when conditions are met. Ref: PRD section 'Analysis Process' triggers.\n\n## Done when\n- [ ] PeriodicTrigger fires after N completed tasks (configurable via config, default 10)\n- [ ] ThresholdTrigger fires when expansion_events in last 20 tasks exceed threshold (default 5)\n- [ ] Triggers are checked in the coordinator loop after each worker completion\n- [ ] When a trigger fires, it logs the trigger type and reason\n- [ ] Triggers are no-ops when architecture agent is disabled in config\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + new trigger tests)\n\n## Verify\n- Run: cargo test trigger\n- Run: Add a unit test that simulates 10 task completions and asserts periodic trigger fires\n- Run: Add a unit test that injects 6 expansion events in 20 tasks and asserts threshold trigger fires\n- Expect: Both trigger types fire at correct thresholds and are independently configurable\n\n## Affected files\n- src/trigger.rs (new)\n- src/coordinator.rs (modified — add trigger checks after worker completion)\n- src/config.rs (modified — add trigger config knobs)\n- src/main.rs (modified — add mod trigger)","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:13:01.893341Z","created_by":"Austin King","updated_at":"2026-02-16T01:49:34.183698Z","closed_at":"2026-02-16T01:49:34.183698Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-irr","depends_on_id":"simple-agent-harness-drr","type":"blocks","created_at":"2026-02-15T20:14:01.260019Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-j1w","title":"Implement metrics migrate command for V1 data import","description":"Implement 'blacksmith metrics migrate --from \u003cpath\u003e' to import V1 self-improvement.db data. Map V1 sessions table columns to V2 event kinds per PRD mapping (assistant_turns -\u003e turns.total, etc). Copy improvements rows mapping severity -\u003e category. Rebuild observations after import. PRD ref: Migration from V1. Files: src/metrics_cmd.rs (migrate command), src/db.rs (V1 schema read).","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:41.86492Z","created_by":"Austin King","updated_at":"2026-02-15T14:45:43.086057Z","closed_at":"2026-02-15T14:45:43.086057Z","close_reason":"Implement metrics migrate command for V1 data import","dependencies":[{"issue_id":"simple-agent-harness-j1w","depends_on_id":"simple-agent-harness-cl6","type":"blocks","created_at":"2026-02-15T13:28:33.384002Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-jkn","title":"Implement blacksmith migrate --consolidate command","description":"Add blacksmith migrate --consolidate CLI command for V2-\u003eV3 file migration. Find blacksmith.db/harness.db in old output directory. Move {output_prefix}-*.jsonl files into .blacksmith/sessions/, renaming to {N}.jsonl. Move counter and status files. Print summary of what moved. Non-destructive (move, not copy-delete). Stop and report on failure. Reference: SPEC-v3-agents.md lines 89-100. Key files: src/main.rs, src/storage.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:54:02.18888Z","created_by":"Austin King","updated_at":"2026-02-15T17:15:32.25006Z","closed_at":"2026-02-15T17:15:32.25006Z","close_reason":"Implement blacksmith migrate --consolidate command","dependencies":[{"issue_id":"simple-agent-harness-jkn","depends_on_id":"simple-agent-harness-ib1","type":"blocks","created_at":"2026-02-15T14:56:46.562382Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-jr7","title":"Implement retry policy for empty sessions","description":"Implement retry.rs: detect when session output is below min_output_bytes threshold. On empty session: log warning with output size, increment global_iteration (new output filename), re-run session with same prompt, after max_empty_retries failures skip to next iteration. Empty retries do NOT increment productive iteration counter and do NOT trigger post-session hooks. Acceptance: unit test showing retry behavior with configurable thresholds. See PRD: Retry Policy section.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:38.6347Z","created_by":"Austin King","updated_at":"2026-02-15T00:13:47.076532Z","closed_at":"2026-02-15T00:13:47.076532Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-jr7","depends_on_id":"simple-agent-harness-d3v","type":"blocks","created_at":"2026-02-14T23:50:31.225368Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-k53","title":"Integrate automatic post-session JSONL ingestion into loop","description":"Wire automatic JSONL ingestion into the session loop in runner.rs. After each session completes and passes retry evaluation (step 6 in lifecycle), call the ingest module to parse the session output file and write events to blacksmith.db. Pass session number and duration from the harness. Only runs when metrics DB exists. PRD ref: Loop Integration \u003e Post-session: Automatic Ingestion, Loop Lifecycle step 6. Files: src/runner.rs.","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:31.893918Z","created_by":"Austin King","updated_at":"2026-02-15T14:10:12.993409Z","closed_at":"2026-02-15T14:10:12.993409Z","close_reason":"Wire automatic JSONL ingestion into runner loop","dependencies":[{"issue_id":"simple-agent-harness-k53","depends_on_id":"simple-agent-harness-8j5","type":"blocks","created_at":"2026-02-15T13:28:19.137505Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-kcvp","title":"V3: Improve glob overlap detection beyond conservative prefix matching","status":"open","priority":4,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:35:30.9718Z","created_by":"Austin King","updated_at":"2026-02-16T16:35:30.9718Z"}
{"id":"simple-agent-harness-krl","title":"Restore deleted architecture and infrastructure files","description":"An agent staged deletions of 11 files totaling ~3,000+ lines of recently-completed work. These files exist in HEAD but are staged for deletion and removed from disk. Must be restored before any architecture PRD work can proceed.\n\nFiles to restore (git checkout HEAD -- \u003cfile\u003e):\n- src/proposal_generation.rs (393 lines, bead cgo)\n- src/proposal_validation.rs (1218 lines, bead drr)\n- src/migration_apply.rs (833 lines, bead as9)\n- src/migration_map.rs (405 lines, bead 83g)\n- src/finish.rs (216 lines, bead 9kr)\n- src/defaults.rs (11 lines, bead aev)\n- defaults/PROMPT.md, defaults/bd-finish.sh, defaults/blacksmith.toml\n- defaults/skills/break-down-issue.md, defaults/skills/prd-to-beads.md, defaults/skills/self-improvement.md\n\nAlso restore deleted mod declarations in src/main.rs: defaults, finish, migration_apply, migration_map, proposal_generation. Restore Init subcommand --force/--export flags and Finish subcommand in Commands enum.\n\n## Done when\n- [ ] All 11 files exist on disk with content matching HEAD\n- [ ] src/main.rs has all mod declarations restored\n- [ ] Commands::Init has force and export_files flags\n- [ ] Commands::Finish variant exists with bead_id, message, files args\n- [ ] git diff --cached shows no unexpected deletions\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes\n\n## Verify\n- Run: git diff --cached --name-only --diff-filter=D | wc -l\n- Expect: 0 (no staged deletions)\n- Run: cargo check 2\u003e\u00261 | grep error | wc -l\n- Expect: 0\n\n## Affected files\n- src/main.rs (modified)\n- src/proposal_generation.rs (restored)\n- src/proposal_validation.rs (restored)\n- src/migration_apply.rs (restored)\n- src/migration_map.rs (restored)\n- src/finish.rs (restored)\n- src/defaults.rs (restored)\n- defaults/*.md, defaults/*.sh, defaults/*.toml (restored)","status":"closed","priority":0,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T03:42:37.661275Z","created_by":"Austin King","updated_at":"2026-02-16T05:56:50.102856Z","closed_at":"2026-02-16T05:56:50.102856Z","close_reason":"All files already restored via merge 1b1bbc3. Verified: all 11 files exist, mod declarations present, Init/Finish commands intact, 0 staged deletions, cargo check and cargo test (1200 passed) both succeed."}
{"id":"simple-agent-harness-ldy","title":"Add integration loop iteration tracking","description":"Track how many fix-loop iterations each task requires during integration. High iteration counts mean interfaces between modules were unclear or blast radius was underestimated. Store per-task iteration count and which modules were involved. DB table + recording API called from integrator. Ref: PRD section 'Integration loop iterations'. Lives in src/integrator.rs or new src/historical_signals.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:12:15.535203Z","created_by":"Austin King","updated_at":"2026-02-15T22:25:42.07923Z","closed_at":"2026-02-15T22:25:42.07923Z","close_reason":"Add integration loop iteration tracking: DB table + recording API + integrator wiring"}
{"id":"simple-agent-harness-lo32","title":"V3: Fix cleanup_orphans potential race with worker spawn","status":"open","priority":3,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T16:35:39.845525Z","created_by":"Austin King","updated_at":"2026-02-16T16:35:39.845525Z"}
{"id":"simple-agent-harness-lp3","title":"Add worktree provision/deprovision for skills","description":"Add provision and deprovision steps to worktree lifecycle so parallel agents on non-blacksmith repos have access to Claude skills. On worktree::create, copy .blacksmith/skills/ to worktree/.claude/skills/. On worktree::remove, clean up the .claude/ directory. This is needed because Claude discovers skills from .claude/skills/ in CWD, and worktrees are bare git checkouts without these files. PRD ref: Milestone 3.\n\n## Done when\n- [ ] worktree::create returns a worktree where .claude/skills/ exists with all skill files\n- [ ] provision_worktree() copies from DataDir skills_dir to worktree/.claude/skills/\n- [ ] provision_worktree() is no-op if source skills dir doesn't exist (graceful degradation)\n- [ ] deprovision_worktree() removes worktree/.claude/ dir before git worktree remove\n- [ ] pool.rs calls provision after create, deprovision before remove\n- [ ] New test: test_provision_copies_skills — creates worktree, verifies skills present\n- [ ] New test: test_deprovision_cleans_up — removes worktree, verifies .claude/ gone\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + any new tests)\n\n## Verify\n- Run: cargo test provision -- --nocapture\n- Expect: Tests pass, skills copied and cleaned up correctly\n\n## Affected files\n- src/worktree.rs (modified — add provision_worktree, deprovision_worktree)\n- src/pool.rs (modified — call provision/deprovision at appropriate points)","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T02:34:57.182356Z","created_by":"Austin King","updated_at":"2026-02-16T03:01:40.87257Z","closed_at":"2026-02-16T03:01:40.87257Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-lp3","depends_on_id":"simple-agent-harness-vv3","type":"blocks","created_at":"2026-02-16T02:36:58.767923Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-lv4d","title":"V2: Move brief subcommand under metrics namespace","status":"open","priority":4,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:35:14.303158Z","created_by":"Austin King","updated_at":"2026-02-16T16:35:14.303158Z"}
{"id":"simple-agent-harness-m5l","title":"Implement integration agent spawning for compiler fixes","description":"After merge and manifest application, run cargo check / tsc --noEmit. If errors: spawn integration agent (using [agent.integration] config) to apply surgical fixes (missing imports, name collisions). Retry up to 3 times (circuit breaker). Integration uses the same worktree to preserve build artifacts. Reference: SPEC-v3-agents.md lines 571-578. Key files: src/integrator.rs, src/session.rs.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:55:10.229199Z","created_by":"Austin King","updated_at":"2026-02-15T17:12:40.723152Z","closed_at":"2026-02-15T17:12:40.723152Z","close_reason":"Implement integration agent spawning with compiler check and fix retry loop","dependencies":[{"issue_id":"simple-agent-harness-m5l","depends_on_id":"simple-agent-harness-3pa","type":"blocks","created_at":"2026-02-15T14:57:05.164828Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-m5l","depends_on_id":"simple-agent-harness-v6v","type":"blocks","created_at":"2026-02-15T14:57:06.3048Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-m5l","depends_on_id":"simple-agent-harness-hxq","type":"blocks","created_at":"2026-02-15T14:57:08.012934Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-m5l","depends_on_id":"simple-agent-harness-t4x","type":"blocks","created_at":"2026-02-15T16:45:38.150394Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-m6l","title":"Wire post-session cargo check gate before bead closure","description":"Agents close beads claiming success without verifying compilation. Session 50 closed the singleton lock P0 bead but singleton.rs doesn't compile (missing fs2 crate). Need a post-session hook or gate that runs 'cargo check' and prevents bead closure if it fails. This should be a built-in harness feature, not reliant on agent discipline. Could be: (1) a post_session hook that runs cargo check, (2) a bd close pre-check that verifies build, or (3) a configurable validation step in the session loop before marking success.","status":"closed","priority":0,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T00:32:41.554324Z","created_by":"Austin King","updated_at":"2026-02-16T00:38:40.566669Z","closed_at":"2026-02-16T00:38:40.566669Z","close_reason":"Wire cargo check gate in bd-finish.sh to prevent closing beads with non-compiling code"}
{"id":"simple-agent-harness-mjx","title":"Implement affected set parsing and glob overlap detection","description":"Parse affected sets from bead design field using the convention 'affected: \u003cglob\u003e, \u003cglob\u003e, ...'. Implement globs_overlap() function that checks if two sets of file globs have potential overlap. A bead without an affected set is treated as affecting everything (not parallelizable). Reference: SPEC-v3-agents.md lines 440-483. Key files: new src/coordinator.rs or src/scheduler.rs.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:54:32.326556Z","created_by":"Austin King","updated_at":"2026-02-15T15:42:14.592888Z","closed_at":"2026-02-15T15:42:14.592888Z","close_reason":"Implement affected set parsing and glob overlap detection"}
{"id":"simple-agent-harness-ml7","title":"Implement serial and parallel time estimation from bead_metrics","description":"Serial estimate: avg_time = sum(wall_time_secs) / count(closed beads), remaining = count(open) * avg_time. Show 'insufficient data' if \u003c 3 completed beads. Parallel estimate: build dependency DAG, find critical path, parallel_time = max(critical_path_time, serial_time / N) + integration_overhead. Integration_overhead = avg_integration_time * count(open). N = workers.max. Reference: SPEC-v3-agents.md lines 749-778. Key files: src/coordinator.rs or new src/estimation.rs, src/db.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:55:54.262895Z","created_by":"Austin King","updated_at":"2026-02-15T17:52:04.958593Z","closed_at":"2026-02-15T17:52:04.958593Z","close_reason":"Implement serial and parallel time estimation from bead_metrics","dependencies":[{"issue_id":"simple-agent-harness-ml7","depends_on_id":"simple-agent-harness-dgh","type":"blocks","created_at":"2026-02-15T14:57:14.484435Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-mxg","title":"Implement prompt prepend_commands for dynamic prompt construction","description":"Support [prompt] config section with file and prepend_commands fields. Read prompt from file, run each prepend command and capture stdout, prepend non-empty outputs to prompt separated by newline-dash-newline. Empty command output is silently skipped. This replaces inline bash logic for injecting performance briefs. Acceptance: prompt is correctly assembled with prepended command outputs. See PRD: Prompt Injection section.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:49:10.212331Z","created_by":"Austin King","updated_at":"2026-02-15T01:53:18.846511Z","closed_at":"2026-02-15T01:53:18.846511Z","close_reason":"Implement prompt prepend_commands for dynamic prompt construction","dependencies":[{"issue_id":"simple-agent-harness-mxg","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:49.043389Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-mxg","depends_on_id":"simple-agent-harness-d3v","type":"blocks","created_at":"2026-02-14T23:50:50.339371Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-n1d","title":"Add metadata regeneration strategy with lazy invalidation","description":"Implement lazy invalidation strategy: mark layer-2 caches as stale after integration to main. On scheduling, check if base_commit matches current main — if not, regenerate layer 2. After refactor integration, proactively regenerate layer 2 for all pending tasks. Ref: PRD section 'Regeneration Strategy'. Depends on file resolution data model and file resolution implementation.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T20:11:58.907042Z","created_by":"Austin King","updated_at":"2026-02-16T00:20:40.630532Z","closed_at":"2026-02-16T00:20:40.630532Z","close_reason":"Add metadata regeneration strategy with lazy invalidation","dependencies":[{"issue_id":"simple-agent-harness-n1d","depends_on_id":"simple-agent-harness-0lk","type":"blocks","created_at":"2026-02-15T20:13:50.037079Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-n1d","depends_on_id":"simple-agent-harness-ikw","type":"blocks","created_at":"2026-02-15T20:13:50.152556Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-n73","title":"V3.5: Make quality gates user-configurable in blacksmith.toml","description":"Quality gates (cargo test, npm test) are hardcoded in integrator.rs. They should be configurable via [finish] or [reconciliation] sections in blacksmith.toml to support any language.\n\n## Done when\n- [ ] [finish] section in blacksmith.toml with check, test, lint, format commands\n- [ ] Integrator reads gate commands from config instead of hardcoding\n- [ ] Default gates remain cargo check/test for Rust projects\n\n## Affected files\n- src/config.rs (modified)\n- src/integrator.rs (modified)\n- blacksmith.toml (modified - add example section)","status":"closed","priority":3,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:29:53.411461Z","created_by":"Austin King","updated_at":"2026-02-16T16:51:35.715837Z","closed_at":"2026-02-16T16:51:35.715837Z","close_reason":"Implemented configurable [finish] quality gates in blacksmith.toml via FinishConfig struct with auto-detection for Rust/TypeScript/Node.js projects"}
{"id":"simple-agent-harness-o33","title":"Document: Configuration Reference","description":"Write docs/configuration.md as comprehensive config reference.\n\n## Content\n\nDocument all config sections and fields from all PRD versions:\n- [session] - iterations, prompt, output\n- [agent.coding] and [agent.integration] - commands, adapters\n- [watchdog] - timeouts, intervals\n- [retry] - empty session handling\n- [backoff] - rate limit backoff\n- [shutdown] - stop file\n- [hooks] - pre/post session commands\n- [prompt] - prepend_commands\n- [storage] - data_dir, retention, compression\n- [workers] - max concurrent workers\n- [reconciliation] - test suite frequency\n- [finish] - quality gates\n- [metrics.extract] - extraction rules\n- [metrics.targets] - threshold rules\n- [improvements] - auto-promotion settings\n- [notifications] - future alerting\n\nInclude examples for each section.\n\n## Verification\n\nRead src/config.rs thoroughly:\n- List all Config struct fields\n- Verify defaults\n- Document any undocumented fields\n- Check for deprecated fields\n\n## Affected Files\n\n- docs/configuration.md (new)","design":"DESCRIPTION\nWrite docs/configuration.md as comprehensive config reference.\n\n## Content\n\nDocument all config sections and fields from all PRD versions:\n- [session] - iterations, prompt, output\n- [agent.coding] and [agent.integration] - commands, adapters\n- [watchdog] - timeouts, intervals\n- [retry] - empty session handling\n- [backoff] - rate limit backoff\n- [shutdown] - stop file\n- [hooks] - pre/post session commands\n- [prompt] - prepend_commands\n- [storage] - data_dir, retention, compression\n- [workers] - max concurrent workers\n- [reconciliation] - test suite frequency\n- [finish] - quality gates\n- [metrics.extract] - extraction rules\n- [metrics.targets] - threshold rules\n- [improvements] - auto-promotion settings\n- [notifications] - future alerting\n\nInclude examples for each section.\n\n## Verification\n\nRead src/config.rs thoroughly:\n- List all Config struct fields\n- Verify defaults\n- Document any undocumented fields\n- Check for deprecated fields\n\n## Affected Files\n\n- docs/configuration.md (new)\n\nDESIGN\nDESCRIPTION\nWrite docs/configuration.md as comprehensive config reference.\n\n## Content\n\nDocument all config sections and fields from all PRD versions:\n- [session] - iterations, prompt, output\n- [agent.coding] and [agent.integration] - commands, adapters\n- [watchdog] - timeouts, intervals\n- [retry] - empty session handling\n- [backoff] - rate limit backoff\n- [shutdown] - stop file\n- [hooks] - pre/post session commands\n- [prompt] - prepend_commands\n- [storage] - data_dir, retention, compression\n- [workers] - max concurrent workers\n- [reconciliation] - test suite frequency\n- [finish] - quality gates\n- [metrics.extract] - extraction rules\n- [metrics.targets] - threshold rules\n- [improvements] - auto-promotion settings\n- [notifications] - future alerting\n\nInclude examples for each section.\n\n## Verification\n\nRead src/config.rs thoroughly:\n- List all Config struct fields\n- Verify defaults\n- Document any undocumented fields\n- Check for deprecated fields\n\n## Affected Files\n\n- docs/configuration.md (new)\n\n\naffected: docs/configuration.mdNOTES\n\naffected: docs/configuration.md","notes":"Reopened: docs/configuration.md not created","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:14:52.269454Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:37.257902Z","closed_at":"2026-02-16T17:01:30.714023Z","close_reason":"Documentation files verified against source code and corrected where needed.","dependencies":[{"issue_id":"simple-agent-harness-o33","depends_on_id":"simple-agent-harness-2kb","type":"blocks","created_at":"2026-02-16T16:15:55.514432Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-obm","title":"Implement configurable target thresholds and metrics targets command","description":"Parse [metrics.targets.rules] from blacksmith.toml config. Each rule: kind, compare (pct_of/pct_sessions/avg), relative_to, threshold, direction (above/below), label, unit. Implement 'blacksmith metrics targets' command showing configured targets vs recent performance. PRD ref: Targets and Thresholds, CLI \u003e metrics targets. Files: src/config.rs (new MetricsTargetsConfig), src/metrics_cmd.rs (targets command), src/db.rs (aggregation queries).","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:38.696566Z","created_by":"Austin King","updated_at":"2026-02-15T14:28:40.908971Z","closed_at":"2026-02-15T14:28:40.908971Z","close_reason":"Implement configurable target thresholds and metrics targets command","dependencies":[{"issue_id":"simple-agent-harness-obm","depends_on_id":"simple-agent-harness-cl6","type":"blocks","created_at":"2026-02-15T13:28:29.313453Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-odo","title":"Implement metrics export, query, and events dump commands","description":"Implement three CLI commands: 'blacksmith metrics export [--format csv|json]' to export all observations, 'blacksmith metrics query \u003ckind\u003e [--last N] [--aggregate avg|trend]' for ad-hoc metric queries, and 'blacksmith metrics events [--session N]' to dump raw events. PRD ref: CLI Interface \u003e Metrics commands. Files: src/metrics_cmd.rs, src/db.rs.","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:44.509093Z","created_by":"Austin King","updated_at":"2026-02-15T14:51:49.192492Z","closed_at":"2026-02-15T14:51:49.192492Z","close_reason":"Implement metrics export, query, and events dump commands","dependencies":[{"issue_id":"simple-agent-harness-odo","depends_on_id":"simple-agent-harness-cl6","type":"blocks","created_at":"2026-02-15T13:28:36.094019Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-oo7a","title":"V3: Store affected_globs as JSON array instead of comma-separated TEXT","status":"open","priority":3,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T16:35:19.70516Z","created_by":"Austin King","updated_at":"2026-02-16T16:35:19.70516Z"}
{"id":"simple-agent-harness-oof","title":"Enhance blacksmith init with --force and --export flags","description":"Upgrade the existing blacksmith init subcommand from its current minimal implementation (just calls ensure_initialized) to support --force (overwrite existing files with fresh defaults) and --export (copy PROMPT.md and skills to project root outside .blacksmith/ for users who want to commit them). Print a summary of what was created/overwritten. PRD ref: Milestone 1c.\n\n## Done when\n- [ ] blacksmith init creates .blacksmith/ with all defaults (current behavior + extracted files)\n- [ ] blacksmith init --force overwrites existing PROMPT.md, skills, config with embedded defaults\n- [ ] blacksmith init --export copies PROMPT.md and skills/ to project root (CWD)\n- [ ] Prints human-readable summary: 'Created: ...', 'Overwrote: ...', 'Exported: ...'\n- [ ] CLI args added to Commands::Init in src/main.rs\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + any new tests)\n\n## Verify\n- Run: cargo run -- init --help\n- Expect: Shows --force and --export flags with descriptions\n- Run (in temp dir): cargo run -- init \u0026\u0026 ls .blacksmith/PROMPT.md .blacksmith/skills/\n- Expect: Files exist\n\n## Affected files\n- src/main.rs (modified — add --force/--export args to Commands::Init, update handler)\n- src/data_dir.rs (modified — add force_extract(), export_to_root() methods)","status":"closed","priority":0,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T02:34:50.486391Z","created_by":"Austin King","updated_at":"2026-02-16T02:47:26.030417Z","closed_at":"2026-02-16T02:47:26.030417Z","close_reason":"Implemented defaults/, src/defaults.rs, DataDir extraction, and init --force/--export","dependencies":[{"issue_id":"simple-agent-harness-oof","depends_on_id":"simple-agent-harness-vv3","type":"blocks","created_at":"2026-02-16T02:36:56.292302Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-owle","title":"FIX P0: Enforce verification before bd close","description":"Prevent agents from closing beads without actually completing work.\n\n## Problem\n\nAgents mark beads closed with fabricated completion reports but don't do the work.\nNo enforcement of \"Done when\" checklist or verification commands.\n\n## Root Cause Analysis Needed\n\n1. Read recent session JSONL to see agent behavior:\n```bash\nls -t .blacksmith/sessions/*.jsonl | head -3 | while read f; do\n  echo \"=== $f ===\"\n  tail -50 \"$f\" | grep -E \"bd close|bd update.*status|Done when\" -A 2\ndone\n```\n\n2. Check PROMPT.md for verification emphasis\n3. Check if blacksmith finish command exists\n\n## Fix Options\n\n### Option A: Strengthen PROMPT.md (quick, may not be enough)\n- Add CRITICAL markers to verification step\n- Require explicit verification command output in session\n- Warn about consequences of premature closure\n\n### Option B: Implement blacksmith finish with gates (V3.5 feature)\n- Read prd/SPEC-v4-deploy-self-improvement.md Milestone 2\n- Create `blacksmith finish` subcommand\n- Runs quality gates (cargo check, cargo test, or configured)\n- Only calls bd close if gates pass\n- Make PROMPT.md use `blacksmith finish` instead of `bd close`\n\n### Option C: Integration loop verification (best long-term)\n- Before integration, verify \"Done when\" items\n- Parse verification commands from bead\n- Run them in worktree\n- Abort integration if verification fails\n- Requires src/integrator.rs changes\n\n## Recommended Approach\n\n1. Implement Option B (blacksmith finish) - unblocks deployment\n2. Then add Option C (integration verification) - prevents sneaking through\n3. Update PROMPT.md to use blacksmith finish\n\n## Done When\n\n- [ ] blacksmith finish subcommand implemented\n- [ ] Quality gates configurable in blacksmith.toml\n- [ ] PROMPT.md updated to use blacksmith finish\n- [ ] Test: bead with failing tests cannot be closed\n- [ ] Test: bead with missing files cannot be closed\n- [ ] cargo check, cargo test pass\n\naffected: src/main.rs, PROMPT.md, prd/SPEC-v4-deploy-self-improvement.md","status":"open","priority":0,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:59:32.101928Z","created_by":"Austin King","updated_at":"2026-02-16T16:59:32.101928Z"}
{"id":"simple-agent-harness-p0y","title":"Implement main runner loop orchestration","description":"Implement runner.rs: the core loop that ties all modules together. For each iteration: (1) check STOP file, (2) read and prepare prompt from prompt_file, (3) spawn agent session, (4) start watchdog alongside session, (5) on completion check output size and retry if needed, (6) update iteration counters (productive + global), (7) apply inter-iteration delay. Track productive iterations vs max_iterations. The runner owns the iteration state and delegates to session, watchdog, retry, and signals modules. Acceptance: can run N productive iterations with a mock agent command (e.g. 'echo hello'), handles empty sessions with retries, stops on max_iterations. See PRD: Core Behavior, Session Lifecycle.","status":"closed","priority":0,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:58.908464Z","created_by":"Austin King","updated_at":"2026-02-15T00:22:58.535681Z","closed_at":"2026-02-15T00:22:58.535681Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-p0y","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:34.058289Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-p0y","depends_on_id":"simple-agent-harness-d3v","type":"blocks","created_at":"2026-02-14T23:50:35.313584Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-p0y","depends_on_id":"simple-agent-harness-fvr","type":"blocks","created_at":"2026-02-14T23:50:36.835817Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-p0y","depends_on_id":"simple-agent-harness-jr7","type":"blocks","created_at":"2026-02-14T23:50:39.029115Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-p0y","depends_on_id":"simple-agent-harness-7rx","type":"blocks","created_at":"2026-02-14T23:50:40.930624Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-pcb","title":"Add quantitative metrics summary to brief command output","description":"Extend the brief command to include quantitative metrics alongside improvements. Add a '## PERFORMANCE FEEDBACK' section showing last session metrics vs targets (if configured). Format: metric name, current value, target, OK/MISS status. PRD ref: Brief command output example, Loop Integration \u003e Pre-session. Files: src/brief.rs, src/db.rs (recent session query).","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:35.646752Z","created_by":"Austin King","updated_at":"2026-02-15T14:18:39.832457Z","closed_at":"2026-02-15T14:18:39.832457Z","close_reason":"Add quantitative metrics summary to brief command output","dependencies":[{"issue_id":"simple-agent-harness-pcb","depends_on_id":"simple-agent-harness-11h","type":"blocks","created_at":"2026-02-15T13:28:24.801522Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-pcb","depends_on_id":"simple-agent-harness-pr9","type":"blocks","created_at":"2026-02-15T13:28:26.190926Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-pr9","title":"Implement metrics log and metrics status CLI commands","description":"Implement two CLI commands: 'blacksmith metrics log \u003cfile\u003e' for manual JSONL ingestion (calls the same ingest module), and 'blacksmith metrics status [--last N]' which displays a dashboard showing recent sessions from the observations table with key metrics, trends, and target status. Default --last is 10. PRD ref: CLI Interface \u003e Metrics commands. Files: src/main.rs (wire subcommands), new src/metrics_cmd.rs (command handlers), src/db.rs (query helpers).","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:34.088296Z","created_by":"Austin King","updated_at":"2026-02-15T14:12:39.210778Z","closed_at":"2026-02-15T14:12:39.210778Z","close_reason":"Implement metrics log and metrics status CLI commands","dependencies":[{"issue_id":"simple-agent-harness-pr9","depends_on_id":"simple-agent-harness-cl6","type":"blocks","created_at":"2026-02-15T13:28:20.950162Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-pr9","depends_on_id":"simple-agent-harness-8j5","type":"blocks","created_at":"2026-02-15T13:28:23.512832Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-pwuu","title":"CRITICAL: Coordinator only using 1 worker despite max=3 config","description":"Multi-agent coordinator configured for 3 workers but only spawning 1 worker at a time.\n\n## Evidence\n\n1. Config: `[workers] max = 3`\n2. Ready work: 10+ beads with no blockers\n3. Active worktrees: Only 1 (worker-0-simple-agent-harness-374)\n4. In-progress beads: Only 1 (simple-agent-harness-db7)\n5. Status shows: iteration 2, only worker-0 mentioned\n\n## Expected Behavior\n\nWith 10 ready beads and max=3 workers:\n- Should spawn 3 concurrent workers in separate worktrees\n- Should have 3 beads in_progress simultaneously\n- Should have 3 worktrees under .blacksmith/worktrees/\n- Scheduler should assign non-conflicting beads to workers\n\n## Impact\n\n- P0 CRITICAL: Destroys parallelism value proposition\n- System runs serially despite multi-agent architecture\n- 67% of configured capacity unused\n- Wastes wall-clock time dramatically\n\n## Root Cause Hypothesis\n\nPossible issues in src/coordinator.rs or src/scheduler.rs:\n1. Worker pool not spawning all workers\n2. Scheduler only assigning to worker-0\n3. Affected set conflicts incorrectly detected (everything conflicts?)\n4. Integration queue blocking new work assignment\n5. Beads missing affected set metadata (treated as conflicts-with-all)\n\n## Debug Steps\n\n1. Check coordinator logs for worker spawn events\n2. Check scheduler conflict detection logic\n3. Verify beads have affected set metadata\n4. Check if workers 1 and 2 are even created\n5. Review pool.rs spawn_worker implementation\n\n## Verify Fix\n\n1. Configure max=3\n2. Create 3 independent beads (different files)\n3. Start coordinator\n4. Should see 3 worktrees\n5. Should see 3 beads in_progress\n6. Should complete in ~1/3 the serial time","notes":"ROOT CAUSE IDENTIFIED:\n\n1. Beads created without proper `affected:` declaration in design field\n2. Scheduler (src/scheduler.rs:156-172) treats missing affected set as \"affects everything\"\n3. When ANY in-progress bead has affected_globs=None, scheduler returns empty Vec (line 171)\n4. This blocks ALL other assignments, leaving workers 1 and 2 idle\n\nThe beads have \"## Affected Files\" in markdown, but scheduler needs:\n  affected: docs/, docs/README.md\n(note lowercase \"affected:\" at start of line, comma-separated globs)\n\nFIX:\n1. Update /prd-to-beads and /break-down-issue skills to add proper \"affected:\" line\n2. Or: Change scheduler to allow None globs to coexist (less safe)\n3. Update existing beads to add \"affected:\" to design field\n\nEVIDENCE:\n- Config: workers.max = 3\n- Pool creates 3 workers (src/pool.rs:157)\n- Only 1 assigned because scheduler returns empty list\n- Line src/scheduler.rs:170: if any_in_progress_locks_all { return Vec::new(); }","status":"closed","priority":0,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T16:39:08.682224Z","created_by":"Austin King","updated_at":"2026-02-16T16:58:52.494313Z","closed_at":"2026-02-16T16:57:23.921687Z","close_reason":"Fixed: spawn_worker was passing None for affected_globs to DB, causing scheduler to treat every in-progress task as locking all files. Now passes bead's declared affected set through to the DB assignment."}
{"id":"simple-agent-harness-q5v","title":"Add fan-in hotspot scoring for files","description":"Compute fan_in_score(file) = count(modules importing file) / total_modules for every file in the codebase. Return a sorted list of files with their fan-in scores. Files above a configurable threshold (default 0.3) are splitting candidates. Ref: PRD section 'Fan-in hotspots'. Depends on import graph parser.","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T20:11:05.036903Z","created_by":"Austin King","updated_at":"2026-02-16T00:07:39.162935Z","closed_at":"2026-02-16T00:07:39.162935Z","close_reason":"Add fan-in hotspot scoring for files","dependencies":[{"issue_id":"simple-agent-harness-q5v","depends_on_id":"simple-agent-harness-4a1","type":"blocks","created_at":"2026-02-15T20:13:38.067156Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-qf1","title":"Update top-level README.md","description":"Update README.md to be a concise landing page pointing to comprehensive docs.\n\n## Task\n\nRewrite README.md to:\n- Brief description (2-3 sentences)\n- Quick install instructions\n- Link to docs/getting-started.md\n- Link to docs/README.md for full navigation\n- Feature highlights (bullets)\n- Link to PRD specs for contributors\n- Badge for build status (if applicable)\n\nKeep it short (\u003c100 lines). Move detailed content to docs/.\n\n## Verification\n\n```bash\ntest -f README.md\ngrep -q \"docs/getting-started\" README.md\ngrep -q \"docs/README.md\" README.md\nwc -l README.md | awk '$1 \u003c= 100'\n```\n\n## Affected Files\n\n- README.md (major rewrite)","design":"DESCRIPTION\nUpdate README.md to be a concise landing page pointing to comprehensive docs.\n\n## Task\n\nRewrite README.md to:\n- Brief description (2-3 sentences)\n- Quick install instructions\n- Link to docs/getting-started.md\n- Link to docs/README.md for full navigation\n- Feature highlights (bullets)\n- Link to PRD specs for contributors\n- Badge for build status (if applicable)\n\nKeep it short (\u003c100 lines). Move detailed content to docs/.\n\n## Verification\n\n```bash\ntest -f README.md\ngrep -q \"docs/getting-started\" README.md\ngrep -q \"docs/README.md\" README.md\nwc -l README.md | awk '$1 \u003c= 100'\n```\n\n## Affected Files\n\n- README.md (major rewrite)\n\nDESIGN\nDESCRIPTION\nUpdate README.md to be a concise landing page pointing to comprehensive docs.\n\n## Task\n\nRewrite README.md to:\n- Brief description (2-3 sentences)\n- Quick install instructions\n- Link to docs/getting-started.md\n- Link to docs/README.md for full navigation\n- Feature highlights (bullets)\n- Link to PRD specs for contributors\n- Badge for build status (if applicable)\n\nKeep it short (\u003c100 lines). Move detailed content to docs/.\n\n## Verification\n\n```bash\ntest -f README.md\ngrep -q \"docs/getting-started\" README.md\ngrep -q \"docs/README.md\" README.md\nwc -l README.md | awk '$1 \u003c= 100'\n```\n\n## Affected Files\n\n- README.md (major rewrite)\n\n\naffected: README.mdNOTES\n\naffected: README.md","notes":"Reopened: README.md not updated","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:15:12.07012Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:38.157316Z","closed_at":"2026-02-16T17:01:37.202444Z","close_reason":"README.md updated with links to all docs, verified \u003c100 lines, contains getting-started and docs/README.md links.","dependencies":[{"issue_id":"simple-agent-harness-qf1","depends_on_id":"simple-agent-harness-c11","type":"blocks","created_at":"2026-02-16T16:15:58.195852Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-qf1","depends_on_id":"simple-agent-harness-tdq","type":"blocks","created_at":"2026-02-16T16:15:58.356138Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-qf1","depends_on_id":"simple-agent-harness-fv0","type":"blocks","created_at":"2026-02-16T16:15:58.496716Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-qf1","depends_on_id":"simple-agent-harness-xcs","type":"blocks","created_at":"2026-02-16T16:15:58.621905Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-qf1","depends_on_id":"simple-agent-harness-1nm","type":"blocks","created_at":"2026-02-16T16:15:58.748759Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-qf1","depends_on_id":"simple-agent-harness-xi3","type":"blocks","created_at":"2026-02-16T16:15:58.87314Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-qf1","depends_on_id":"simple-agent-harness-o33","type":"blocks","created_at":"2026-02-16T16:15:58.999133Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-qf1","depends_on_id":"simple-agent-harness-xvm","type":"blocks","created_at":"2026-02-16T16:15:59.122527Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-qf1","depends_on_id":"simple-agent-harness-crv","type":"blocks","created_at":"2026-02-16T16:15:59.246716Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-qf1","depends_on_id":"simple-agent-harness-5l3","type":"blocks","created_at":"2026-02-16T16:15:59.371175Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-r43","title":"Implement --quiet mode for minimal output","description":"When --quiet flag is passed, suppress per-iteration banners and info-level messages. Only show errors and the final summary line. Integrate with tracing subscriber to filter log levels based on quiet/verbose flags: --quiet = error only, default = info, --verbose = debug + agent output interleaving. Acceptance: --quiet suppresses info logs, --verbose shows debug. See PRD: CLI Interface.","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:49:48.921881Z","created_by":"Austin King","updated_at":"2026-02-15T14:38:48.254717Z","closed_at":"2026-02-15T14:38:48.254717Z","close_reason":"Implement --quiet mode: error-only tracing + final summary line","dependencies":[{"issue_id":"simple-agent-harness-r43","depends_on_id":"simple-agent-harness-yyb","type":"blocks","created_at":"2026-02-14T23:50:56.849881Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-r6w","title":"Populate boundary_signatures in file resolution","description":"The file_resolution.rs Layer 2 module currently hardcodes boundary_signatures to Vec::new(). Wire the existing public_api.rs module to extract public function/trait/struct signatures for resolved files, populating the DerivedFields.boundary_signatures field. This gives the scheduler and architecture agent richer metadata about module interfaces. PRD ref: 'Layer 2: File Resolution' section showing boundary_signatures in output.\n\n## Done when\n- [ ] resolve() in file_resolution.rs calls public_api extraction for resolved files\n- [ ] boundary_signatures populated with pub fn/trait/struct signatures from resolved modules\n- [ ] Signatures formatted as 'pub fn module::function(args) -\u003e ReturnType' style strings\n- [ ] Empty signatures gracefully handled (file has no pub items → empty list for that concept)\n- [ ] Existing file_resolution tests still pass\n- [ ] New test: test_boundary_signatures_populated — resolve a concept, verify signatures present\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes\n\n## Verify\n- Run: cargo test boundary_signatures -- --nocapture\n- Expect: Test passes with populated signature strings\n\n## Affected files\n- src/file_resolution.rs (modified - wire public_api into resolve())\n- src/public_api.rs (modified if needed - ensure extraction returns signature strings)","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T03:43:02.543483Z","created_by":"Austin King","updated_at":"2026-02-16T06:12:28.544489Z","closed_at":"2026-02-16T06:12:28.544489Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-r6w","depends_on_id":"simple-agent-harness-krl","type":"blocks","created_at":"2026-02-16T03:44:44.153935Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-rgt","title":"V1: Implement 3-second timeout for double-SIGINT hard shutdown","status":"open","priority":3,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T16:34:41.798325Z","created_by":"Austin King","updated_at":"2026-02-16T16:34:41.798325Z"}
{"id":"simple-agent-harness-sxy","title":"Add SQLite dependency and create database module with improvements table","description":"Add rusqlite dependency to Cargo.toml. Create src/db.rs module with: open_or_create(path) function that opens/creates blacksmith.db in the output directory. Improvements table schema per PRD (id, ref, created, resolved, category, status, title, body, context, tags, meta). Indexes on status and category. Auto-increment ref assignment (R1, R2, ...). No CHECK constraints - validation is in CLI layer. PRD ref: Storage Model \u003e Improvements Table. Files: Cargo.toml, src/db.rs, src/main.rs (add mod db).","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:14.461903Z","created_by":"Austin King","updated_at":"2026-02-15T13:52:03.300396Z","closed_at":"2026-02-15T13:52:03.300396Z","close_reason":"Add SQLite dependency and create database module with improvements table","dependencies":[{"issue_id":"simple-agent-harness-sxy","depends_on_id":"simple-agent-harness-ynf","type":"blocks","created_at":"2026-02-15T13:28:06.77572Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-t0t","title":"Implement JSONL event log for external tooling","description":"Optionally write harness-events.jsonl (configured via [output] event_log). Append one JSON line per significant state transition: session_complete events with fields ts, event, iteration, global, output_bytes, exit_code, duration_secs, committed, retries, rate_limited. File is append-only, one line per session. Designed for self-improvement tool ingestion. Acceptance: after N iterations, event log has N entries, each valid JSON. See PRD: Event Log section.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:48.41639Z","created_by":"Austin King","updated_at":"2026-02-15T01:25:32.653407Z","closed_at":"2026-02-15T01:25:32.653407Z","close_reason":"Implement JSONL event log for external tooling","dependencies":[{"issue_id":"simple-agent-harness-t0t","depends_on_id":"simple-agent-harness-p0y","type":"blocks","created_at":"2026-02-14T23:50:46.393057Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-t4x","title":"Implement integration retry loop with circuit breaker state tracking","description":"Extract the core circuit breaker mechanism: track attempt count per integration, determine retry vs trip (max 3 attempts), expose state (Retrying/Tripped) for both agent spawning and failure handling to consume. This is the shared foundation that both agent spawning (m5l) and failure handling (yg5) build on. Key file: src/integrator.rs.","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T16:45:29.505036Z","created_by":"Austin King","updated_at":"2026-02-15T16:57:30.432988Z","closed_at":"2026-02-15T16:57:30.432988Z","close_reason":"Implement circuit breaker state tracking for integration retry loop"}
{"id":"simple-agent-harness-t6a","title":"Create defaults/ directory with canonical assets","description":"Create the defaults/ directory in the blacksmith repo with canonical versions of all runtime artifacts that agents need: PROMPT.md, bd-finish.sh, skills (prd-to-beads, break-down-issue, self-improvement), and a default blacksmith.toml. These are the source-of-truth files that get embedded into the binary via include_str!() in a subsequent bead. Copy current versions from their existing locations (PROMPT.md from root, skills from .claude/skills/, config from blacksmith.toml) and place them in defaults/. PRD ref: Milestone 1a.\n\n## Done when\n- [ ] defaults/PROMPT.md exists with current agent instructions\n- [ ] defaults/bd-finish.sh exists with current finish script\n- [ ] defaults/blacksmith.toml exists with sensible defaults for a fresh project\n- [ ] defaults/skills/prd-to-beads.md exists\n- [ ] defaults/skills/break-down-issue.md exists\n- [ ] defaults/skills/self-improvement.md exists\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + any new tests)\n\n## Verify\n- Run: ls -la defaults/ \u0026\u0026 ls -la defaults/skills/\n- Expect: All 6 files present, non-empty\n\n## Affected files\n- defaults/PROMPT.md (new)\n- defaults/bd-finish.sh (new)\n- defaults/blacksmith.toml (new)\n- defaults/skills/prd-to-beads.md (new)\n- defaults/skills/break-down-issue.md (new)\n- defaults/skills/self-improvement.md (new)","status":"closed","priority":0,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T02:34:46.154113Z","created_by":"Austin King","updated_at":"2026-02-16T02:47:26.025703Z","closed_at":"2026-02-16T02:47:26.025703Z","close_reason":"Implemented defaults/, src/defaults.rs, DataDir extraction, and init --force/--export"}
{"id":"simple-agent-harness-t7fh","title":"V2: Complete V1 migration column mapping for all fields","status":"open","priority":3,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T16:35:08.627468Z","created_by":"Austin King","updated_at":"2026-02-16T16:35:08.627468Z"}
{"id":"simple-agent-harness-tdq","title":"Document: Core Loop (V1 features)","description":"Write docs/core-loop.md documenting the session lifecycle, watchdog, retries, and shutdown.\n\n## Content\n\nBased on prd/SPEC.md (V1):\n- Session lifecycle diagram\n- Watchdog algorithm and configuration\n- Retry policy for empty sessions\n- Rate limit detection and backoff\n- Graceful shutdown (STOP file, signals)\n- Status file format\n- Hook system (pre/post session)\n\n## Verification\n\nRead src/runner.rs, src/session.rs, src/watchdog.rs, src/retry.rs, src/signals.rs:\n- Verify watchdog timing logic\n- Verify retry count handling\n- Verify rate limit detection patterns\n- Verify signal handling (SIGINT, SIGTERM)\n- Check for deviations from spec\n\nFile beads for any bugs or missing features.\n\n## Affected Files\n\n- docs/core-loop.md (new)","design":"DESCRIPTION\nWrite docs/core-loop.md documenting the session lifecycle, watchdog, retries, and shutdown.\n\n## Content\n\nBased on prd/SPEC.md (V1):\n- Session lifecycle diagram\n- Watchdog algorithm and configuration\n- Retry policy for empty sessions\n- Rate limit detection and backoff\n- Graceful shutdown (STOP file, signals)\n- Status file format\n- Hook system (pre/post session)\n\n## Verification\n\nRead src/runner.rs, src/session.rs, src/watchdog.rs, src/retry.rs, src/signals.rs:\n- Verify watchdog timing logic\n- Verify retry count handling\n- Verify rate limit detection patterns\n- Verify signal handling (SIGINT, SIGTERM)\n- Check for deviations from spec\n\nFile beads for any bugs or missing features.\n\n## Affected Files\n\n- docs/core-loop.md (new)\n\nDESIGN\nDESCRIPTION\nWrite docs/core-loop.md documenting the session lifecycle, watchdog, retries, and shutdown.\n\n## Content\n\nBased on prd/SPEC.md (V1):\n- Session lifecycle diagram\n- Watchdog algorithm and configuration\n- Retry policy for empty sessions\n- Rate limit detection and backoff\n- Graceful shutdown (STOP file, signals)\n- Status file format\n- Hook system (pre/post session)\n\n## Verification\n\nRead src/runner.rs, src/session.rs, src/watchdog.rs, src/retry.rs, src/signals.rs:\n- Verify watchdog timing logic\n- Verify retry count handling\n- Verify rate limit detection patterns\n- Verify signal handling (SIGINT, SIGTERM)\n- Check for deviations from spec\n\nFile beads for any bugs or missing features.\n\n## Affected Files\n\n- docs/core-loop.md (new)\n\n\naffected: docs/core-loop.mdNOTES\n\naffected: docs/core-loop.md","notes":"Reopened: docs/core-loop.md not created","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:14:24.549224Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:36.155991Z","closed_at":"2026-02-16T17:01:30.707063Z","close_reason":"Documentation files verified against source code and corrected where needed.","dependencies":[{"issue_id":"simple-agent-harness-tdq","depends_on_id":"simple-agent-harness-2kb","type":"blocks","created_at":"2026-02-16T16:15:54.855842Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-tzx","title":"Implement prompt_via config with arg/stdin/file delivery modes","description":"Add prompt_via config field to agent config: arg (default, existing behavior with {prompt} substitution), stdin (write prompt to agent's stdin), file (write prompt to temp file, substitute {prompt_file} in args). Implement all three modes in the session spawning code. Clean up temp files after session. Reference: SPEC-v3-agents.md lines 358-393. Key files: src/config.rs, src/session.rs, src/runner.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:53:45.958973Z","created_by":"Austin King","updated_at":"2026-02-15T16:17:37.954253Z","closed_at":"2026-02-15T16:17:37.954253Z","close_reason":"Implement prompt_via config with arg/stdin/file delivery modes"}
{"id":"simple-agent-harness-u81","title":"Update embedded PROMPT.md to use blacksmith finish","description":"Update the canonical PROMPT.md in defaults/ to reference 'blacksmith finish' instead of './bd-finish.sh' in all session-close instructions. This is the migration step that makes the embedded prompt work correctly in deployed (non-dogfooding) mode. Keep the dogfooding copy (root PROMPT.md) referencing bd-finish.sh for backwards compat during transition. PRD ref: Milestone 2 migration.\n\n## Done when\n- [ ] defaults/PROMPT.md references 'blacksmith finish \u003cbead-id\u003e \"\u003cmessage\u003e\" [files...]' for session close\n- [ ] All occurrences of './bd-finish.sh' or 'bd-finish.sh' replaced in defaults/PROMPT.md\n- [ ] Root PROMPT.md left unchanged (dogfooding still uses bd-finish.sh)\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + any new tests)\n\n## Verify\n- Run: grep -c 'blacksmith finish' defaults/PROMPT.md\n- Expect: At least 1 match\n- Run: grep -c 'bd-finish' defaults/PROMPT.md\n- Expect: 0 matches\n\n## Affected files\n- defaults/PROMPT.md (modified)","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T02:34:58.359179Z","created_by":"Austin King","updated_at":"2026-02-16T03:00:03.100588Z","closed_at":"2026-02-16T03:00:03.100588Z","close_reason":"Update embedded PROMPT.md to use blacksmith finish instead of bd-finish.sh","dependencies":[{"issue_id":"simple-agent-harness-u81","depends_on_id":"simple-agent-harness-t6a","type":"blocks","created_at":"2026-02-16T02:36:59.922367Z","created_by":"Austin King"},{"issue_id":"simple-agent-harness-u81","depends_on_id":"simple-agent-harness-9kr","type":"blocks","created_at":"2026-02-16T02:37:00.057827Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-utz","title":"Implement configuration loading and CLI argument parsing","description":"Implement config.rs and CLI parsing in main.rs. Config struct with serde derives, all fields from PRD [session], [agent], [watchdog], [retry], [backoff], [shutdown] sections. Load from harness.toml with compiled defaults for every field (so an empty file is valid). CLI flags via clap derive: --config, --prompt, --output-dir, --timeout, --retries, --dry-run, -v, -q, --status, plus positional MAX_ITERATIONS. Implement precedence: CLI flags \u003e harness.toml \u003e defaults. Acceptance: unit tests for default config, TOML loading, and CLI override merging. See PRD sections: Configuration, CLI Interface.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:09.799333Z","created_by":"Austin King","updated_at":"2026-02-15T00:03:47.416239Z","closed_at":"2026-02-15T00:03:47.416239Z","close_reason":"Implement config loading, CLI override merging, and unit tests","dependencies":[{"issue_id":"simple-agent-harness-utz","depends_on_id":"simple-agent-harness-ewc","type":"blocks","created_at":"2026-02-14T23:50:27.460281Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-v25","title":"Implement improve show/update/promote/dismiss/search commands","description":"Add remaining improve subcommands: show (display single improvement by ref with all fields), update (modify status/body/context by ref), promote (shorthand for --status=promoted with timestamp), dismiss (shorthand for --status=dismissed with --reason stored in meta JSON), search (full-text search across title, body, context fields). PRD ref: CLI Interface \u003e Improvement commands. Files: src/improve.rs, src/db.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:17.054147Z","created_by":"Austin King","updated_at":"2026-02-15T14:15:41.45028Z","closed_at":"2026-02-15T14:15:41.45028Z","close_reason":"Implement improve show/update/promote/dismiss/search commands","dependencies":[{"issue_id":"simple-agent-harness-v25","depends_on_id":"simple-agent-harness-evl","type":"blocks","created_at":"2026-02-15T13:28:10.829801Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-v6v","title":"Implement task_manifest.toml parsing and manifest application","description":"Parse task_manifest.toml from completed worktrees. Apply manifest entries mechanically: mod declarations appended to lib.rs, re-exports appended to appropriate module, Cargo.toml deps merged into [dependencies], TypeScript barrel exports appended to index.ts. Manifest entries are commutative (order-independent, append-only). Reference: SPEC-v3-agents.md lines 511-549, 565-569. Key files: src/integrator.rs.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:54:59.192703Z","created_by":"Austin King","updated_at":"2026-02-15T15:52:11.570044Z","closed_at":"2026-02-15T15:52:11.570044Z","close_reason":"Implement task_manifest.toml parsing and manifest application"}
{"id":"simple-agent-harness-vrq","title":"Call cleanup_orphans on coordinator startup to remove stale worktrees","description":"When blacksmith restarts after a crash/stop, stale worktrees from the previous run remain on disk. The coordinator recovers orphaned beads (resets in_progress → open) but never cleans up the corresponding worktrees. When it re-schedules the same beads, worktree::create fails with 'worktree already exists'. Fix: call worktree::cleanup_orphans() at coordinator startup (after recover_orphaned_beads), passing an empty active_paths set since no workers are active yet. The function already exists at worktree.rs:194 but is #[allow(dead_code)] and never called. Files: src/coordinator.rs (add call after line 123), src/worktree.rs (remove #[allow(dead_code)] from cleanup_orphans).","status":"closed","priority":0,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T01:02:53.69815Z","created_by":"Austin King","updated_at":"2026-02-16T01:38:18.442463Z","closed_at":"2026-02-16T01:38:18.442463Z","close_reason":"Added worktree::cleanup_orphans() call at coordinator startup after recover_orphaned_beads(). Removed #[allow(dead_code)] from cleanup_orphans and prune in worktree.rs."}
{"id":"simple-agent-harness-vv3","title":"Implement first-run extraction in DataDir","description":"Extend DataDir::ensure_initialized() to extract embedded default files on first run. When .blacksmith/ is freshly created (or missing key files like PROMPT.md, skills/), write the embedded defaults from src/defaults.rs into the data directory. Never overwrite existing files — the user or agent may have customized them. Also create a skills_dir() accessor on DataDir. PRD ref: Milestone 1b.\n\n## Done when\n- [ ] DataDir::ensure_initialized() extracts PROMPT.md, blacksmith.toml, and skills/ on first run\n- [ ] Existing files are never overwritten (only missing files are written)\n- [ ] DataDir has a skills_dir() method returning root/skills/\n- [ ] DataDir has a prompt_file() method returning root/PROMPT.md\n- [ ] New unit test: test_first_run_extracts_defaults — verifies files appear in fresh tempdir\n- [ ] New unit test: test_existing_files_not_overwritten — verifies custom content survives re-init\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + any new tests)\n\n## Verify\n- Run: cargo test test_first_run_extracts_defaults -- --nocapture\n- Expect: Test passes, prints extracted file paths\n- Run: cargo test test_existing_files_not_overwritten -- --nocapture\n- Expect: Test passes, custom content preserved\n\n## Affected files\n- src/data_dir.rs (modified — add extraction logic, skills_dir(), prompt_file())\n- src/defaults.rs (modified — pub visibility if needed)","status":"closed","priority":0,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T02:34:49.29428Z","created_by":"Austin King","updated_at":"2026-02-16T02:47:26.029134Z","closed_at":"2026-02-16T02:47:26.029134Z","close_reason":"Implemented defaults/, src/defaults.rs, DataDir extraction, and init --force/--export","dependencies":[{"issue_id":"simple-agent-harness-vv3","depends_on_id":"simple-agent-harness-aev","type":"blocks","created_at":"2026-02-16T02:36:55.022402Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-w0s","title":"Implementation Audit: Metrics System (V2)","description":"Systematically verify V2 metrics features are implemented correctly.\n\n## Checklist\n\nRead prd/SPEC-v2-metrics.md and verify:\n- [ ] improvements table schema\n- [ ] events table schema\n- [ ] observations table schema\n- [ ] improve CLI commands (add, list, show, update, promote, dismiss, search)\n- [ ] Event ingestion from JSONL\n- [ ] Built-in metrics extraction (turns, cost, duration)\n- [ ] Configurable extraction rules\n- [ ] Brief generation from improvements\n- [ ] Brief injection into prompt (automatic)\n- [ ] Automatic session ingestion post-loop\n- [ ] metrics CLI commands (log, status, brief, targets, query, events, rebuild, export)\n- [ ] Target evaluation and warnings\n- [ ] V1 migration tool\n\n## Process\n\nFor each feature:\n1. Check src/db.rs for schema\n2. Check src/metrics.rs, src/improve.rs for logic\n3. Verify CLI wiring in src/main.rs\n4. Test ingestion on a sample JSONL\n5. File bead if broken/missing\n\n## Deliverables\n\n- Completed checklist\n- Beads for any gaps\n- Summary of V2 completeness\n\n## Affected Files\n\nNone (audit task)","design":"DESCRIPTION\nSystematically verify V2 metrics features are implemented correctly.\n\n## Checklist\n\nRead prd/SPEC-v2-metrics.md and verify:\n- [ ] improvements table schema\n- [ ] events table schema\n- [ ] observations table schema\n- [ ] improve CLI commands (add, list, show, update, promote, dismiss, search)\n- [ ] Event ingestion from JSONL\n- [ ] Built-in metrics extraction (turns, cost, duration)\n- [ ] Configurable extraction rules\n- [ ] Brief generation from improvements\n- [ ] Brief injection into prompt (automatic)\n- [ ] Automatic session ingestion post-loop\n- [ ] metrics CLI commands (log, status, brief, targets, query, events, rebuild, export)\n- [ ] Target evaluation and warnings\n- [ ] V1 migration tool\n\n## Process\n\nFor each feature:\n1. Check src/db.rs for schema\n2. Check src/metrics.rs, src/improve.rs for logic\n3. Verify CLI wiring in src/main.rs\n4. Test ingestion on a sample JSONL\n5. File bead if broken/missing\n\n## Deliverables\n\n- Completed checklist\n- Beads for any gaps\n- Summary of V2 completeness\n\n## Affected Files\n\nNone (audit task)\n\n\naffected: src/db.rs, src/metrics.rs, src/improve.rs, src/ingest.rs, src/brief.rs, src/metrics_cmd.rsNOTES","notes":"Reopened: V2 audit not performed","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:15:25.665118Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:10.854753Z","closed_at":"2026-02-16T17:01:04.2878Z","close_reason":"V2 audit complete: improvements table, events table, observations, improve CLI, event ingestion, built-in metrics, configurable extraction, brief generation, automatic ingestion, all metrics CLI commands verified and documented."}
{"id":"simple-agent-harness-wck","title":"Implement blacksmith gc command","description":"Add blacksmith gc CLI subcommand for manual session cleanup. Supports --dry-run (show what would be cleaned) and --aggressive (compress all eligible, delete beyond retention). Reuses the retention and compression logic from the lifecycle implementation. Reference: SPEC-v3-agents.md lines 173-177. Key files: src/main.rs, src/storage.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:53:54.390797Z","created_by":"Austin King","updated_at":"2026-02-15T16:20:59.215199Z","closed_at":"2026-02-15T16:20:59.215199Z","close_reason":"Implement blacksmith gc command with --dry-run and --aggressive flags","dependencies":[{"issue_id":"simple-agent-harness-wck","depends_on_id":"simple-agent-harness-503","type":"blocks","created_at":"2026-02-15T14:56:45.426463Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-wdo","title":"Implement blacksmith workers status and kill commands","description":"Add blacksmith workers status CLI subcommand showing current worker pool state: worker ID, bead ID, worktree path, status (coding/integrating/idle), elapsed time. Add blacksmith workers kill \u003cworker-id\u003e to stop a specific worker process. Reference: SPEC-v3-agents.md lines 846-847. Key files: src/main.rs, src/coordinator.rs.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:55:18.473553Z","created_by":"Austin King","updated_at":"2026-02-15T17:28:51.497913Z","closed_at":"2026-02-15T17:28:51.497913Z","close_reason":"Implement blacksmith workers status and kill commands","dependencies":[{"issue_id":"simple-agent-harness-wdo","depends_on_id":"simple-agent-harness-f9m","type":"blocks","created_at":"2026-02-15T14:57:04.828135Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-wi2","title":"Define AgentAdapter trait and extract Claude adapter","description":"Define the AgentAdapter trait with methods: name(), extract_builtin_metrics(), supported_metrics(), lines_for_source(). Define ExtractionSource enum (ToolCommands, Text, Raw) and AdapterError type. Extract V2's existing Claude JSONL parser (currently in src/ingest.rs) into a claude adapter implementing the trait. Claude adapter supports: turns.total, turns.narration_only, turns.parallel, turns.tool_calls, cost.input_tokens, cost.output_tokens, cost.estimate_usd, session.output_bytes, session.exit_code, session.duration_secs. Reference: SPEC-v3-agents.md lines 226-284. Key files: src/ingest.rs, new src/adapters.rs or src/adapters/ module.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:53:30.395668Z","created_by":"Austin King","updated_at":"2026-02-15T15:10:53.22101Z","closed_at":"2026-02-15T15:10:53.22101Z","close_reason":"Define AgentAdapter trait and extract Claude adapter"}
{"id":"simple-agent-harness-x1a","title":"Implement session compression with zstd","description":"After each session completes and is ingested, compress sessions older than compress_after iterations using zstd. Add compress_after config field (default 5). Compression happens at step 8 of the loop lifecycle (after ingestion, compress the previous session). Compressed files are named {N}.jsonl.zst. Add zstd dependency to Cargo.toml. Reference: SPEC-v3-agents.md Session Lifecycle section, lines 104-169. Key files: src/runner.rs, src/config.rs, new src/storage.rs or similar.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:53:35.688833Z","created_by":"Austin King","updated_at":"2026-02-15T16:06:55.75633Z","closed_at":"2026-02-15T16:06:55.75633Z","close_reason":"Implement session compression with zstd","dependencies":[{"issue_id":"simple-agent-harness-x1a","depends_on_id":"simple-agent-harness-ib1","type":"blocks","created_at":"2026-02-15T14:56:42.846827Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-xab","title":"Add blacksmith analyze CLI subcommand","description":"Add a `blacksmith analyze` CLI subcommand that runs structural analysis on the target codebase and prints a report. This wires the existing dead-code modules (structural_metrics, fan_in, god_file, boundary_violation, signal_correlator) into a production code path. The subcommand takes an optional --repo-root path (defaults to cwd) and prints: fan-in hotspots, god files, boundary violations, circular dependencies, and signal correlation results if a DB is available. PRD ref: 'Analysis Process' section.\n\n## Done when\n- [ ] Commands::Analyze variant added to CLI with optional --repo-root arg\n- [ ] Runs structural_metrics::analyze() and prints StructuralReport in human-readable format\n- [ ] If blacksmith.db exists, runs signal_correlator::correlate() and prints RefactorCandidates\n- [ ] Fan-in hotspots shown with file path and score\n- [ ] God files shown with file path, line count, and cluster count\n- [ ] Boundary violations shown with source/target module and symbol\n- [ ] Circular dependencies shown with participating modules\n- [ ] Exit code 0 on success\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + any new tests)\n\n## Verify\n- Run: cargo run -- analyze --repo-root .\n- Expect: Printed report with sections for each analysis type\n- Run: cargo run -- analyze --help\n- Expect: Shows --repo-root flag\n\n## Affected files\n- src/main.rs (modified - add Commands::Analyze, wire handler)\n- src/structural_metrics.rs (modified if needed - ensure pub interface)\n- src/signal_correlator.rs (modified if needed - ensure pub interface)","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-16T03:42:57.638144Z","created_by":"Austin King","updated_at":"2026-02-16T06:06:27.513578Z","closed_at":"2026-02-16T06:06:27.513578Z","close_reason":"Closed","dependencies":[{"issue_id":"simple-agent-harness-xab","depends_on_id":"simple-agent-harness-krl","type":"blocks","created_at":"2026-02-16T03:44:43.901728Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-xcs","title":"Document: Multi-Agent Coordination (V3)","description":"Write docs/multi-agent-coordination.md documenting parallel execution and integration.\n\n## Content\n\nBased on prd/SPEC-v3-agents.md:\n- Architecture overview (coordinator, workers, integrator)\n- Task model and affected sets\n- Scheduling algorithm and conflict detection\n- Dependency cycle detection\n- Coding phase (worktree isolation)\n- Manifest files and task_manifest.toml\n- Integration loop (merge, apply manifests, fix, test)\n- Reconciliation (periodic full test suite)\n- Failure handling and circuit breaker\n- Time estimation (serial and parallel)\n\n## Verification\n\nRead src/coordinator.rs, src/scheduler.rs, src/pool.rs, src/worktree.rs, \nsrc/integrator.rs, src/cycle_detect.rs, src/estimation.rs:\n- Verify scheduling logic matches spec\n- Verify cycle detection algorithm (Kahn + Tarjan)\n- Verify integration loop steps\n- Check circuit breaker limits\n- Verify worktree lifecycle\n\nFile beads for bugs or missing features.\n\n## Affected Files\n\n- docs/multi-agent-coordination.md (new)","design":"DESCRIPTION\nWrite docs/multi-agent-coordination.md documenting parallel execution and integration.\n\n## Content\n\nBased on prd/SPEC-v3-agents.md:\n- Architecture overview (coordinator, workers, integrator)\n- Task model and affected sets\n- Scheduling algorithm and conflict detection\n- Dependency cycle detection\n- Coding phase (worktree isolation)\n- Manifest files and task_manifest.toml\n- Integration loop (merge, apply manifests, fix, test)\n- Reconciliation (periodic full test suite)\n- Failure handling and circuit breaker\n- Time estimation (serial and parallel)\n\n## Verification\n\nRead src/coordinator.rs, src/scheduler.rs, src/pool.rs, src/worktree.rs, \nsrc/integrator.rs, src/cycle_detect.rs, src/estimation.rs:\n- Verify scheduling logic matches spec\n- Verify cycle detection algorithm (Kahn + Tarjan)\n- Verify integration loop steps\n- Check circuit breaker limits\n- Verify worktree lifecycle\n\nFile beads for bugs or missing features.\n\n## Affected Files\n\n- docs/multi-agent-coordination.md (new)\n\nDESIGN\nDESCRIPTION\nWrite docs/multi-agent-coordination.md documenting parallel execution and integration.\n\n## Content\n\nBased on prd/SPEC-v3-agents.md:\n- Architecture overview (coordinator, workers, integrator)\n- Task model and affected sets\n- Scheduling algorithm and conflict detection\n- Dependency cycle detection\n- Coding phase (worktree isolation)\n- Manifest files and task_manifest.toml\n- Integration loop (merge, apply manifests, fix, test)\n- Reconciliation (periodic full test suite)\n- Failure handling and circuit breaker\n- Time estimation (serial and parallel)\n\n## Verification\n\nRead src/coordinator.rs, src/scheduler.rs, src/pool.rs, src/worktree.rs, \nsrc/integrator.rs, src/cycle_detect.rs, src/estimation.rs:\n- Verify scheduling logic matches spec\n- Verify cycle detection algorithm (Kahn + Tarjan)\n- Verify integration loop steps\n- Check circuit breaker limits\n- Verify worktree lifecycle\n\nFile beads for bugs or missing features.\n\n## Affected Files\n\n- docs/multi-agent-coordination.md (new)\n\n\naffected: docs/multi-agent-coordination.mdNOTES\n\naffected: docs/multi-agent-coordination.md","notes":"Reopened: docs/multi-agent-coordination.md not created","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:14:34.530809Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:36.591753Z","closed_at":"2026-02-16T17:01:30.709796Z","close_reason":"Documentation files verified against source code and corrected where needed.","dependencies":[{"issue_id":"simple-agent-harness-xcs","depends_on_id":"simple-agent-harness-2kb","type":"blocks","created_at":"2026-02-16T16:15:55.127048Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-xi3","title":"Document: Architecture Analysis (V5)","description":"Write docs/architecture-analysis.md documenting automated architecture agent.\n\n## Content\n\nBased on prd/SPEC-v5-automated-architecture-and-metadata.md:\n- Two-phase task metadata (intent analysis + file resolution)\n- Metadata regeneration strategy\n- Architecture agent purpose and triggers\n- Static analysis signals (fan-in, god files, cycles, boundaries)\n- Historical signals (expansions, integration failures)\n- Proposal format and validation\n- Feedback loop and convergence\n\n## Verification\n\nRead src/intent.rs, src/file_resolution.rs, src/metadata_regen.rs, \nsrc/import_graph.rs, src/module_detect.rs, src/fan_in.rs, src/god_file.rs,\nsrc/circular_dep.rs, src/boundary_violation.rs, src/structural_metrics.rs,\nsrc/expansion_event.rs, src/signal_correlator.rs:\n- Verify intent analysis implementation\n- Verify file resolution logic\n- Check metadata regen triggers\n- Verify static analysis metrics\n- Check expansion event tracking\n- Confirm signal correlation\n\nNote: V5 may be partially implemented. Document what exists and file beads for gaps.\n\n## Affected Files\n\n- docs/architecture-analysis.md (new)","design":"DESCRIPTION\nWrite docs/architecture-analysis.md documenting automated architecture agent.\n\n## Content\n\nBased on prd/SPEC-v5-automated-architecture-and-metadata.md:\n- Two-phase task metadata (intent analysis + file resolution)\n- Metadata regeneration strategy\n- Architecture agent purpose and triggers\n- Static analysis signals (fan-in, god files, cycles, boundaries)\n- Historical signals (expansions, integration failures)\n- Proposal format and validation\n- Feedback loop and convergence\n\n## Verification\n\nRead src/intent.rs, src/file_resolution.rs, src/metadata_regen.rs, \nsrc/import_graph.rs, src/module_detect.rs, src/fan_in.rs, src/god_file.rs,\nsrc/circular_dep.rs, src/boundary_violation.rs, src/structural_metrics.rs,\nsrc/expansion_event.rs, src/signal_correlator.rs:\n- Verify intent analysis implementation\n- Verify file resolution logic\n- Check metadata regen triggers\n- Verify static analysis metrics\n- Check expansion event tracking\n- Confirm signal correlation\n\nNote: V5 may be partially implemented. Document what exists and file beads for gaps.\n\n## Affected Files\n\n- docs/architecture-analysis.md (new)\n\nDESIGN\nDESCRIPTION\nWrite docs/architecture-analysis.md documenting automated architecture agent.\n\n## Content\n\nBased on prd/SPEC-v5-automated-architecture-and-metadata.md:\n- Two-phase task metadata (intent analysis + file resolution)\n- Metadata regeneration strategy\n- Architecture agent purpose and triggers\n- Static analysis signals (fan-in, god files, cycles, boundaries)\n- Historical signals (expansions, integration failures)\n- Proposal format and validation\n- Feedback loop and convergence\n\n## Verification\n\nRead src/intent.rs, src/file_resolution.rs, src/metadata_regen.rs, \nsrc/import_graph.rs, src/module_detect.rs, src/fan_in.rs, src/god_file.rs,\nsrc/circular_dep.rs, src/boundary_violation.rs, src/structural_metrics.rs,\nsrc/expansion_event.rs, src/signal_correlator.rs:\n- Verify intent analysis implementation\n- Verify file resolution logic\n- Check metadata regen triggers\n- Verify static analysis metrics\n- Check expansion event tracking\n- Confirm signal correlation\n\nNote: V5 may be partially implemented. Document what exists and file beads for gaps.\n\n## Affected Files\n\n- docs/architecture-analysis.md (new)\n\n\naffected: docs/architecture-analysis.mdNOTES\n\naffected: docs/architecture-analysis.md","notes":"Reopened: docs/architecture-analysis.md not created","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:14:45.749978Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:37.032449Z","closed_at":"2026-02-16T17:01:30.712633Z","close_reason":"Documentation files verified against source code and corrected where needed.","dependencies":[{"issue_id":"simple-agent-harness-xi3","depends_on_id":"simple-agent-harness-2kb","type":"blocks","created_at":"2026-02-16T16:15:55.390446Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-xvm","title":"Document: CLI Reference","description":"Write docs/cli-reference.md documenting all commands and subcommands.\n\n## Content\n\nDocument all CLI commands from all PRD versions:\n- blacksmith run [OPTIONS] [MAX_ITERATIONS]\n- blacksmith init [--force] [--export]\n- blacksmith finish \u003cbead-id\u003e \"\u003cmessage\u003e\" [files...]\n- blacksmith --status\n- blacksmith improve (add, list, show, update, promote, dismiss, search)\n- blacksmith metrics (log, status, brief, targets, query, events, rebuild, export, migrate, reingest, beads)\n- blacksmith gc [--dry-run] [--aggressive]\n- blacksmith workers (status, kill)\n- blacksmith integration (log, retry)\n- blacksmith adapter (info, list, test)\n- blacksmith migrate --consolidate\n\nInclude examples, flags, environment variables.\n\n## Verification\n\nRead src/main.rs Cli struct and Commands enum:\n- List all subcommands\n- Verify flags and arguments\n- Check for undocumented commands\n- Verify help text accuracy\n\n## Affected Files\n\n- docs/cli-reference.md (new)","design":"DESCRIPTION\nWrite docs/cli-reference.md documenting all commands and subcommands.\n\n## Content\n\nDocument all CLI commands from all PRD versions:\n- blacksmith run [OPTIONS] [MAX_ITERATIONS]\n- blacksmith init [--force] [--export]\n- blacksmith finish \u003cbead-id\u003e \"\u003cmessage\u003e\" [files...]\n- blacksmith --status\n- blacksmith improve (add, list, show, update, promote, dismiss, search)\n- blacksmith metrics (log, status, brief, targets, query, events, rebuild, export, migrate, reingest, beads)\n- blacksmith gc [--dry-run] [--aggressive]\n- blacksmith workers (status, kill)\n- blacksmith integration (log, retry)\n- blacksmith adapter (info, list, test)\n- blacksmith migrate --consolidate\n\nInclude examples, flags, environment variables.\n\n## Verification\n\nRead src/main.rs Cli struct and Commands enum:\n- List all subcommands\n- Verify flags and arguments\n- Check for undocumented commands\n- Verify help text accuracy\n\n## Affected Files\n\n- docs/cli-reference.md (new)\n\nDESIGN\nDESCRIPTION\nWrite docs/cli-reference.md documenting all commands and subcommands.\n\n## Content\n\nDocument all CLI commands from all PRD versions:\n- blacksmith run [OPTIONS] [MAX_ITERATIONS]\n- blacksmith init [--force] [--export]\n- blacksmith finish \u003cbead-id\u003e \"\u003cmessage\u003e\" [files...]\n- blacksmith --status\n- blacksmith improve (add, list, show, update, promote, dismiss, search)\n- blacksmith metrics (log, status, brief, targets, query, events, rebuild, export, migrate, reingest, beads)\n- blacksmith gc [--dry-run] [--aggressive]\n- blacksmith workers (status, kill)\n- blacksmith integration (log, retry)\n- blacksmith adapter (info, list, test)\n- blacksmith migrate --consolidate\n\nInclude examples, flags, environment variables.\n\n## Verification\n\nRead src/main.rs Cli struct and Commands enum:\n- List all subcommands\n- Verify flags and arguments\n- Check for undocumented commands\n- Verify help text accuracy\n\n## Affected Files\n\n- docs/cli-reference.md (new)\n\n\naffected: docs/cli-reference.mdNOTES\n\naffected: docs/cli-reference.md","notes":"Reopened: docs/cli-reference.md not created","status":"closed","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-16T16:14:57.417238Z","created_by":"Austin King","updated_at":"2026-02-16T17:14:37.484751Z","closed_at":"2026-02-16T17:01:30.715533Z","close_reason":"Documentation files verified against source code and corrected where needed.","dependencies":[{"issue_id":"simple-agent-harness-xvm","depends_on_id":"simple-agent-harness-2kb","type":"blocks","created_at":"2026-02-16T16:15:55.642133Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-xyc","title":"Fix singleton lock: fs2 missing from Cargo.toml, singleton.rs doesn't compile","description":"simple-agent-harness-ckq was closed prematurely by session 50. The singleton lock is NOT functional: fs2 crate is missing from Cargo.toml, singleton.rs has unresolved imports, and DataDir::lock() doesn't exist. Multiple blacksmith processes can still run concurrently and spawn duplicate workers. This blocks safe multi-agent parallel execution. Fix: add fs2 to Cargo.toml, fix singleton.rs compilation, wire it into coordinator startup.","status":"closed","priority":0,"issue_type":"bug","owner":"shout@ozten.com","created_at":"2026-02-16T00:24:38.821499Z","created_by":"Austin King","updated_at":"2026-02-16T00:28:05.534037Z","closed_at":"2026-02-16T00:28:05.534037Z","close_reason":"Verify singleton lock fix: fs2, singleton.rs, DataDir::lock() all functional"}
{"id":"simple-agent-harness-y74","title":"Implement opencode agent adapter","description":"Implement the opencode adapter for parsing OpenCode session output. Supported metrics: turns.total, turns.tool_calls, cost.input_tokens, cost.output_tokens (if available), session.output_bytes, session.exit_code, session.duration_secs. Reference: SPEC-v3-agents.md lines 302-310. Key files: src/adapters.rs.","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:54:13.425637Z","created_by":"Austin King","updated_at":"2026-02-15T18:08:59.371908Z","closed_at":"2026-02-15T18:08:59.371908Z","close_reason":"Implement opencode agent adapter","dependencies":[{"issue_id":"simple-agent-harness-y74","depends_on_id":"simple-agent-harness-wi2","type":"blocks","created_at":"2026-02-15T14:56:51.042353Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-yg5","title":"Implement integration circuit breaker and failure handling","description":"When integration exceeds 3 fix iterations: update bead with failure notes, label for human review, preserve worktree for inspection (don't clean up), continue scheduling unblocked tasks (only hold tasks with overlapping affected sets). Display prominent HUMAN REVIEW NEEDED message (red/bold in terminal). Reference: SPEC-v3-agents.md lines 626-651. Key files: src/integrator.rs, src/coordinator.rs.","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:55:18.220775Z","created_by":"Austin King","updated_at":"2026-02-15T17:01:00.961474Z","closed_at":"2026-02-15T17:01:00.961474Z","close_reason":"Implement integration circuit breaker failure handling with human review escalation","dependencies":[{"issue_id":"simple-agent-harness-yg5","depends_on_id":"simple-agent-harness-t4x","type":"blocks","created_at":"2026-02-15T16:45:36.197649Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-ynf","title":"Rename package and binary from simple-agent-harness to blacksmith","description":"Rename the entire project from simple-agent-harness to blacksmith. Changes: Cargo.toml package name and binary name. CLI struct in main.rs (command name, version string, help text). Config file loading in config.rs: try blacksmith.toml first, fall back to harness.toml for backwards compat. Status file: blacksmith.status instead of harness.status (status.rs, runner.rs). All log messages and tracing output referencing the old name. Update dry-run output in main.rs. PRD ref: Milestone 0. Files: Cargo.toml, src/main.rs, src/config.rs, src/status.rs, src/runner.rs.","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T13:27:11.61603Z","created_by":"Austin King","updated_at":"2026-02-15T13:49:42.874459Z","closed_at":"2026-02-15T13:49:42.874459Z","close_reason":"Rename package and binary from simple-agent-harness to blacksmith"}
{"id":"simple-agent-harness-yyb","title":"Implement structured console logging with tracing","description":"Set up tracing and tracing-subscriber for structured log output. Format: [timestamp] [LEVEL] key=value pairs. Keys include: iteration, global, status, pid, watchdog, stale_secs, limit, retry, output_bytes, committed. Agent subprocess output goes to JSONL file only, not console (unless --verbose). Replace any println! calls with tracing macros. Acceptance: log output matches PRD format examples. See PRD: Console Output section.","status":"closed","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-14T23:48:39.755099Z","created_by":"Austin King","updated_at":"2026-02-15T01:20:12.417214Z","closed_at":"2026-02-15T01:20:12.417214Z","close_reason":"Implement structured console logging with tracing","dependencies":[{"issue_id":"simple-agent-harness-yyb","depends_on_id":"simple-agent-harness-utz","type":"blocks","created_at":"2026-02-14T23:50:45.148718Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-zb5","title":"Implement blacksmith adapter info/list/test commands","description":"Add three adapter CLI subcommands: 'adapter info' shows the detected/configured adapter for the current project. 'adapter list' lists all available adapters with their supported metrics. 'adapter test \u003cfile\u003e' tries parsing a file with the configured adapter and shows extracted metrics. Reference: SPEC-v3-agents.md lines 862-866. Key files: src/main.rs, src/adapters.rs.","status":"closed","priority":3,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-15T14:54:18.49158Z","created_by":"Austin King","updated_at":"2026-02-15T18:11:48.194785Z","closed_at":"2026-02-15T18:11:48.194785Z","close_reason":"Implement blacksmith adapter info/list/test CLI commands","dependencies":[{"issue_id":"simple-agent-harness-zb5","depends_on_id":"simple-agent-harness-6hk","type":"blocks","created_at":"2026-02-15T14:56:52.838383Z","created_by":"Austin King"}]}
{"id":"simple-agent-harness-zl7","title":"Add coordinator SQLite tables for multi-agent state","description":"Add coordinator tables to blacksmith.db: worker_assignments (id, worker_id, bead_id, worktree_path, status, affected_globs JSON, started_at, completed_at, failure_notes), task_file_changes (assignment_id FK, file_path, change_type), integration_log (id, assignment_id FK, merged_at, merge_commit, manifest_entries_applied JSON, cross_task_imports JSON, reconciliation_run bool), bead_metrics (bead_id PK, sessions, wall_time_secs, total_turns, total_output_tokens, integration_time_secs, completed_at). Create migration in db.rs. Reference: SPEC-v3-agents.md lines 669-713. Key files: src/db.rs.","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-15T14:54:18.846733Z","created_by":"Austin King","updated_at":"2026-02-15T15:39:22.967699Z","closed_at":"2026-02-15T15:39:22.967699Z","close_reason":"Add coordinator SQLite tables for multi-agent state"}
